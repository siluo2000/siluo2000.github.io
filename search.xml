<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>精通JavaScript笔记</title>
    <url>/2019/11/06/%E7%B2%BE%E9%80%9AJavaScript%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<blockquote>
<p>《精通JavaScript》第二版 John Resig &amp; Russ Ferguson &amp; John Paxton</p>
</blockquote>
<h2 id="特性、函数和对象"><a href="#特性、函数和对象" class="headerlink" title="特性、函数和对象"></a>特性、函数和对象</h2><h3 id="语言特性"><a href="#语言特性" class="headerlink" title="语言特性"></a>语言特性</h3><h4 id="引用和值"><a href="#引用和值" class="headerlink" title="引用和值"></a>引用和值</h4><p>JavaScript采用两种方式来保存数据：<strong>值</strong>和<strong>引用</strong>。</p>
<p>引用是指向对象所在内存位置的指针。重要的一点是，引用只能指向指针所指目标，不能指向另一个引用。</p>
<p><em>指向同一个对象的多个变量：</em></p>
<a id="more"></a>

<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> refToObj <span class="token operator">=</span> obj<span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>oneProperty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// obj.oneProperty === refToObj.oneProperty [1]</span>

<span class="token comment" spellcheck="true">// 这种修改在两个变量上都能够生效，因为obj和refObj都是引用</span>
refToObj<span class="token punctuation">.</span>anotherProperty <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// obj.anotherProperty === refToObj.anotherProperty [2]</span></code></pre>
<p>1.true<br>2.true</p>
<p>对象有两种特性：属性和方法。</p>
<p><em>自修改对象：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> itemsRef <span class="token operator">=</span> items<span class="token punctuation">;</span>

items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'four'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// items.length === itemsRef.length [1]</span></code></pre>
<p>1.true</p>
<p><em>在维护完整性的同时更改对象的引用：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> itemsRef <span class="token operator">=</span> items<span class="token punctuation">;</span>

items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'new'</span><span class="token punctuation">,</span> <span class="token string">'array'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// items === itemsRef [1]</span></code></pre>
<p>1.false: <code>items</code>指向<code>[&#39;new&#39;, &#39;array&#39;]</code>, <code>itemsRef</code>指向<code>[&#39;one&#39;, &#39;two&#39;, &#39;three&#39;]</code></p>
<p><em>修改对象生成一个全新对象，而非自修改对象：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> item <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> itemRef <span class="token operator">=</span> item<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 这将创建一个新的对象</span>
item <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'ing'</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// item === itemRef [1]</span></code></pre>
<p>1.false: item和itemRef的值现在并不相同，因为创建的是一个全新的字符串对象</p>
<h4 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h4><p>JavaScript中只有两种作用域：函数作用域和全局作用域。</p>
<p><em>JavaScript中变量作用域的工作方式：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'new test'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// foo === 'new test' [1]</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'old test'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// foo === 'new test' [2]</span></code></pre>
<p>1.true<br>2.true: 在调用函数时，变量<code>foo</code>仅存在于函数作用域</p>
<p><em>隐式全局变量声明：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  foo <span class="token operator">=</span> <span class="token string">'old test'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// window.foo === 'new test' [1]</span></code></pre>
<p>1.true: 没有使用var声明</p>
<h4 id="上下文"><a href="#上下文" class="headerlink" title="上下文"></a>上下文</h4><p><em>在上下文中使用函数，然后将上下文切换到另一个变量：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setFoo</span><span class="token punctuation">(</span>fooInput<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> fooInput<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// foo [1]</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token punctuation">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// obj.foo [2]</span>

<span class="token function">setFoo</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// foo [3]</span>

obj<span class="token punctuation">.</span>setFoo <span class="token operator">=</span> setFoo<span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">setFoo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// obj.foo [4]</span></code></pre>
<p>1.foo = 5<br>2.obj.foo = 10<br>3.foo = 15: 可以理解为window.setFoo(15)<br>4.obj.foo = 20</p>
<p><em><code>apply</code>&amp;<code>call</code>更改函数上下文：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">changeColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">changeColor</span><span class="token punctuation">(</span><span class="token string">'white'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>

<span class="token keyword">var</span> main <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// call</span>
changeColor<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>main<span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>main<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span>

<span class="token keyword">function</span> <span class="token function">setBodyColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// apply</span>
  changeColor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">setBodyColor</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>1.<code>Cannot set property &#39;color&#39; of undefined</code>: window对象不包含style对象，无法正常运行<br>2.black</p>
<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>闭包是这样一种手段：通过它，内部函数在其父函数结束之后依然能够引用其外围函数中的变量。</p>
<p><em>两个利用闭包来增加代码清晰度的例子：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">'1px solid red'</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">delayedAlert</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">delayedAlert</span><span class="token punctuation">(</span><span class="token string">'Welcome!'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><strong>柯里化(currying)</strong>: 通过预先设置好若干函数参数来创建更简洁全新函数的方法。</p>
<p><em>使用了闭包技术的函数柯里化：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">addGenerator</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>toAdd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> num <span class="token operator">+</span> toAdd
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> addFive <span class="token operator">=</span> <span class="token function">addGenerator</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">addFive</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span></code></pre>
<p>1.num = 5, toAdd = 不可用, addFive = <code>f(toAdd) { return 5 + toAdd }</code><br>2.true: num = 5, toAdd = 4</p>
<p>使用自执行的匿名函数将所有全局变量隐藏起来，避免其他代码读取到这些变量。</p>
<p><em>使用匿名函数隐藏全局变量：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token string">'Thanks for visiting! '</span><span class="token punctuation">;</span>

  window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>1.msg = ‘Thanks for visiting! ‘</p>
<p>闭包允许你引用存在于父函数中的变量。但是它提供给你的并不是该变量在创建之时的值，而是其在父函数中最后的那个值。</p>
<p><em>使用匿名函数来生成创建多个闭包函数所需要的作用域：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'keypress'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> item <span class="token operator">=</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    obj<span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> item<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Thanks for your '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="函数重载与类型检查"><a href="#函数重载与类型检查" class="headerlink" title="函数重载与类型检查"></a>函数重载与类型检查</h4><p><em>JavaScript函数重载：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'How are you?'</span><span class="token punctuation">,</span> console<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span></code></pre>
<p>1.Hello World!<br>2.How are you?</p>
<p><em><code>Array.prototype.slice.call</code>将arguments转换成数组：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">aFunction</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> argsArray <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The last argument is: '</span> <span class="token operator">+</span> argsArray<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">aFunction</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span></code></pre>
<p>1.The last argument is: 3</p>
<p><em>默认消息以及显示默认消息：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">displayError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> msg <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    msg <span class="token operator">=</span> <span class="token string">'An error occurred.'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">displayError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span></code></pre>
<p>1.An error occurred.</p>
<p><em>使用<code>typeof</code>决定对象类型：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token string">'50'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token string">'apples,oranges,pears'</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> num <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  num <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arr <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span>
<span class="token punctuation">}</span></code></pre>
<p>1.num = 50<br>2.arr = [‘apples’, ‘oranges’, ‘pears’]</p>
<p><em>使用<code>instanceof</code>：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> today <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> re <span class="token operator">=</span> <span class="token regex">/[a-z]+/i</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'typeof today: '</span> <span class="token operator">+</span> <span class="token keyword">typeof</span> today<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'typeof re: '</span> <span class="token operator">+</span> <span class="token keyword">typeof</span> re<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>today <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'today is an instance of a Date.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [3]</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>re <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'re is an instance of a RegExp object.'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [4]</span>
<span class="token punctuation">}</span></code></pre>
<p>1.typeof today: object<br>2.typeof re: object<br>3.today is an instance of a Date.<br>4.re is an instance of a RegExp object.</p>
<h3 id="新的对象工具"><a href="#新的对象工具" class="headerlink" title="新的对象工具"></a>新的对象工具</h3><h4 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h4><p><em>创建一个简单的对象并设置属性：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>val <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>click <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 等价于</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  val<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  click<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="修改对象"><a href="#修改对象" class="headerlink" title="修改对象"></a>修改对象</h4><p>JavaScript有三种方法可以帮助你控制某个对象能否修改。我们将依据严格程度，从最低到最高，依次进行讲解。</p>
<ul>
<li><code>Object.preventExtensions()</code>: 不能加入新属性，会导致TypeError错误或者静默失败</li>
<li><code>Object.seal()</code>: 不能删除和添加属性，会导致TypeError错误</li>
<li><code>Object.freeze()</code>: 无法添加、删除或更新属性，会导致TypeError错误。如果属性本身是一个对象，那该对象可以更新，这称为<strong>浅冻结</strong>。要想生成一个完全不可改变的对象，所有值为对象的属性都必须被冻结。</li>
</ul>
<p><em>使用<code>Object.preventExtensions()</code>：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">makeTypeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span><span class="token punctuation">;</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> <span class="token string">'greeting'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>value<span class="token punctuation">:</span> <span class="token string">'Hello World'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
<span class="token punctuation">}</span>
<span class="token function">makeTypeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>1.Uncaught TypeError: Cannot define property greeting, object is not extensible</p>
<p><em>使用<code>Object.seal()</code>：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">'Welcome'</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 可以更新属性</span>
  obj<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// [1]</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'greeting'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">// [2]</span>
  <span class="token keyword">delete</span> obj<span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">makeTypeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">'use strict'</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// [3]</span>
    <span class="token keyword">delete</span> obj<span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 可以更新属性</span>
    obj<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">'Welcome'</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token function">makeTypeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>1.Uncaught TypeError: Cannot redefine property: greeting at Function.defineProperty: 无法将已有属性转换成存取器<br>2.无法删除属性，静默失败<br>3.Uncaught TypeError: Cannot delete property ‘greeting’ of #<code>&lt;Object&gt;</code></p>
<p><em>使用<code>Object.freeze()</code>：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  greeting<span class="token punctuation">:</span> <span class="token string">'Welcome'</span><span class="token punctuation">,</span>
  innerObj<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span>innerObj<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj.innerObj.greeting = '</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>innerObj<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>

<span class="token comment" spellcheck="true">// [2]</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'greeting'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// [3]</span>
<span class="token keyword">delete</span> obj<span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>innerObj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// [4]</span>
obj<span class="token punctuation">.</span>innerObj<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">'Worked so far...'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">makeTypeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// [5]</span>
  <span class="token keyword">delete</span> obj<span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>innerObj<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">'Worked so far...'</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>greeting <span class="token operator">=</span> <span class="token string">'Welcome'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">makeTypeError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>1.obj.innerObj.greeting = Hello World<br>2.Uncaught TypeError: Cannot redefine property: greeting at Function.defineProperty: 无法将已有属性转换成存取器<br>3.无法删除属性，静默失败<br>4.Uncaught TypeError: Cannot redefine property: greeting at Function.defineProperty: 无法将已有属性转换成存取器<br>5.Uncaught TypeError: Cannot delete property ‘greeting’ of #<code>&lt;Object&gt;</code></p>
<p>理解了如何控制对象的可变性，你便能够建立起一定程度上的一致性。<br>比如，如果有一个叫做User的对象，你就可以确保所有基于该对象的新对象都拥有和前者相同的属性，在运行时无法添加任何属性。</p>
<h2 id="创建可重用代码"><a href="#创建可重用代码" class="headerlink" title="创建可重用代码"></a>创建可重用代码</h2><p>确保不会污染全局命名空间或者（过分）依赖全局变量，首先要讨论的就是命名空间，还有其他的调用模式：模块、立即执行函数（IIFE）。</p>
<h3 id="面向对象的JavaScript"><a href="#面向对象的JavaScript" class="headerlink" title="面向对象的JavaScript"></a>面向对象的JavaScript</h3><p>归根结底，我们究竟为什么要使用面向对象编程？答案是，它提供了简化代码重用的使用模式，避免了无用功。</p>
<p><em>Person对象：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
  lastName<span class="token punctuation">:</span> <span class="token string">'Connolly'</span><span class="token punctuation">,</span>
  birthDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'1964-09-05'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  gender<span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
  getAge<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> today <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> diff <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>birthDate<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> year <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">365.25</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>diff <span class="token operator">/</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p><em><code>Object.create</code>创建Person实例：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  toString<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">' is a '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' year-old '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gender<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bob <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">;</span>
bob<span class="token punctuation">.</span>firstName <span class="token operator">=</span> <span class="token string">'Bob'</span><span class="token punctuation">;</span>
bob<span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Sabatelli'</span><span class="token punctuation">;</span>
bob<span class="token punctuation">.</span>birthDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'1969-06-07'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bob<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bob<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span></code></pre>
<p>1.Bob Sabatelli is a 50 year-old male<br>2.true</p>
<p><strong>原型链</strong>：在JavaScript中，原型链是用来解析对象成员值的两种途径之一。<br>原型链就是一种委托机制，允许我们将行为委托给链上更远的一环来处理。</p>
<p><em><code>Object.create polyfill</code>：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Object<span class="token punctuation">.</span>create <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span>create <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    F<span class="token punctuation">.</span>prototype <span class="token operator">=</span> o<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><em>包含工厂方法的Person对象：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  extend<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tmp <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tmp<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> config<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bob <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span>
  lastName<span class="token punctuation">:</span> <span class="token string">'Sabatelli'</span><span class="token punctuation">,</span>
  birthDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'1969-06-07'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bob<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [1]</span></code></pre>
<p>1.Bob Sabatelli is a 50 year-old male</p>
<h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><p>继承实际上非常简单：使用<code>Object.create</code>就行了。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  extend<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Teacher <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  job<span class="token punctuation">:</span> <span class="token string">'teacher'</span><span class="token punctuation">,</span>
  subject<span class="token punctuation">:</span> <span class="token string">'English Literature'</span><span class="token punctuation">,</span>
  yearExp<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  toString<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">+</span> <span class="token string">' is a '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' year-old '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subject <span class="token operator">+</span> <span class="token string">' teacher'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> patty <span class="token operator">=</span> Teacher<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> <span class="token string">'Patricia'</span><span class="token punctuation">,</span>
  lastName<span class="token punctuation">:</span> <span class="token string">'Hannon'</span><span class="token punctuation">,</span>
  subject<span class="token punctuation">:</span> <span class="token string">'chemistry'</span><span class="token punctuation">,</span>
  yearExp<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  gender<span class="token punctuation">:</span> <span class="token string">'female'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>patty<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [1]</span></code></pre>
<p>1.Patricia Hannon is a 55 year-old female chemistry teacher</p>
<p><code>instanceof</code>可以用来确定一个对象是否是某种类型的实例。但<code>instanceof</code>在这里是没有用的，因为<code>instanceof</code>的右操作符数必须是一个函数。<br>怎样才能知道一个对象是不是某种类型的实例呢？使用<code>isPrototypeOf()</code>函数。</p>
<p><em><code>isPrototypeOf()</code>函数：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Teacher <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bob <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span>
  lastName<span class="token punctuation">:</span> <span class="token string">'Sabatelli'</span><span class="token punctuation">,</span>
  birthDate<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'1969-06-07'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> patty <span class="token operator">=</span> Teacher<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> <span class="token string">'Patricia'</span><span class="token punctuation">,</span>
  lastName<span class="token punctuation">:</span> <span class="token string">'Hannon'</span><span class="token punctuation">,</span>
  subject<span class="token punctuation">:</span> <span class="token string">'chemistry'</span><span class="token punctuation">,</span>
  yearExp<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  gender<span class="token punctuation">:</span> <span class="token string">'female'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is bob an instance of Person? '</span> <span class="token operator">+</span> Person<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>bob<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is bob an instance of Teacher? '</span> <span class="token operator">+</span> Teacher<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>bob<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is patty an instance of Teacher? '</span> <span class="token operator">+</span> Teacher<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>patty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [3]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is patty an instance of Person? '</span> <span class="token operator">+</span> Person<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>patty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [4]</span></code></pre>
<p>1.Is bob an instance of Person? true<br>2.Is bob an instance of Teacher? false<br>3.Is patty an instance of Teacher? true<br>4.Is patty an instance of Person? true</p>
<p><em><code>getPrototypeOf()</code>:</em></p>
<pre class=" language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The prototype of bob is Person '</span> <span class="token operator">+</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>bob<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span></code></pre>
<p>1.The prototype of bob is Person John Connolly is a 55 year-old male</p>
<p><em>重现<code>super()</code>函数的效果：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> teacher <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  toString<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> originalStr <span class="token operator">=</span> Person<span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> originalStr <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subject <span class="token operator">+</span> <span class="token string">' teacher.'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> patty <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>patty<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [1]</span></code></pre>
<p>1.Patricia Hannon is a 55 year-old femalechemistry teacher.</p>
<p>很多面向对象的设计人员都认为不应该将Person与Teacher之间的联系进行硬编码。但是作为一种达成目的的简单手段，这样可以快速、简洁、有效地解决问题。</p>
<h4 id="成员可见性"><a href="#成员可见性" class="headerlink" title="成员可见性"></a>成员可见性</h4><p><em>私有成员：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  extend<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tmp <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tmp<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> config<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> creationTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> getCreationTime <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> creationTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    tmp<span class="token punctuation">.</span>getCreationTime <span class="token operator">=</span> getCreationTime<span class="token punctuation">;</span>
    <span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Teacher <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> patty <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>patty<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The Teacher object was created at %s'</span><span class="token punctuation">,</span> patty<span class="token punctuation">.</span><span class="token function">getCreationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span></code></pre>
<p>1.Patricia Hannon is a 55 year-old femalechemistry teacher.<br>2.The Teacher object was created at Fri Nov 08 2019 23:01:19 GMT+0800 (中国标准时间)</p>
<p>如你所见，<code>creationTime</code>作为函数<code>extend()</code>的局部变量，在函数外部是不可用的。</p>
<p>这里有一个小瑕疵：这并不是最有效的模式。每次创建Person实例或子类型，都会创建一个能够访问<code>extend()</code>调用上下文的全新函数，其中<code>extend()</code>用于生成Person实例。会增加内存开销，要谨慎对待特权函数，把它们留给需要严格控制访问的数据。</p>
<h4 id="面向对象JavaScript的未来"><a href="#面向对象JavaScript的未来" class="headerlink" title="面向对象JavaScript的未来"></a>面向对象JavaScript的未来</h4><p>ES6引入了一个基础关键字<code>class</code>用于定义JavaScript类型。<br>针对在子类型中覆盖函数的情况，ES6加入了<code>super</code>关键字来引用原型链中的该函数。</p>
<h3 id="打包JavaScript"><a href="#打包JavaScript" class="headerlink" title="打包JavaScript"></a>打包JavaScript</h3><p>我们希望有一组工具可以对代码进行有效封装，避免无意中使用到全局上下文，还能够让代码具备可重用性和可分发性。</p>
<h4 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h4><p>如果能够将函数、变量、对象、类型等封装到独立的上下文中，那就不用再依赖全局上下文了。要实现这个目标的话，一开始就得靠命名空间。</p>
<p><em>命名空间：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> FOO <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 添加一个变量</span>
FOO<span class="token punctuation">.</span>x <span class="token operator">=</span>  <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 添加一个函数</span>
FOO<span class="token punctuation">.</span>addEmUp <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>命名空间最好作为一种封装独立代码的特别解决方案。如果你把所有的代码都放到命名空间里，随着功能和数据越来越多，命名空间很快就会变得难以处理。</p>
<h4 id="模块模式"><a href="#模块模式" class="headerlink" title="模块模式"></a>模块模式</h4><p>改善：</p>
<ul>
<li>对命名空间所包含的函数和数据做出基本规定；</li>
<li>在生成器函数中使用私有变量来简化某些功能的实现；</li>
<li>使用函数来生成命名空间，这意味着可以利用JavaScript在运行时生成部分或全部的命名空间，无需再在编译时实现。</li>
</ul>
<p><em>创建模块：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> FOO <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  FOO<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

  FOO<span class="token punctuation">.</span>addEmUp <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> FOO<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> myNamespace <span class="token operator">=</span> <span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><em>包含私有数据的模块：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token comment" spellcheck="true">// 一个私有变量</span>
  <span class="token keyword">var</span> events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  FOO<span class="token punctuation">.</span>addEvent <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> target<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 使用私有变量</span>
    events<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>eventName<span class="token punctuation">:</span> eventName<span class="token punctuation">,</span> target<span class="token punctuation">:</span> target<span class="token punctuation">,</span> fn<span class="token punctuation">:</span> fn<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  FOO<span class="token punctuation">.</span>listEvents <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>eventName<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 使用私有变量</span>
    <span class="token keyword">return</span> events<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>evtObj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> evtObj<span class="token punctuation">.</span>eventName <span class="token operator">===</span> eventName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> FOO<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> myNamespace <span class="token operator">=</span> <span class="token function">getModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="立即调用的函数表达式"><a href="#立即调用的函数表达式" class="headerlink" title="立即调用的函数表达式"></a>立即调用的函数表达式</h4><p><em>立即调用的函数表达式:</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 函数表达式</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This function was invoked immediately!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 另一种方法</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This function was ALSO invoked immediately!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><em>IIFE模块生成器：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    addEmUp<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    addEvent<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> target<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    listEvents<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>eventName<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><em>为IIFE传递参数：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 这里使用$来引用jQuery</span>
<span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    addEmUp<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    addEvent<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> target<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      events<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>eventName<span class="token punctuation">:</span> eventName<span class="token punctuation">,</span> target<span class="token punctuation">:</span> target<span class="token punctuation">,</span> fn<span class="token punctuation">:</span> fn<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">$</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    listEvents<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>eventName<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>jQuery<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="JavaScript代码调试"><a href="#JavaScript代码调试" class="headerlink" title="JavaScript代码调试"></a>JavaScript代码调试</h2><h3 id="调试工具"><a href="#调试工具" class="headerlink" title="调试工具"></a>调试工具</h3><p>开发者工具箱中通常包含下列工具：</p>
<ul>
<li>控制台</li>
<li>调试器</li>
<li>DOM探查器 DOM inspector</li>
<li>网络分析器 network analyzer</li>
<li>侧写器 profiler</li>
</ul>
<p>浏览器扩展：</p>
<ul>
<li>Postman</li>
<li>…</li>
</ul>
<h4 id="控制台"><a href="#控制台" class="headerlink" title="控制台"></a>控制台</h4><p>控制台界面模仿了人们所熟知的多数应用程序的日志级别：debug、info、warn、log。</p>
<p>万一所用平台没有控制台，你可以使用如下代码作为polyfill。</p>
<p><em>控制台polyfill：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>console<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>console <span class="token operator">=</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">:</span> alert
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><em>控制台级别：</em></p>
<pre class=" language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A basic log message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Debug level'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Info level'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'Warn level'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error level (possibly with a stacktrace).'</span><span class="token punctuation">)</span></code></pre>
<h4 id="利用控制台的特性"><a href="#利用控制台的特性" class="headerlink" title="利用控制台的特性"></a>利用控制台的特性</h4><p>控制台一开始处于单行模式，你可以逐行输入JavaScript代码。如果要一次输入多行代码，可以切换到多行模式（在Firefox和IE中，单击对应的图标进入该模式；在Chrome中，只需要在每行结束后使用shift+enter）。</p>
<ul>
<li>调试器：选择何时启用调试器的最简方法就是设置断点。</li>
<li>DOM探查器：DOM探查器能够反映DOM的当前状态。只要对DOM做出了改动，页面都可以即刻更新，动态反映这些变化。</li>
<li>网络分析器：获得Ajax请求的相关信息。</li>
<li>时间线Timeline：显示一段时间内内存的占用情况。</li>
<li>侧写器：查找内存泄漏的位置并进行修复。</li>
</ul>
<h2 id="文档对象模型"><a href="#文档对象模型" class="headerlink" title="文档对象模型"></a>文档对象模型</h2><h3 id="文档对象模型简介"><a href="#文档对象模型简介" class="headerlink" title="文档对象模型简介"></a>文档对象模型简介</h3><p>最初，DOM是描述浏览器中HTML文档各个部分的一种方式。也称传统DOM或DOM0级。<br>DOM最终变成了一种接口，由万维联盟负责管理。当前规范是<a href="https://www.w3.org/TR/domcore/" target="_blank" rel="noopener">DOM4</a>级（DOM Level 4）。</p>
<h4 id="DOM结构"><a href="#DOM结构" class="headerlink" title="DOM结构"></a>DOM结构</h4><p>HTML文档的结构在DOM中描述成一棵可导航的树。<br>DOM树使用特定的术语来指代HTML树中的各种对象。DOM树中的一切都是节点：HTML元素是节点，元素中的文本是节点，注释是节点，DOCTYPE是节点，甚至连attribute都是节点！</p>
<p>节点类型及其对应的常量值：</p>
<table>
<thead>
<tr>
<th>节点名</th>
<th>节点类型值</th>
</tr>
</thead>
<tbody><tr>
<td>ELEMENT_NODE</td>
<td>1</td>
</tr>
<tr>
<td>ATTRIBUTE_NODE(不宜用)</td>
<td>2</td>
</tr>
<tr>
<td>TEXT_NODE</td>
<td>3</td>
</tr>
<tr>
<td>CDATA_SECTION_NODE(不宜用)</td>
<td>4</td>
</tr>
<tr>
<td>ENTITY_REFERENCE_NODE(不宜用)</td>
<td>5</td>
</tr>
<tr>
<td>ENTITY_NODE(不宜用)</td>
<td>6</td>
</tr>
<tr>
<td>PROCESSING_INSTRUCTION_NODE</td>
<td>7</td>
</tr>
<tr>
<td>COMMENT_NODE</td>
<td>8</td>
</tr>
<tr>
<td>DOCUMENT_NODE</td>
<td>9</td>
</tr>
<tr>
<td>DOCUMENT_TYPE_NODE</td>
<td>10</td>
</tr>
<tr>
<td>DOCUMENT_FRAGMENT_NODE</td>
<td>11</td>
</tr>
<tr>
<td>NOTATION_NODE(不宜用)</td>
<td>12</td>
</tr>
</tbody></table>
<h4 id="DOM中的相互关系"><a href="#DOM中的相互关系" class="headerlink" title="DOM中的相互关系"></a>DOM中的相互关系</h4><ul>
<li>parentNode</li>
<li>firstChild</li>
<li>lastChild</li>
<li>nextSibling</li>
<li>previousSibling</li>
<li>childNodes</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie<span class="token punctuation">=</span>edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Introduction to the DOM<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Introduction to the DOM<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>5.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 这句实际上没有指向&lt;h1>元素</span>
<span class="token comment" spellcheck="true">// 源自XML中最棘手，也是最具争议的一个方面：white space（空白字符）</span>
<span class="token comment" spellcheck="true">// document.documentElement.firstChild --> &lt;head></span>
<span class="token comment" spellcheck="true">// &lt;head>的nextSibling是一个换行符，被认为是一个空白字符，是text节点</span>
document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>nextSibling<span class="token punctuation">.</span>firstChild <span class="token comment" spellcheck="true">// [1]</span></code></pre>
<p>1.null</p>
<p>有两种主要的方法可用于访问页面中的元素：</p>
<ul>
<li>沿用相对关系的方式来访问，也称DOM遍历</li>
<li>元素检索函数</li>
</ul>
<h3 id="访问DOM元素"><a href="#访问DOM元素" class="headerlink" title="访问DOM元素"></a>访问DOM元素</h3><p>所有的现代DOM实现中都包含了很多可以轻松找出页面中元素的方法。这些方法配合一些定制函数可以更轻松地实现在DOM中导航。</p>
<ul>
<li><code>document.getElementById(&#39;everywhere&#39;)</code>：只能用于文档对象，要么返回一个引用，该引用指向拥有给定ID的HTML元素；要么返回null</li>
<li><code>document.getElementsByClassName(&#39;test&#39;)</code>：返回一个包含所有匹配元素的实时变化的HTMLCollection</li>
<li><code>document.getElementsByTagName(&#39;li&#39;)</code>：返回实时变化的NodeList</li>
</ul>
<p><code>getElementsByClassName()</code>和<code>getElementsByTagName()</code>都拥有<code>length</code>属性和<code>item()</code>方法，都没有任何如<code>push() pop() map() filter()</code>这类高级的Array方法。两种方法在返回类型上的差异源于浏览器对于DOM的实现不一致。未来，它们都应该返回HTMLCollection实例。</p>
<p><em>HTMLCollection/NodeList上的Array函数：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">filterForListItems</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> el<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'LI'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> testElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> liElements <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>filter<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>testElements<span class="token punctuation">,</span> filterForListItems<span class="token punctuation">)</span></code></pre>
<p><em>限制搜索范围：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'items'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> liElements <span class="token operator">=</span> ul<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><em>查找<code>&lt;h1&gt;</code>元素：</em></p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></code></pre>
<h4 id="利用CSS选择器查找元素"><a href="#利用CSS选择器查找元素" class="headerlink" title="利用CSS选择器查找元素"></a>利用CSS选择器查找元素</h4><ul>
<li><a href="https://www.w3.org/TR/CSS21/selector.html" target="_blank" rel="noopener">CSS 2.1选择器</a></li>
<li><a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">CSS 3选择器</a></li>
</ul>
<p>有两个方法可以通过CSS选择器来访问元素：<code>querySelector()</code>和<code>querySelectorAll()</code>。<br>给<code>querySelector()</code>传入一个合法的CSS选择器，它能够返回指向匹配该选择器的第一个元素的引用。<br>当使用<code>querySelectorAll()</code>时，唯一的不同就是，你获得的是一个包含了所有元素的静态NodeList（不会实时更新）。<br>要尽可能地限制搜索范围，以获得更高的效率和更快的执行速度。</p>
<p>访问多个元素时，考虑使用<code>getElementsByTagName()</code>，接着是<code>getElementsByClassName()</code>，然后是<code>querySelectorAll()</code>。但是要记住，这仅仅考虑了执行速度。</p>
<h3 id="等待HTML-DOM载入"><a href="#等待HTML-DOM载入" class="headerlink" title="等待HTML DOM载入"></a>等待HTML DOM载入</h3><h4 id="等待页面载入"><a href="#等待页面载入" class="headerlink" title="等待页面载入"></a>等待页面载入</h4><p>目前最常用的技术就是等页面完全载入之后再执行DOM操作。尽管这种方法是最简单的，但也是最慢的，需要将所有包含src特性的元素所对应的文件全部下载之后才会触发<code>load</code>事件。这也是向后兼容性最好的解决方案。</p>
<p><em><code>addEventListener()</code>函数，该函数可以为window的load属性绑定一个回调函数：</em></p>
<pre class=" language-js"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> theSquare <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'square'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  theSquare<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="等待正确的事件"><a href="#等待正确的事件" class="headerlink" title="等待正确的事件"></a>等待正确的事件</h4><p>如果有一个较新的现代浏览器，你可以检查一下<code>DOMContentLoaded</code>事件。该事件会在文档完全载入并解析后触发。<br>但是记住，在这个事件发生的时候，图片、样式表、视频、音频等可能还没有全部载入。如果在某个特定的图片或视频文件被载入后执行，那得考虑使用特定标签的<code>load</code>事件。</p>
<p><em>使用<code>DOMContentLoaded</code>：</em></p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> functionHandler<span class="token punctuation">)</span></code></pre>
<p>IE8并不支持<code>DOMContentLoaded</code>，不过你可以检查文档中的<code>ready</code>状态是否发生了变化。</p>
<p><em>跨浏览器的<code>DOMContentLoaded</code>：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">.</span>callee<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'onreadystatechange'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">detachEvent</span><span class="token punctuation">(</span><span class="token string">'onreadystatechange'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">.</span>callee<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="获取元素内容"><a href="#获取元素内容" class="headerlink" title="获取元素内容"></a>获取元素内容</h3><h4 id="获取元素的文本内容"><a href="#获取元素的文本内容" class="headerlink" title="获取元素的文本内容"></a>获取元素的文本内容</h4><p><em>获取<code>&lt;strong&gt;</code>元素的文本内容：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 非Mozilla浏览器</span>
strongElem<span class="token punctuation">.</span>innerText

<span class="token comment" spellcheck="true">// 包括非Mozilla浏览器在内的全部浏览器</span>
strongElem<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>nodeValue</code></pre>
<p><em>用于检索元素文本内容的通用函数：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">text</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  e <span class="token operator">=</span> e<span class="token punctuation">.</span>childNodes <span class="token operator">||</span> e<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t <span class="token operator">+</span><span class="token operator">=</span> e<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeType <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">?</span> e<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue <span class="token punctuation">:</span> <span class="token function">text</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>how are you dong? <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> pElm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">text</span><span class="token punctuation">(</span>pElm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span></code></pre>
<p>1.how are you dong? hello</p>
<h4 id="获取元素的HTML"><a href="#获取元素的HTML" class="headerlink" title="获取元素的HTML"></a>获取元素的HTML</h4><p>在使用innerHTML属性时，你可能会碰到一些怪异的问题：</p>
<ul>
<li>基于Mozilla的浏览器在使用innerHTML时不会返回<code>&lt;style&gt;</code>元素</li>
<li>在IE8以及更低的版本中，返回的元素都是大写的，这种不一致性着实让人崩溃</li>
<li>innerHTML属性只能作为HTML DOM文档的元素属性来使用，如果把它用在XML DOM文档中，则会产生一个空值</li>
</ul>
<pre class=" language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>strongElem<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pElm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span></code></pre>
<p>1.hello<br>2.<code>how are you dong? &lt;strong&gt;hello&lt;/strong&gt;</code></p>
<h3 id="使用元素特性"><a href="#使用元素特性" class="headerlink" title="使用元素特性"></a>使用元素特性</h3><p><em>确定元素是否具备某个特性：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">hasAttribute</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> elem<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="特性值的获取与设置"><a href="#特性值的获取与设置" class="headerlink" title="特性值的获取与设置"></a>特性值的获取与设置</h4><p>有两种方法可以从元素中检索特性值：</p>
<ul>
<li>兼容HTML DOM和XML DOM：<code>getAttribute()</code>和<code>setAttribute()</code></li>
<li>只能用于HTML DOM：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 兼容</span>
<span class="token comment" spellcheck="true">// 获取属性</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'everywhere'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 设置属性值</span>
document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token string">'Your Name'</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true">// HTML DOM</span>
<span class="token comment" spellcheck="true">// 快速获取特性</span>
document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value

<span class="token comment" spellcheck="true">// 快速设置特性</span>
document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'main'</span><span class="token punctuation">;</span></code></pre>
<p><em>元素属性值的获取和设置：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">attr</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> name<span class="token punctuation">.</span>constructor <span class="token operator">!=</span> String<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 是否需要更改名称</span>
  name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'for'</span><span class="token punctuation">:</span> <span class="token string">'htmlFor'</span><span class="token punctuation">,</span> <span class="token string">'className'</span><span class="token punctuation">:</span> <span class="token string">'calss'</span><span class="token punctuation">}</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> name<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">!=</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 先使用最快的设置方式</span>
    elem<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 如果可以的话，使用setAttribute</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>setAttribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      elem<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> elem<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> elem<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>使用<code>attr()</code>函数从DOM元素中设置及检索特性值：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token function">attr</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'header'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="修改DOM"><a href="#修改DOM" class="headerlink" title="修改DOM"></a>修改DOM</h3><p>修改DOM需要三个步骤：首先你要知道如何创建一个新的元素，然后学会如何把创建出的元素插入DOM，最后还得能够把它删除。</p>
<h4 id="使用DOM创建节点"><a href="#使用DOM创建节点" class="headerlink" title="使用DOM创建节点"></a>使用DOM创建节点</h4><p><em>创建DOM元素的通用函数：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 测试是否需要使用正确的XHTML命名空间来创建新的DOM元素</span>
  <span class="token keyword">return</span> document<span class="token punctuation">.</span>createElementNS <span class="token operator">?</span>
          document<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span><span class="token string">'http://www.w3.org/1999/xhtml'</span><span class="token punctuation">,</span> elem<span class="token punctuation">)</span> <span class="token punctuation">:</span>
          document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 使用</span>
<span class="token keyword">var</span> div <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'items'</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'all'</span><span class="token punctuation">;</span></code></pre>
<p>另外值得注意的是，有一个DOM方法<code>createTextNode()</code>可以用来创建新的文本节点。它接受单个参数作为要放在节点内部的文本，返回所创建的文本节点。</p>
<h4 id="插入DOM"><a href="#插入DOM" class="headerlink" title="插入DOM"></a>插入DOM</h4><p>有两个函数可以向DOM插入内容：</p>
<ul>
<li><code>insertBefore()</code></li>
<li><code>appendChild()</code></li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 把第一个元素插入到第二个元素的前面</span>
parentOfBeforeNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>nodeToInsert<span class="token punctuation">,</span> beforeNode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 将指定节点追加到子节点列表的尾部</span>
parentElem<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>nodeToInsert<span class="token punctuation">)</span></code></pre>
<p><em>一个可以在另一个元素之间插入元素的函数：</em></p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> addElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">addElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> orderList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myList'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  li<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">'Thanks for visiting'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  orderList<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>li<span class="token punctuation">,</span> orderList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="向DOM中插入HTML"><a href="#向DOM中插入HTML" class="headerlink" title="向DOM中插入HTML"></a>向DOM中插入HTML</h4><p>比起创建普通的DOM元素并将其插入DOM中，另一种更为流行的技术是直接向文档中插入HTML。实现这个目标最简单的方法是使用之前讲到过的innerHTML方法。</p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'ol'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;li>Cats.&lt;/li>&lt;li>Dogs.&lt;/li>&lt;li>Mice.&lt;/li>'</span></code></pre>
<p>innerHTML方法也有不少棘手的问题：</p>
<ul>
<li>在XML DOM文档中不存在innerHTML方法</li>
<li>使用客户端XSLT创建的XHTML文档并没有innerHTML方法</li>
<li>innerHTML会将元素内部存在的所有节点全部删除</li>
</ul>
<h4 id="从DOM中删除节点"><a href="#从DOM中删除节点" class="headerlink" title="从DOM中删除节点"></a>从DOM中删除节点</h4><p>删除节点的任务由函数<code>removeChild()</code>来完成。</p>
<pre class=" language-js"><code class="language-js">NodeParent<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>NodeToRmove<span class="token punctuation">)</span></code></pre>
<p>你可以分别创建两个函数来删除节点：</p>
<p><em>从DOM中删除单个节点的函数：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>elem<span class="token punctuation">)</span> elem<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>删除一个元素所有子节点的函数：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">empty</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">remove</span><span class="token punctuation">(</span>elem<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><em>从DOM中删除单个或全部元素：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token function">remove</span><span class="token punctuation">(</span>listItems<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> orderList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myList'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">empty</span><span class="token punctuation">(</span>orderList<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="处理DOM中的空白字符"><a href="#处理DOM中的空白字符" class="headerlink" title="处理DOM中的空白字符"></a>处理DOM中的空白字符</h4><p><em>XML文档中空白字符bug的解决方法：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">cleanWhitespace</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 如果没有提供要处理元素，则对整个HTML文档进行处理</span>
  element <span class="token operator">=</span> element <span class="token operator">||</span> document<span class="token punctuation">;</span>
  <span class="token keyword">var</span> cur <span class="token operator">=</span> element<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 处理完所有的子节点</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>curl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 如果该节点是一个文本节点且只包含空白字符</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>nodeType <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token regex">/\S/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      element<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>nodeType <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">cleanWhitespace</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>nextSibling<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>这种技术是将DOM文档中的空白字符文本节点全部删除，使得文档更易于遍历。<br>缺陷是速度特别慢。</p>
<h4 id="简单的DOM导航"><a href="#简单的DOM导航" class="headerlink" title="简单的DOM导航"></a>简单的DOM导航</h4><p><em>该函数可以用来查找某个元素之前的同辈元素：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">prev</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    elem <span class="token operator">=</span> elem<span class="token punctuation">.</span>previousSibling<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>elem <span class="token operator">&amp;&amp;</span> elem<span class="token punctuation">.</span>nodeType <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> elem<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>该函数可以用来查找紧邻某个元素的同辈元素:</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    elem <span class="token operator">=</span> elem<span class="token punctuation">.</span>nextSibling<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>elem <span class="token operator">&amp;&amp;</span> elem<span class="token punctuation">.</span>nodeType <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> elem<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>该函数可以用来查找某个元素的第一个子元素：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">first</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  elem <span class="token operator">=</span> elem<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
  <span class="token keyword">return</span> elem <span class="token operator">&amp;&amp;</span> elem<span class="token punctuation">.</span>nodeType <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">?</span>
          <span class="token function">next</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">:</span> elem<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>该函数可以用来查找某个元素的最后一个子元素：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">last</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  elem <span class="token operator">=</span> elem<span class="token punctuation">.</span>lastChild<span class="token punctuation">;</span>
  <span class="token keyword">return</span> elem <span class="token operator">&amp;&amp;</span> elem<span class="token punctuation">.</span>nodeType <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">?</span>
          <span class="token function">prev</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">:</span> elem<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>该函数可以用来查找某个元素的父元素：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">parent</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  num <span class="token operator">=</span> num <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>elem <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> elem <span class="token operator">=</span> elem<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> elem<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><h3 id="JavaScript事件简介"><a href="#JavaScript事件简介" class="headerlink" title="JavaScript事件简介"></a>JavaScript事件简介</h3><p>从DOM中产生的事件由JavaScript代码来处理，它可以捕获用户的交互动作，引导应用程序的处理流程。</p>
<h4 id="栈、队列和事件循环"><a href="#栈、队列和事件循环" class="headerlink" title="栈、队列和事件循环"></a>栈、队列和事件循环</h4><p>我们所运行的代码，无论是作为全局上下文中的函数，还是被另一个函数调用的函数，都可以被描述成<strong>栈</strong>。如果你运行了一个函数foo()，然后它又调用了函数bar()，那么就有了一个深度为3个帧的栈（全局上下文、foo()、bar()）。</p>
<p>代码运行之后该怎么样呢？那就由<strong>队列</strong>来负责了。前栈被解析之后，它管理接下来要运行的代码。只要栈为空，就会去队列中挑选新的代码来执行。</p>
<p><strong>堆</strong>是变量、函数以及其他命名对象所存在的区域。</p>
<p><strong>事件跟踪线程</strong>和<strong>JavaScript线程</strong>这两个线程共同来捕获用户事件，并依据是否注册过事件处理程序对其进行分类。这个过程被称为<strong>事件循环</strong>。<br>每次循环开始的时候，都会检查用户事件是否已经注册过事件处理程序。如果没有，则什么都不用做。如果有对应的事件处理程序，事件循环会将其放入JavaScript队列的首部，使得JavaScript可以第一时间（前栈被解析之后）执行处理这些程序。</p>
<p><strong>除了Web worker之外，JavaScript都是单线程的。</strong></p>
<h4 id="事件阶段"><a href="#事件阶段" class="headerlink" title="事件阶段"></a>事件阶段</h4><p>JavaScript事件分两个阶段执行，分别是<strong>捕获阶段</strong>和<strong>冒泡阶段</strong>。</p>
<h3 id="绑定事件侦听器"><a href="#绑定事件侦听器" class="headerlink" title="绑定事件侦听器"></a>绑定事件侦听器</h3><p>如今有两种方法可以用来可靠地注册事件。传统的方法是旧式行内方法的一种衍生，但即便是在老版的浏览器中也能够可靠一致地工作。另一种方法是使用W3C的标准事件注册方法。</p>
<h4 id="传统式绑定"><a href="#传统式绑定" class="headerlink" title="传统式绑定"></a>传统式绑定</h4><p><em>使用传统方式来绑定click事件：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> firstName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'firstName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

firstName<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'You clicked in the first name field!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  firstName<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>带有参数的事件绑定：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> firstName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'firstName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

firstName<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'You clicked in the '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">' field!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>还有一种方法可以不必显式地使用event对象。我们也可以在函数中使用this关键字。在事件处理函数上下文中，this指向事件的发起者。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> firstName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'firstName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

firstName<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'You clicked in the '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">' field!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>1.传统式绑定的优点</p>
<ul>
<li>兼容性好</li>
<li>在处理事件时，this关键字指向的当前元素</li>
</ul>
<p>2.传统式绑定的缺点</p>
<ul>
<li>不能对事件捕获和冒泡进行控制，只能使用事件冒泡</li>
<li>一次只能对一个元素绑定一个事件处理程序</li>
</ul>
<p><em>出现误覆盖的事件处理程序：</em></p>
<pre class=" language-js"><code class="language-js">window<span class="token punctuation">.</span>onload <span class="token operator">=</span> myFirstHandler<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 被覆盖了</span>
<span class="token comment" spellcheck="true">// 当页面载入完成时，只有mySecondHandler会被调用</span>
window<span class="token punctuation">.</span>onload <span class="token operator">=</span> mySecondHandler<span class="token punctuation">;</span></code></pre>
<h4 id="DOM绑定：W3C"><a href="#DOM绑定：W3C" class="headerlink" title="DOM绑定：W3C"></a>DOM绑定：W3C</h4><p>为DOM元素绑定事件处理程序的W3C方法是唯一真正标准的手段。记住，所有的现代浏览器都支持这种事件绑定方法。IE8以及旧版本并不支持这种方法。</p>
<p><em>使用W3C方式绑定事件处理程序：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> firstName <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'firstName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 绑定事件处理程序</span>
firstName<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'You clicked in the '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">' field!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>addEventListener</code>接受三个参数：事件名，用于处理事件的函数，以及一个用于指示是否允许事件捕获的布尔标志。<br>第三个参数默认false，意味着使用事件冒泡。如果想使用事件捕获的话，需要明确传入true。</p>
<p>1.W3C绑定的优点</p>
<ul>
<li>即可以支持事件处理的捕获阶段，也可以支持事件处理的冒泡阶段</li>
<li>this指向当前元素</li>
<li>event对象总是作为第一个可用参数</li>
<li>可以绑定任意多的事件而不会覆盖之前绑定的处理程序</li>
</ul>
<p>2.W3C绑定的缺点</p>
<ul>
<li>不能工作在IE8及其更低的版本中。IE使用的是相似语法的<code>attachEvent</code>。</li>
</ul>
<h4 id="解除事件绑定"><a href="#解除事件绑定" class="headerlink" title="解除事件绑定"></a>解除事件绑定</h4><p>对于传统的事件处理而言，只需要将空串或null赋值给事件处理程序就行了：</p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'firstName'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></code></pre>
<p>对于W3C事件处理来说，需要用函数<code>removeEventListener()</code>。<br><code>removeEventListener()</code>参数必须和<code>addEventListener()</code>的参数一模一样，函数必须指向分配给<code>addEventListener()</code>的那个函数。所以如果你给<code>addEventListener()</code>分配的是一个匿名的行内函数，那么你是没法移除这个函数的。</p>
<p><strong>如果觉得随后需要移除处理程序，那么你就应该一直使用命名函数作为事件处理程序。</strong></p>
<h3 id="常见的事件特性"><a href="#常见的事件特性" class="headerlink" title="常见的事件特性"></a>常见的事件特性</h3><p>JavaScript事件拥有大量相对一致的特性，这些特性可以在开发过程中给予你更多的能力和控制。最简单也是最古老的概念就是event对象。</p>
<h4 id="事件对象"><a href="#事件对象" class="headerlink" title="事件对象"></a>事件对象</h4><p>事件处理程序的标准特性之一就是能够访问event对象，该对象包含了与当前事件相关的上下文信息。</p>
<h4 id="取消事件冒泡"><a href="#取消事件冒泡" class="headerlink" title="取消事件冒泡"></a>取消事件冒泡</h4><p><em>使用<code>stopPropagation()</code>阻止事件冒泡：</em></p>
<pre class=" language-js"><code class="language-js">
<span class="token keyword">function</span> <span class="token function">mouseOverHandler</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">'1px solid red'</span><span class="token punctuation">;</span>
  e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">mouseOutHandler</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">'0px'</span><span class="token punctuation">;</span>
  e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> all <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> all<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  all<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseover'</span><span class="token punctuation">,</span> mouseOverHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  all<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseout'</span><span class="token punctuation">,</span> mouseOutHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="屏蔽浏览器的默认行为"><a href="#屏蔽浏览器的默认行为" class="headerlink" title="屏蔽浏览器的默认行为"></a>屏蔽浏览器的默认行为</h4><p><em>用于阻止浏览器默认行为的通用函数：</em></p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 阻止浏览器默认行为</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'examples-link clicked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h4><p><em>事件委托：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">clickHandler</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Handled at '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Emitted by '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> navbar <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'navbar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
navbar<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> clickHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="事件对象event"><a href="#事件对象event" class="headerlink" title="事件对象event"></a>事件对象event</h3><h4 id="普通属性"><a href="#普通属性" class="headerlink" title="普通属性"></a>普通属性</h4><ul>
<li><code>type</code>：包含了当前被触发的事件名称（如click或mouseover）。</li>
<li><code>target</code></li>
<li><code>stopPropagation()</code></li>
<li><code>preventDefault()</code>/<code>returnValue = false</code></li>
</ul>
<h4 id="鼠标属性"><a href="#鼠标属性" class="headerlink" title="鼠标属性"></a>鼠标属性</h4><p>只有发生鼠标相关事件时（如click、mousedown、mouseup、mouseover、mouseout、mouseleave、mouseenter、mousemove），鼠标属性才会出现在event对象中。</p>
<ul>
<li><code>pageX</code>和<code>pageY</code>：鼠标光标相对于浏览器<strong>绝对左上角</strong>的x轴和y轴的坐标位置。页面滚动不会发生变化。</li>
<li><code>clientX</code>和<code>clientY</code>：鼠标光标相对于浏览器的x轴和y轴的坐标位置。页面滚动的时候会变化。</li>
<li><code>layerX/layerY</code>和<code>offsetX/offsetY</code>：鼠标光标相对于事件目标元素的x轴和y轴的坐标位置。offset<em>属性可以在Chrome和IE中使用，但是没法在Firefox中使用。fireFox支持layerX和layerY，但是它们包含的信息并不一样。layer</em>等同于page*属性。</li>
<li><code>button</code>：该属性只能用于click、mousedown和mouseup事件。左键单击是0，中键单击是1，右键单击是2。</li>
<li><code>relatedTarget</code>：该属性包含了鼠标所离开的元素引用。多用于使用了mouseover/mouseout的场景。</li>
</ul>
<p><em>使用relatedTarget属性创建可导航的树状菜单：</em></p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">
  <span class="token selector"><span class="token id">#outer</span> > div</span><span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">128</span>px<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">128</span>px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector"><span class="token id">#top</span> </span><span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> lightblue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector"><span class="token id">#bottom</span> </span><span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> lightcoral<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>outer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>top<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bottom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>bottom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> top <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'top'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> bottom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'bottom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  top<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseover'</span><span class="token punctuation">,</span> onMouseOver<span class="token punctuation">)</span><span class="token punctuation">;</span>
  top<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseout'</span><span class="token punctuation">,</span> onMouseOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
  bottom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseover'</span><span class="token punctuation">,</span> onMouseOver<span class="token punctuation">)</span><span class="token punctuation">;</span>
  bottom<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseout'</span><span class="token punctuation">,</span> onMouseOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onMouseOver</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'entered '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">' from '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>relatedTarget<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onMouseOut</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'exited '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">' for '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>relatedTarget<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h4 id="键盘属性"><a href="#键盘属性" class="headerlink" title="键盘属性"></a>键盘属性</h4><p>只有当发生键盘相关的事件时（如keydown、keyup和keypress），键盘属性才会出现在event对象中。<strong>ctrlKey</strong>和<strong>shiftKey</strong>属性例外，两者在鼠标事件中也可以使用（允许用户按住Ctrl键的同时单击元素）。</p>
<ul>
<li>ctrlKey：返回一个布尔值，指明Ctrl键是否被按下</li>
<li>keyCode：该属性包含了一个数字，对应键盘上不同的按键</li>
<li>shiftKey：返回一个布尔值，指明Shift键是否被按下</li>
</ul>
<h3 id="事件类型"><a href="#事件类型" class="headerlink" title="事件类型"></a>事件类型</h3><p>常见的JavaScript事件可以分为几类：</p>
<ul>
<li><strong>加载及错误事件</strong>：load、unload和beforeunload事件；error事件。</li>
<li><strong>UI事件</strong>：跟踪用户与页面各部分之间的交互。可以使用focus和blur事件来实现跟踪。</li>
<li><strong>鼠标事件</strong>：可以分为两种，跟踪鼠标当前位置的事件（mouseover、mouseout）和跟踪鼠标点击方式的事件（mouseup、mousedown、click）</li>
<li><strong>键盘事件</strong>：负责跟踪按键按下的时机以及环境，例如，跟踪表单元素内部的击键和跟踪整个页面内的击键。</li>
<li><strong>表单事件</strong>：只和表单以及表单输入元素的交互有关。有submit、change、select事件。</li>
</ul>
<h4 id="页面事件"><a href="#页面事件" class="headerlink" title="页面事件"></a>页面事件</h4><ul>
<li><code>load</code></li>
</ul>
<p>页面完全载入完成之后会触发load事件，这包括所有的图片、外部JavaScript文件以及外部的CSS文件。该事件也可应用于大多数包含src特性的元素（img、script、audio、video等）。load事件不会冒泡。</p>
<ul>
<li><code>beforeunload</code></li>
</ul>
<p>这个事件有点怪异，因为它完全是非标准化的，却又得到了广泛的支持。在beforeunload事件的事件处理程序中，如果返回一个字符串，该字符串会显示在一条确认消息中，询问用户是否要离开当前页面。如果用户选择拒绝，那么仍然会停留在该页面。</p>
<ul>
<li><code>error</code></li>
</ul>
<p>每次JavaScript代码中出现错误都会触发error事件。这是一种捕获错误信息并对其进行显示或处理的优雅方式。该事件的事件处理程序同其他的不太一样，它并不创建event对象，而是包含了一条解释具体错误的消息。</p>
<ul>
<li><code>resize</code></li>
</ul>
<p>用户调整浏览器窗口大小时会触发resize事件。如果浏览器窗口大小发生变化，resize事件只会在大小调整完毕后被触发一次，并不会一直被触发。</p>
<ul>
<li><code>scroll</code></li>
</ul>
<p>用户移动浏览器窗口中的文档位置时会触发scroll事件。无论是通过键盘按键（如箭头键、翻页键或是空格键）还是通过滚动条进行移动。</p>
<ul>
<li><code>unload</code></li>
</ul>
<p>用户离开当前页面（如单击了链接、使用了返回按钮或者干脆关闭浏览器窗口）会触发该事件。你无法阻止该事件的默认行为。</p>
<h4 id="UI事件"><a href="#UI事件" class="headerlink" title="UI事件"></a>UI事件</h4><ul>
<li><code>focus</code></li>
</ul>
<p>focus事件可以用来确定光标目前处于页面的何处。</p>
<ul>
<li><code>blur</code></li>
</ul>
<p>当用户将焦点从一个元素切换到另一个元素的时候会发生blur事件。</p>
<h4 id="鼠标事件"><a href="#鼠标事件" class="headerlink" title="鼠标事件"></a>鼠标事件</h4><ul>
<li><code>click</code></li>
</ul>
<p>用户在某个元素上按下鼠标左键并且在同一个元素上释放该按键的时候，会出现click事件。</p>
<ul>
<li><code>dbclick</code></li>
</ul>
<p>用户快速连续完成两次click事件后，会发生dbclick事件。双击的速率取决于操作系统的设置。</p>
<ul>
<li><code>mousedown</code></li>
</ul>
<p>用户按下鼠标按键，会发生mousedown事件。</p>
<ul>
<li><code>mouseup</code></li>
</ul>
<p>用户释放按下鼠标按键，会发生mouseup事件。</p>
<ul>
<li><code>mousemove</code></li>
</ul>
<p>用户操作鼠标光标在页面上移动不少于一个像素，就会发生mousemove事件。所触发的事件的数量取决于用户移动鼠标的速度，以及浏览器跟随更新的速度。</p>
<ul>
<li><code>mouseover</code></li>
</ul>
<p>当用户将鼠标从一个元素移入到另一个元素时会发生mouseover事件。该事件比较消耗资源，因为途径的每一个像素或是子元素都会触发该事件。最好使用我们很快就要讲到的mouseenter。</p>
<ul>
<li><code>mouseout</code></li>
</ul>
<p>用户将鼠标移出元素的时候就会发生mouseout事件。该事件比较消耗资源，和mouseover一样，它会触发很多次。最好使用我们很快就要讲到的mouseleave。</p>
<ul>
<li><code>mouseenter</code></li>
</ul>
<p>其功能和mouseover类似，但是它会聪明地留意哪里算是元素内部，在离开元素边界之前不会重复触发。</p>
<ul>
<li><code>mouseleave</code></li>
</ul>
<p>功能和mouseout类似，但是它会聪明地留意何时离开了元素。</p>
<h4 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h4><ul>
<li><code>keydown/keypress</code></li>
</ul>
<p>当某个按键按下时，keydown事件是第一个发生的键盘事件。如果用户按住键不放，那么keydown事件会一直被触发。<br>keypress事件和keydown事件等同，两者的行为一模一样，除了有一处差异：如果你想阻止某个被按下的键的默认行为，那么必须使用keypress事件。</p>
<ul>
<li><code>keyup</code></li>
</ul>
<p>keyup事件是发生的最后一个键盘事件（在keydown事件之后）。该事件只会被触发一次。</p>
<h4 id="表单事件"><a href="#表单事件" class="headerlink" title="表单事件"></a>表单事件</h4><ul>
<li><code>select</code></li>
</ul>
<p>只要用户使用鼠标在输入区域内选择了不同的文本块，就会触发select事件。</p>
<ul>
<li><code>change</code></li>
</ul>
<p>用户更改了输入元素（包括<code>&lt;select&gt;</code>和<code>&lt;textarea&gt;</code>元素）的值，就会发生change事件。该事件仅在用户离开元素，失去焦点之后才被触发。</p>
<ul>
<li><code>submit</code></li>
</ul>
<p>submit事件只出现在表单内部，并且仅在用户单击了表单提交按钮（位于表单内）或在某个输入元素中敲击了回车键时出现。</p>
<ul>
<li><code>reset</code></li>
</ul>
<p>只有当用户单击了表单内的重置按钮时才会发生reset事件。</p>
<h4 id="事件可访问性"><a href="#事件可访问性" class="headerlink" title="事件可访问性"></a>事件可访问性</h4><p>开发一个优秀的Web应用，要考虑的最后一件事就是确保即便是在不使用鼠标的情况下，事件依然可以正常工作。</p>
<p>要想让你的JavaScript更具备可访问性，那么只要使用了click、mouseover和mouseout事件，你就应该着重考虑提供另一种非鼠标的绑定方式。</p>
<ul>
<li>click事件</li>
</ul>
<p>使click事件在每次按下回车键时发生。</p>
<ul>
<li>mouseover事件</li>
</ul>
<p>使用键盘进行Web页面导航的时候，你实际上是在不同的元素之间改变焦点，可以将事件处理程序绑定在mouseover和focus事件上。</p>
<ul>
<li>mouseout事件</li>
</ul>
<p>就像对应mouseover事件的focus事件一样，blur事件发生在用户将焦点从元素上移开的时候，你可以使用blur事件来作为mouseout事件的一种键盘模拟方法。</p>
<h2 id="JavaScript与表单验证"><a href="#JavaScript与表单验证" class="headerlink" title="JavaScript与表单验证"></a>JavaScript与表单验证</h2><p>在现代浏览器中，我们有了集成的验证API，它配合HTML和CSS提供了一组扩展的表单验证特性。除此之外还有正则表达式，对于数据验证来说，这比逐个遍历字符串中字符要简洁多了。</p>
<h3 id="HTML与CSS表单验证"><a href="#HTML与CSS表单验证" class="headerlink" title="HTML与CSS表单验证"></a>HTML与CSS表单验证</h3><p>HTML5中值得注意的是对于表单控件的改进。简单的表单验证已经移入HTML了，如<code>input</code>的<code>required</code>。</p>
<p><em>一个简单的表单：</em></p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>A basic form<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Please provide your first and last names.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>firstName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>First Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>firstName<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>firstName<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token punctuation">/></span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lastName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Last Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lastName<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lastName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Submit the form<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reset<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Reset the form<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
<p>如果不填写<code>firstName</code>字段，浏览器自带的提示就会出现。<br>如果想弹出定制信息，需要使用JavaScript。</p>
<p>常用的HTML验证特性还有：</p>
<ul>
<li><code>pattern</code>：使用一个正则表达式作为参数，如<code>pattern=&quot;[A-z]{3}&quot;</code>，模式验证在<em>Safari 8、iOS Safari 8.1和Opera Mini</em>中无法使用。</li>
<li><code>step</code>：要求值必须是所指定的间隔值的倍数，适用于<code>number</code>、<code>range</code>或日期输入类型。间隔值验证只能在<strong>Chrome 6.0、Firefox 16.0、IE 10、Opera 10.62以及Safari 5.0</strong>中使用。</li>
<li><code>min/max</code>：最小值/最大值，不仅可用于数字，也可以用于日期。只能在<strong>Chrome 41、Opera 27以及安卓4.1版的Chrome</strong>中使用。</li>
<li><code>maxlength</code>：字段中数据的最大长度（以字符为单位），只适用于<code>text</code>、<code>email</code>、<code>search</code>、<code>password</code>、<code>tel</code>或<code>url</code>输入类型。所有的现代浏览器都可以使用该特性。</li>
</ul>
<p><code>type</code>为<code>email</code>和<code>url</code>意味着匹配模式适合验证电子邮件地址和URL。</p>
<h4 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h4><p>处于无效状态的表单元素可以通过<code>:invalid</code>伪类进行访问。<br>CSS还提供了其他一些伪类：</p>
<ul>
<li><code>:valid</code>：包括处于有效状态的元素</li>
<li><code>:required</code>：可以获得<code>required</code>特性为真的元素</li>
<li><code>:optional</code>：可以获得没有设置<code>required</code>特性的元素</li>
<li><code>:in-range</code>：用于处在最小值/最大值之间的元素（IE不支持）</li>
<li><code>:out-of-range</code>：用于处在最小值/最大值之外的元素（IE不支持）</li>
</ul>
<p>实际中应该用<code>input:invalid</code>，防止选择整个表单元素。<br>在Firefox中，提交表单后，无效元素周围会出现红色的光晕效果。可以利用<code>:-moz-ui-invalid</code>伪类重写：</p>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token pseudo-class">:-moz-ui-invalid</span> </span><span class="token punctuation">{</span> <span class="token property">box-shadow</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre>
<h3 id="JavaScript表单验证"><a href="#JavaScript表单验证" class="headerlink" title="JavaScript表单验证"></a>JavaScript表单验证</h3><p>检查表单元素有效性最简单的方法是在元素上调用<code>checkValidity()</code>。所有的表单元素所对应的JavaScript对象现在都包含了<code>checkValidity()</code>方法。符合约束条件返回<code>true</code>，否则为<code>false</code>。</p>
<p>对于元素的有效性，除了简单地得知是或否，我们还可以找出元素无效的原因。元素的<code>validity</code>属性是一个对象，该对象包含了可能导致验证错误的所有原因，我们称其为<code>validityState</code>对象。我们可以遍历这个对象的属性，如果某个属性为<code>true</code>，那么我们就知道了元素验证失败的原因。</p>
<p><em><code>ValidityState</code>对象的属性：</em></p>
<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>valid</code></td>
<td>元素值是否有效</td>
</tr>
<tr>
<td><code>valueMissing</code></td>
<td>没有提供必需的值</td>
</tr>
<tr>
<td><code>patternMismatch</code></td>
<td>没有通过正则表达式检查</td>
</tr>
<tr>
<td><code>rangeUnderflow</code></td>
<td>值小于指定的最小值</td>
</tr>
<tr>
<td><code>rangeOverflow</code></td>
<td>值大于指定的最大值</td>
</tr>
<tr>
<td><code>stepMismatch</code></td>
<td>值不是一个有效的间隔值</td>
</tr>
<tr>
<td><code>tooLong</code></td>
<td>值大于允许的最大长度（以字符为单位）</td>
</tr>
<tr>
<td><code>typeMismatch</code></td>
<td>值不符合<code>email</code>或<code>url</code>输入类型的要求</td>
</tr>
<tr>
<td><code>customError</code></td>
<td>如果抛出了一条定制错误，则值为真</td>
</tr>
<tr>
<td><code>badInput</code></td>
<td>如果浏览器认知值是无效的，但并不是出于之前列出的各种原因。IE不支持这个属性</td>
</tr>
</tbody></table>
<p><em>表单验证与有效性：</em></p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nameForm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fields<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>firstName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>First Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>firstName<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>firstName<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lastName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Last Name:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lastName<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lastName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Phone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tel<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Age (must be over 13):<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>number<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>age<span class="token punctuation">"</span></span> <span class="token attr-name">step</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>14<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Email<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>email<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Website<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Check overall validity<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>overallBtn<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Display validity<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>validBtn<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Submit the form<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submitBtn<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reset<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Reset the form<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resetBtn<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Validation results<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vResults<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vDetails<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> validBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'validBtn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> overAllBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'overallBtn'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
  <span class="token keyword">var</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'nameForm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> vDetails <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'vDetails'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> vResults <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'vResults'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  overAllBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> formValid <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">checkValidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vResults<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Is the form valid? '</span> <span class="token operator">+</span> formValid<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  validBtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> output <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> inputs <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'#fields > input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> inputs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> el <span class="token operator">=</span> inputs<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>

      output <span class="token operator">+</span><span class="token operator">=</span> el<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">' : '</span> <span class="token operator">+</span> el<span class="token punctuation">.</span>validity<span class="token punctuation">.</span>valid<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span>validity<span class="token punctuation">.</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        output <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'['</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> reason <span class="token keyword">in</span> el<span class="token punctuation">.</span>validity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          output <span class="token operator">+</span><span class="token operator">=</span> reason <span class="token operator">+</span> <span class="token string">' '</span>
        <span class="token punctuation">}</span>
        output <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">']'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      output <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">'&lt;br/>'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vDetails<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> output<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>1.不输入直接点击按钮：<br>Is the form valid? false<br>firstName : false[valueMissing typeMismatch patternMismatch tooLong tooShort rangeUnderflow rangeOverflow stepMismatch badInput customError valid ]<br>lastName : true<br>phone : true<br>age : true<br>email : true<br>url : true</p>
<h4 id="验证与用户"><a href="#验证与用户" class="headerlink" title="验证与用户"></a>验证与用户</h4><p>表单验证API最大的一个局限就是无法对验证过程进行定制。你无法在函数中加入自定义代码来作为验证例程。</p>
<h4 id="验证事件"><a href="#验证事件" class="headerlink" title="验证事件"></a>验证事件</h4><p><em>JavaScript的有效性事件：</em></p>
<pre class=" language-js"><code class="language-js">firstName<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'focus'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vResults<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">preventDefaultHandler</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

firstName<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'invalid'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vResults<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'firstName is invalid'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

firstName<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'invalid'</span><span class="token punctuation">,</span> preventDefaultHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="定制验证"><a href="#定制验证" class="headerlink" title="定制验证"></a>定制验证</h3><ul>
<li>要更改表单字段无效时出现的验证消息，可以将<code>setCustomValidity()</code>函数与表单控件绑定在一起。但是有个问题导致<code>setCustomValidity()</code>基本上没什么用武之地：当使用这个函数时，对应表单控件的<code>validityState</code>属性的<code>customError</code>子属性会设置成<code>true</code>。这意味着<code>validityState</code>的<code>valid</code>为<code>false</code>，该值会使得表单控件被视为无效。</li>
<li>另一种选择是使用polyfill。</li>
</ul>
<h4 id="阻止表单验证"><a href="#阻止表单验证" class="headerlink" title="阻止表单验证"></a>阻止表单验证</h4><p>要关闭表单自动验证，需要给表单元素加入<code>novalidate</code>特性。<code>novalidate</code>属性规定当提交表单时不对其进行验证。</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nameForm<span class="token punctuation">"</span></span> <span class="token attr-name">novalidate</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>novalidate<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre>
<p>你可以给表单提交按钮加入<code>formnovalidate</code>特性来阻止单击某个提交按钮时的表单验证行为：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Submit the form<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submitBtn<span class="token punctuation">"</span></span> <span class="token attr-name">formnovalidate</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>formnovalidate<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<h2 id="Ajax入门"><a href="#Ajax入门" class="headerlink" title="Ajax入门"></a>Ajax入门</h2><p>Ajax是利用<code>XMLHttpRequest</code>对象所实现的客户端与服务器之间的异步通信。<br>Ajax的核心规则之一就是：不能存在域外连接。</p>
<h3 id="使用Ajax"><a href="#使用Ajax" class="headerlink" title="使用Ajax"></a>使用Ajax</h3><h4 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h4><h5 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h5><p>所有的Ajax过程一开始都要建立和服务器之间的连接。<br>与<code>XMLHttpRequest</code>对象通信遵循以下步骤：<br>（1）创建<code>XMLHttpRequest</code>实例。<br>（2）对该对象进行适当的配置。<br>（3）通过特定的HTTP verb和目的地址打开请求。<br>（4）发送该请求。</p>
<p><em>使用跨浏览器的方式建立到服务器的HTTP请求：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建请求对象</span>
<span class="token keyword">var</span> xml <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 如果需要特别的配置，可以在此处进行</span>

<span class="token comment" spellcheck="true">// 打开套接字</span>
xml<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/some/url.cgi'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 建立到服务器的连接并发送到其他数据</span>
xml<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>如你所见，用于建立服务器连接的代码非常简单。</p>
<h5 id="数据序列化"><a href="#数据序列化" class="headerlink" title="数据序列化"></a>数据序列化</h5><p>向服务器发送一组数据的第一步就是对其进行格式化，以便服务器进行读取。这个过程称为<strong>序列化（serialization）</strong>。<br>在序列化数据之前，我们需要问几个问题：</p>
<ol>
<li>要发送什么数据？发送的是成对的变量-值吗？数据量大吗？是文件吗？</li>
<li>打算怎样发送数据？用GET？POST?还是其他HTTP verb？</li>
<li>要使用什么样的数据格式？有两种格式：<code>application/x-www-form-urlencoded</code>和<code>multipart/form-data</code>。</li>
</ol>
<p>在现代浏览器中，处理<code>multipart/form-data</code>格式的信息其实很容易——得益于<code>FormData</code>对象。遗憾的是，不是所有的浏览器都支持规范中的全部选项。</p>
<h5 id="FormData对象"><a href="#FormData对象" class="headerlink" title="FormData对象"></a>FormData对象</h5><p><em>使用<code>FormData</code>的<code>append()</code>方法：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建FormData对象</span>
<span class="token keyword">var</span> formDataObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 追加要发送给服务器的名称/值</span>
formDataObj<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">,</span> <span class="token string">'Yakko'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formDataObj<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">,</span> <span class="token string">'Wakko'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formDataObj<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'third'</span><span class="token punctuation">,</span> <span class="token string">'Dot'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 创建请求对象</span>
<span class="token keyword">var</span> xml <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 设置POST</span>
xml<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'http://localhost:3000/items'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 发送FormData对象</span>
xml<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formDataObj<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>FormData</code>对象之外的另一种选择是在JavaScript中进行序列化。</p>
<p>现在让我们来建立一个能够序列化数据结构的标准方法。</p>
<p><em>一个标准函数，用于将数据结构序列化为HTTP兼容的参数方案：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 序列化一组数据。它可以接受两种不同类型的对象：</span>
<span class="token comment" spellcheck="true">//  - 一个输入元素数组</span>
<span class="token comment" spellcheck="true">//  - 一个包含键-值对的散列</span>
<span class="token comment" spellcheck="true">// 该函数返回一个序列化的字符串</span>
<span class="token keyword">function</span> <span class="token function">serialize</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 如果传入一个数组，则假定该数组为表单元素数据</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 序列化表单元素</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 将键-值对序列化</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token keyword">in</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment" spellcheck="true">// 返回最终结果</span>
  <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>现在你已经或得了序列化形式的数据，该看看如何使用GET或POST请求将数据发送到服务器了。</p>
<h5 id="建立GET请求"><a href="#建立GET请求" class="headerlink" title="建立GET请求"></a>建立GET请求</h5><p><em>以跨浏览器方法建立HTTP的GET请求（不读取最终数据）：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建请求对象</span>
<span class="token keyword">var</span> xml <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 打开异步GET请求</span>
xml<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/some/url.cgi?'</span> <span class="token operator">+</span> <span class="token function">serialize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 建立到服务器连接</span>
xml<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h5 id="建立POST请求"><a href="#建立POST请求" class="headerlink" title="建立POST请求"></a>建立POST请求</h5><p><em>以跨浏览器方法建立HTTP的POST请求（不读取最终数据）：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建请求对象</span>
<span class="token keyword">var</span> xml <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 打开异步POST请求</span>
xml<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'http://localhost:3000/items'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 设置头部，以便服务器知道如何解释我们发送的数据</span>
xml<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>
  <span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/x-www-form-urlencoded'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 建立到服务器的连接并发送到其他数据</span>
xml<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><em>使用POST方式向服务器发送XML数据：</em></p>
<pre class=" language-js"><code class="language-js">xml<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>
  <span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/xml'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="HTTP响应"><a href="#HTTP响应" class="headerlink" title="HTTP响应"></a>HTTP响应</h4><p><code>XMLHttpRequest</code>2级对于浏览器如何返回数据提供了更好的控制。这一点我们可以通过设置<code>responseType</code>属性来实现，另外使用<code>response</code>属性来接收所请求的数据。</p>
<p><em>建立服务器连接并读取响应数据：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'./1.jpg'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> downloadFinished<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">downloadFinished</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token string">'image/png'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>responseType</code>属性可以设置成以下任意一种：</p>
<ul>
<li><code>Text</code></li>
<li><code>ArrayBuffer</code></li>
<li><code>Document</code></li>
<li><code>Blob</code>：返回类似于原始数据对象的文件</li>
<li><code>JSON</code></li>
</ul>
<h5 id="监控进度"><a href="#监控进度" class="headerlink" title="监控进度"></a>监控进度</h5><p><em>利用<code>addEventListener()</code>侦听器请求进度：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> myRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 开始请求</span>
myRequest<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loadstart'</span><span class="token punctuation">,</span> onLoadStart<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 百分比</span>
myRequest<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">,</span> onProgress<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 已经完成了下载</span>
myRequest<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> onLoad<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 当发生了错误</span>
myRequest<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> onError<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 当取消请求时</span>
myRequest<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'abort'</span><span class="token punctuation">,</span> onAbort<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 必须在执行send或open方法之前添加事件侦听器</span>
myRequest<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'./1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onLoadStart</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'starting the request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onProgress</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentPercent <span class="token operator">=</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span>loaded <span class="token operator">/</span> evt<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>currentPercent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onLoad</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transfer is complete'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onError</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error during transfer'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onAbort</span><span class="token punctuation">(</span>evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'the user aborted the transfer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

myRequest<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>正常运行输出：<br>starting the request<br>100<br>transfer is complete</p>
<h5 id="超时检查与跨域资源共享"><a href="#超时检查与跨域资源共享" class="headerlink" title="超时检查与跨域资源共享"></a>超时检查与跨域资源共享</h5><p><em>超时检查设置：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 创建请求对象</span>
<span class="token keyword">var</span> xml <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 等待某个请求5秒钟</span>
xml<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>

xml<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">,</span> onTimeOut<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 打开异步GET请求</span>
xml<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/some/url.cgi?'</span> <span class="token operator">+</span> <span class="token function">serialize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 建立到服务器的连接</span>
xml<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>在默认情况下，浏览器不允许应用程序向站点所在服务器之外的其他服务器发出请求。<br>服务器必须能够接受请求，否则会产生INVALID_ACCESS错误。服务器生成的头部信息如下：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 使用通配符表示 --></span>
Access-Control-Arrow-Origin:*

<span class="token comment" spellcheck="true">&lt;!-- 只允许来自特定域的访问 --></span>
Access-Control-Arrow-Origin:http://spaceappleyoshi.com</code></pre>
<h2 id="Web生产工具"><a href="#Web生产工具" class="headerlink" title="Web生产工具"></a>Web生产工具</h2><ul>
<li><a href="http://bower.io/" target="_blank" rel="noopener">Bower</a>：包管理系统</li>
<li><a href="http://gruntjs.com/" target="_blank" rel="noopener">Grunt</a>：构建工具</li>
<li><a href="http://yeoman.io/" target="_blank" rel="noopener">Yeoman</a>：脚手架工具</li>
<li><a href="http://nodejs.org/" target="_blank" rel="noopener">Node Package Manager</a></li>
<li><a href="http://git-scm.com" target="_blank" rel="noopener">Git</a>：版本控制系统</li>
</ul>
<h3 id="为项目搭建脚手架"><a href="#为项目搭建脚手架" class="headerlink" title="为项目搭建脚手架"></a>为项目搭建脚手架</h3><p>Yeoman利用生成器来快速轻松地设置项目。</p>
<p>生成器实际上就是模板，每个人都可以动手制作。生成器的代码开源，你完全可以去一探究竟。</p>
<h3 id="NPM必不可少"><a href="#NPM必不可少" class="headerlink" title="NPM必不可少"></a>NPM必不可少</h3><p>要使用Yeoman，需要先安装Node.js。</p>
<p>安装Node.js后，输入命令：</p>
<pre class=" language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 安装Yeoman</span>
npm install <span class="token operator">-</span>g yo

<span class="token comment" spellcheck="true"># 安装Grunt</span>
npm install <span class="token operator">-</span>g grunt<span class="token operator">-</span><span class="token function">cli</span>

<span class="token comment" spellcheck="true"># 安装Bower</span>
npm install <span class="token operator">-</span>g bower</code></pre>
<h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><p>你可以通过给Yeoman传入不同的参数来调整生成器。在<a href="http://yeoman.io/" target="_blank" rel="noopener">Yeoman.io</a>中，你可以找到一系列生成器及其对应的GitHub仓库链接。例如，如果你想使用AngularJS制作站点，可以输入：</p>
<pre class=" language-powershell"><code class="language-powershell">npm install <span class="token operator">-</span>g generator<span class="token operator">-</span>angular</code></pre>
<p>这样可以安装AngularJS生成器。如果你还需要使用Karma（一个JavaScript测试运行器）来帮助运行单元测试：</p>
<pre class=" language-powershell"><code class="language-powershell">npm install <span class="token operator">-</span>g generator<span class="token operator">-</span>angular generator<span class="token operator">-</span>karma</code></pre>
<p>现在你应该为项目建立一个文件夹，然后在文件夹中运行下面是命令：</p>
<pre class=" language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 在中国使用，体验非常糟糕</span>
yo angular</code></pre>
<p>你会被问到一些关于项目设置的问题。回答完问题，Bower会从GitHub中获取到所需要的所有库的最新版本，帮助你搭好项目的脚手架。一切都安装好之后，输入下面的命令查看站点的运行情况：</p>
<pre class=" language-powershell"><code class="language-powershell">grunt serve</code></pre>
<p>现在你已经有了一个能够运行的站点。</p>
<h4 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h4><p>首先进入<a href="http://git-scm.com" target="_blank" rel="noopener">http://git-scm.com</a>下载并安装Git。<br>安装好之后，可以使用命令行对其进行配置。</p>
<p>添加你的身份信息：</p>
<pre class=" language-powershell"><code class="language-powershell">git config <span class="token operator">-</span>global user<span class="token punctuation">.</span>name <span class="token string">"your name"</span>
git config <span class="token operator">-</span>global user<span class="token punctuation">.</span>email your@email<span class="token punctuation">.</span>com</code></pre>
<p>现在你已经完成了Git的安装和配置，下面准备快速添加文件并完成本地提交。</p>
<pre class=" language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 进入项目文件夹，然后输入</span>
git init

<span class="token comment" spellcheck="true"># 检查提交状态</span>
git status</code></pre>
<h4 id="添加文件、更新以及首次提交"><a href="#添加文件、更新以及首次提交" class="headerlink" title="添加文件、更新以及首次提交"></a>添加文件、更新以及首次提交</h4><pre class=" language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 添加文件，使其能够被Git跟踪</span>
git add file name<span class="token operator">/</span>folder

<span class="token comment" spellcheck="true"># 例如</span>
git add app<span class="token operator">/</span>

<span class="token comment" spellcheck="true"># 提交，-m代表消息</span>
git commit <span class="token operator">-</span>m <span class="token string">"notes about the commit"</span>

<span class="token comment" spellcheck="true"># 查看消息的历史记录</span>
git log</code></pre>
<p>不需要加入Git的文件都被定义在.gitignore文件中。可以自定义该文件。</p>
<p>如果想共享代码或者参与团队工作，你需要在添加一个服务器组件，也就是拥有一个远程仓库，例如GitHub。</p>
<h2 id="AngularJS与测试"><a href="#AngularJS与测试" class="headerlink" title="AngularJS与测试"></a>AngularJS与测试</h2><p>AngularJS已经升级，不确定本章节内容是否仍然可靠，因此省略。</p>
<h2 id="JavaScript的未来"><a href="#JavaScript的未来" class="headerlink" title="JavaScript的未来"></a>JavaScript的未来</h2><h3 id="ECMAScript的过去和未来"><a href="#ECMAScript的过去和未来" class="headerlink" title="ECMAScript的过去和未来"></a>ECMAScript的过去和未来</h3><p>我们认为标准的JavaScript，其大部分特性来自ECMAScript第3版。在第3版出现后的第十年，第5版标准与2009年问世。新的标准旨在改变现状，跟上当下出现的各种纷杂的变化，澄清第3版中诸多语焉不详之处。<br>第5版之后的路该怎么走还存在一些疑问。最终得到采用的是两条路线：<br>一条路线是制定标准5.1，将ECMAScript与国际标准化组织的ECMAScript规范并轨；<br>另一条路线是制定一个新的ECMAScript标准，也就是第6版，通常被称为ECMAScript Harmony。</p>
<h3 id="使用ECMAScript-Harmony"><a href="#使用ECMAScript-Harmony" class="headerlink" title="使用ECMAScript Harmony"></a>使用ECMAScript Harmony</h3><p>Harmony是引导者，不是跟随者，这意味着Harmony当前的实现在质量上是参差不齐的，需要一些工具来对Harmony的各种实现状态进行管理。<br>第一，我们需要利用资源来了解哪些浏览器实现了Harmony的哪些部分。<br>第二，我们想知道如何在浏览器中启用Harmony。<br>第三，我们要检视一些能够把ES6代码转换编译成ES5兼容代码的软件工具。</p>
<h4 id="Harmony资源"><a href="#Harmony资源" class="headerlink" title="Harmony资源"></a>Harmony资源</h4><ul>
<li><a href="https://zh.wikipedia.org/wiki/ECMAScript" target="_blank" rel="noopener">Wiki ECMAScript</a></li>
<li><a href="http://kangax.github.io/compat-table/es6/" target="_blank" rel="noopener">kangax - ECMAScript 6兼容性列表</a></li>
<li><a href="http://pointedears.de/scripts/test/es-matrix/" target="_blank" rel="noopener">Thomas Lahn - ECMAScript矩阵</a></li>
</ul>
<h4 id="使用Harmony"><a href="#使用Harmony" class="headerlink" title="使用Harmony"></a>使用Harmony</h4><p>一个浏览器处于以下四种状态时能够使用Harmony的特性：</p>
<ul>
<li>浏览器可能已经实现了某种Harmony特性</li>
<li>大多数浏览器需要你选择是否使用harmony特性</li>
<li>如果你的浏览器没有启用或者实现某种特性，你可以考虑使用转换编译器，编译ES6代码输出为ES5代码。</li>
<li>如果你希望使用某项ECMAScript 6特性，可以选择针对该特性的polyfill</li>
</ul>
<p>针对第二种状态，Chrome和Firefox在使用ESMAScript 6时，都有各自的怪癖。<br>在Chrome中，你必须进入chrome://flags启用实验特性<code>enable-javascript-harmony</code>。这样做可能会改变Chrome在很多情况下的行为，导致Chrome在渲染某些页面时出现奇怪的现象。如果你只是想在特性会话启动时进行修改，可以从命令行中运行Chrome并加入<code>--javascript-harmony</code>命令选项。<br>在Firefox中，你不需要在启动时修改任何设置，但是你得修改自己的代码。在脚本标签中加入类型特性，将类型设置为<code>application/javascript;version=1.7</code>，这样就可以启用大多数Harmony特性。</p>
<p>另一方面，IE10仅实现了规范中的4项，IE11一共实现了12项。</p>
<h5 id="转换编译器"><a href="#转换编译器" class="headerlink" title="转换编译器"></a>转换编译器</h5><p>转换编译工具有很多。Addy Osmani在Github维护了一个转换编译器和polyfill的列表<a href="https://github.com/addyosmani/es6-tools" target="_blank" rel="noopener">es6-tools</a>。<br>我们将使用Traceur来演示，Traceur是最流行的转换编译器之一，更新也比较频繁。</p>
<p><em>加载Traceur：</em></p>
<pre class=" language-powershell"><code class="language-powershell">npm install traceur</code></pre>
<p><em>使用ECMAScript 6的类：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>make<span class="token punctuation">,</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>make <span class="token operator">=</span> make<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">drive</span><span class="token punctuation">(</span>newSpeed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DEBUG: Speed was previously %d'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>speed <span class="token operator">=</span> newSpeed<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DEBUG: Speed is row %d'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">brake</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DEBUG: Setting speed to 0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>speed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>make <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> honda <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token string">'Honda'</span><span class="token punctuation">,</span> <span class="token string">'Civic'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'honda.toString(): %s'</span><span class="token punctuation">,</span> honda<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
honda<span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The Honda is going %d mph'</span><span class="token punctuation">,</span> honda<span class="token punctuation">.</span><span class="token function">getSpeed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2]</span></code></pre>
<p>1.honda.toString(): Honda Civic<br>2.DEBUG: Speed was previously 0<br>  DEBUG: Speed is row 55<br>  The Honda is going 55 mph</p>
<p><em>使用traceur来运行：</em></p>
<pre class=" language-powershell"><code class="language-powershell">traceur demo<span class="token punctuation">.</span>js

<span class="token comment" spellcheck="true"># 代码输出如下：</span>
<span class="token comment" spellcheck="true"># honda.toString(): Honda Civic</span>
<span class="token comment" spellcheck="true"># DEBUG: Speed was previously 0</span>
<span class="token comment" spellcheck="true"># DEBUG: Speed is row 55</span>
<span class="token comment" spellcheck="true"># The Honda is going 55 mph</span></code></pre>
<p>在浏览器该怎么办？</p>
<ol>
<li>可以使用Traceur生成输出文件，在支持ES5的浏览器中运行该文件。</li>
<li>在浏览器中直接使用ES6代码，使用Traceur现场转换编译。</li>
</ol>
<p><em>Traceur的HTML Shell：</em></p>
<pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Traceur and classes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Running Traceur output in the browser<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./traceur-runtime.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./demo.compiler.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<h5 id="polyfill"><a href="#polyfill" class="headerlink" title="polyfill"></a>polyfill</h5><p>能够使用polyfill达成的特性有很多高质量的实现。但是可以利用polyfill使用的Harmony特性是有限的。</p>
<h3 id="ECMAScript-Harmony语言特性"><a href="#ECMAScript-Harmony语言特性" class="headerlink" title="ECMAScript Harmony语言特性"></a>ECMAScript Harmony语言特性</h3><p>ECMAScript 6引入了大量的新语言特性。</p>
<h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4><p>箭头函数能够让你用更简洁的语法来定义函数，尤其是行内函数。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
numbers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 在这里对传入的数字进行处理</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 等同于</span>
<span class="token comment" spellcheck="true">// 箭头函数</span>
number<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>num <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 在这里对传入的数字进行处理</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>箭头函数总是绑定在它所声明的上下文中。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> courseAssignments <span class="token operator">=</span> <span class="token punctuation">{</span>
  teacher<span class="token punctuation">:</span> <span class="token string">'Stephen Duffy'</span><span class="token punctuation">,</span>
  canTeach<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>courses<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    courses<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Ask %s if he can teach %s'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>teacher<span class="token punctuation">,</span> course<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

courseAssignments<span class="token punctuation">.</span><span class="token function">canTeach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Greek'</span><span class="token punctuation">,</span> <span class="token string">'Latin'</span><span class="token punctuation">,</span> <span class="token string">'Theology'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>1.Ask undefined if he can teach Greek<br>  Ask undefined if he can teach Latin<br>  Ask undefined if he can teach Theology</p>
<p><em>修复：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> courseAssignments <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
  canTeach<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>courses<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 改变this指向</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    courses<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Ask %s if he can teach %s'</span><span class="token punctuation">,</span> that<span class="token punctuation">.</span>teacher<span class="token punctuation">,</span> course<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>1.Ask Stephen Duffy if he can teach Greek<br>  Ask Stephen Duffy if he can teach Latin<br>  Ask Stephen Duffy if he can teach Theology</p>
<p><em>箭头函数重写：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> courseAssignments <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
  canTeach<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>courses<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    courses<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Ask %s if he can teach %s'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>teacher<span class="token punctuation">,</span> course<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>1.Ask Stephen Duffy if he can teach Greek<br>  Ask Stephen Duffy if he can teach Latin<br>  Ask Stephen Duffy if he can teach Theology</p>
<p>箭头函数不能当做构造函数，因为其内部缺少作为构造函数所必需的代码。<br>箭头函数也不支持arguments对象。</p>
<h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><p>在JavaScript中定义一个类：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token punctuation">[</span>classname<span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">[</span>other methods<span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>类还有两个重要特性：易于继承和super访问器。</p>
<p><em>继承可通过extends关键字来实现：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">extends</span> <span class="token class-name">Vehicle</span></code></pre>
<h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><p>让我们从Promise技术的具体应用中理清这些特性的操作过程。宽泛地说，Promise有两种状态：等待（pending）和完成（settled）。Promise会一直处于等待状态，直到它所包装的异步调用返回/超时/结束。这时，Promise的状态变为完成。完成状态又分为两类：解决（resolved）和拒绝（rejected）。</p>
<p><em>Promise：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Bad math, mate'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Resolved with a value of %d'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Something went horribly wrong.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><p>模块的理念很简单：我们需要一个安全的、封闭的命名空间，可以在其中定义数据和功能。</p>
<p><em>定义模块：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 通过export关键字为模块导出了公共API</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> schoolName <span class="token operator">=</span> <span class="token string">'Mickey Kullen Memorial High School'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> firstSport <span class="token operator">=</span> <span class="token string">'Basketball'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// ...</span></code></pre>
<p>使用模块时，我们有两种方式与之交互：声明式（declarative）和编程式（programmatic）。</p>
<p><em>使用模块声明：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 导出整个模块</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> school <span class="token keyword">from</span> <span class="token string">'test-module'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 只导入schoolName</span>
<span class="token keyword">import</span> schoolName <span class="token keyword">from</span> <span class="token string">'test-module'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 导入两个命名成员</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> schoolName<span class="token punctuation">,</span> firstSport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'test-module'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 导入默认导出</span>
<span class="token keyword">import</span> someDefault <span class="token keyword">from</span> <span class="token string">'test-module'</span><span class="token punctuation">;</span></code></pre>
<p><em>编程式导入：</em></p>
<pre class=" language-js"><code class="language-js">System<span class="token punctuation">.</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'test-module'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>school <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h4 id="类型扩展"><a href="#类型扩展" class="headerlink" title="类型扩展"></a>类型扩展</h4><p>ECMAScript最后一类改变是对于现有类型的改进。其中一些改变正式确定了某些在JavaScript中存在已久的特性，例如String类型上的HTML函数。</p>
<h5 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h5><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>String.prototype.startsWith(str)</td>
<td>确定字符串是否以指定的字符串开头</td>
</tr>
<tr>
<td>String.prototype.endsWith(str)</td>
<td>确定字符串是否以指定的字符串结尾</td>
</tr>
<tr>
<td>String.prototype.contains(str, [startPos])</td>
<td>确定字符串是否包含指定的字符串</td>
</tr>
<tr>
<td>String.prototype.repeat(count)</td>
<td>生成一个新的字符串，该字符串将String实例重复指定次数</td>
</tr>
</tbody></table>
<h5 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h5><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Number.isNaN(num)</td>
<td>确定num是否为数字</td>
</tr>
<tr>
<td>Number.isFinite(num)</td>
<td>确定num是否为有穷数字：正无穷、负无穷、NaN、非数字都不属于有穷的范畴</td>
</tr>
<tr>
<td>Number.isInteger(num)</td>
<td>确定num是否为整数</td>
</tr>
<tr>
<td>Number.isSafeInteger(num)</td>
<td>确定num是否能够安全采用IEEE-754双精度规范来描述</td>
</tr>
<tr>
<td>Number.parseInt(string, [radix])</td>
<td>确定代替全局函数parseInt</td>
</tr>
<tr>
<td>Number.parseFloat(string)</td>
<td>确定代替全局函数parseFloat</td>
</tr>
</tbody></table>
<h5 id="数学"><a href="#数学" class="headerlink" title="数学"></a>数学</h5><table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>Math.imul(x, y)</td>
<td>将两个参数的32位乘积以类似于C语言的形式返回</td>
</tr>
<tr>
<td>Math.clz32(num)</td>
<td>返回num对应的32位二进制描述中有多少个值为0的前导位</td>
</tr>
<tr>
<td>Math.fround(num)</td>
<td>返回与num最接近的单精度浮点数描述</td>
</tr>
<tr>
<td>Math.log10(num)</td>
<td>返回num以10为底的对数</td>
</tr>
<tr>
<td>Math.log2(num)</td>
<td>返回num以2为底的对数</td>
</tr>
<tr>
<td>Math.log1p(num)</td>
<td>返回1+num以10的自然对数</td>
</tr>
<tr>
<td>Math.expm1(x)</td>
<td>e的x次方-1</td>
</tr>
<tr>
<td>Math.cosh(num)</td>
<td>返回num的双曲余弦</td>
</tr>
<tr>
<td>Math.sinh(num)</td>
<td>返回num的双曲正弦</td>
</tr>
<tr>
<td>Math.tanh(num)</td>
<td>返回num的双曲正切</td>
</tr>
<tr>
<td>Math.acosh(num)</td>
<td>返回num的反双曲余弦</td>
</tr>
<tr>
<td>Math.asinh(num)</td>
<td>返回num的反双曲正弦</td>
</tr>
<tr>
<td>Math.atanh(num)</td>
<td>返回num的反双曲正切</td>
</tr>
<tr>
<td>Math.hypot([num, num2, num3, ...])</td>
<td>返回参数平方之和的平方根</td>
</tr>
<tr>
<td>Math.trunc(num)</td>
<td>返回num删除小数之后的整数部分，不进行任何舍入操作</td>
</tr>
<tr>
<td>Math.sign(num)</td>
<td>返回num的符号，可以是正、负、0</td>
</tr>
<tr>
<td>Math.cbrt(num)</td>
<td>返回num的立方根</td>
</tr>
</tbody></table>
<h5 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h5><p>首先是一个简单的工具函数：<code>Array.from()</code>，该函数接收类数组对象或可迭代对象，并将其转换为数组。</p>
<p>数组获得了三个新的内容迭代工具：keys、values和entries。</p>
<p>对于数组搜索而言，我们已经有了<code>Array.prototype.indexOf()</code>函数。现在还可以使用<code>Array.prototype.find()</code>和<code>Array.prototype.findIndex()</code>。</p>
<p>最后是<code>Array.prototype.fill()</code>，该函数允许你使用值来填充数组。</p>
<p>数组还有一个更重要的改进：spread操作符<code>...</code>，可以展开数组。</p>
<h4 id="全新的聚合类型"><a href="#全新的聚合类型" class="headerlink" title="全新的聚合类型"></a>全新的聚合类型</h4><p>在ECMAScript Harmony之前，仅有的原生数据结构只有Array和Object。ECMAScript 6引入了set、WeakSet、Map以及WeakMap作为新的数据结构。</p>
<p>让我们先来谈谈这些对象的非弱引用版本（non-Weak version）。Map作为一种数据结构，显然意在取代对象。这其中存在着一些重要的差异。</p>
<ul>
<li>对象的键只能是字符串，而Map的键可以是任何数据类型。</li>
<li>Map有一个表明大小的属性，而对象没有</li>
<li>对象拥有原型，有默认键，而Map没有</li>
</ul>
<p>Set是能够保证唯一性的数组。</p>
<h5 id="弱引用"><a href="#弱引用" class="headerlink" title="弱引用"></a>弱引用</h5><p>你得对JavaScript的垃圾回收机制有一点了解。一般来说，当一个对象的引用计数为0的时候，垃圾回收机制就可以处理该对象了。</p>
<p>假设你创建了一指向复杂对象的引用并将其保存在一个变量中。随后你又将该引用放在了Set中。在函数或部分代码返回之前，你清除了这个变量，将其设置为null。但是，Set中的条目还在，对象还不符合垃圾回收的条件，除非你把对应的条目从Set中删除。<br>该WeakSet和WeakMap登场了。如果对象所有其他的引用都已经清除，该对象就可以交给垃圾回收机制处理了。</p>
<h5 id="聚合类型的API"><a href="#聚合类型的API" class="headerlink" title="聚合类型的API"></a>聚合类型的API</h5><p>各种聚合类型的实现都可以共用一套API。并非任一聚合类型中都能找到所有函数，不过两种或者更多的聚合类型就能包括大多数函数。</p>
<table>
<thead>
<tr>
<th>函数/属性</th>
<th>Set</th>
<th>WeakSet</th>
<th>Map</th>
<th>WeakMap</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>size</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
<td>聚合中的条目数</td>
</tr>
<tr>
<td>add(e)</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
<td>N</td>
<td>向Set加入一个元素</td>
</tr>
<tr>
<td>clear()</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>删除聚合中所有的元素</td>
</tr>
<tr>
<td>delete(k)</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>为Map删除键所对应的条目；为Set删除值所对应的条目</td>
</tr>
<tr>
<td>has(k)</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>根据聚合是否存在键（Map）或值（Set），返回true或false</td>
</tr>
<tr>
<td>get(k)</td>
<td>N</td>
<td>N</td>
<td>Y</td>
<td>Y</td>
<td>获取键所对应的值</td>
</tr>
<tr>
<td>set(k, v)</td>
<td>N</td>
<td>N</td>
<td>Y</td>
<td>Y</td>
<td>将键k对应的值设为v</td>
</tr>
<tr>
<td>entries()</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
<td>N</td>
<td>返回一个迭代器，该迭代器要么为键/值对（Map）返回对立的数组，要么为每个值（Set）返回一个包含两个元素的数组</td>
</tr>
<tr>
<td>forEach(fn, [scope])</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
<td>N</td>
<td>迭代聚合中所有的元素，为每个元素执行函数fn</td>
</tr>
<tr>
<td>keys()</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
<td>N</td>
<td>返回聚合的键。在Set中，键和值是一样的</td>
</tr>
<tr>
<td>values()</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
<td>N</td>
<td>返回聚合的值</td>
</tr>
</tbody></table>
<h2 id="附录-DOM参考"><a href="#附录-DOM参考" class="headerlink" title="附录 DOM参考"></a>附录 DOM参考</h2><h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><ul>
<li><a href="http://www.w3.org/TR/DOM-Level-3-Core/" target="_blank" rel="noopener">HTML DOM3级</a></li>
<li><a href="https://dom.spec.whatwg.org/" target="_blank" rel="noopener">WHATING DOM</a></li>
<li><a href="https://www.quirksmode.org/" target="_blank" rel="noopener">Quirkmode.org</a></li>
<li><a href="https://caniuse.com" target="_blank" rel="noopener">Can I Use</a></li>
</ul>
<h3 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h3><ul>
<li>祖先</li>
<li>特性</li>
<li>子元素</li>
<li>文档</li>
<li>后代</li>
<li>元素</li>
<li>节点</li>
<li>父元素</li>
<li>同辈</li>
<li>文本节点</li>
</ul>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><h4 id="document"><a href="#document" class="headerlink" title="document"></a>document</h4><p>该变量包含浏览器中所见活动的HTML DOM文档。</p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span></code></pre>
<h4 id="HTMLElement"><a href="#HTMLElement" class="headerlink" title="HTMLElement"></a>HTMLElement</h4><p>该变量是所有HTML DOM元素的超类对象。扩展这个元素的原型就等于扩展了所有的HTML DOM元素。</p>
<p><em>为全局HTML元素超类绑定新函数：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 为所有的HTML DOM元素加入一个新的方法</span>
<span class="token comment" spellcheck="true">// 该方法可以用来查看元素是否具有某个特定的类</span>
HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasClass <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'(^|\\s)'</span> <span class="token operator">+</span> <span class="token keyword">class</span> <span class="token operator">+</span> <span class="token string">'(\\s|$)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>className<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="DOM导航"><a href="#DOM导航" class="headerlink" title="DOM导航"></a>DOM导航</h3><ul>
<li><code>body</code></li>
<li><code>childNodes</code>：包含了所有子节点（包括元素、文本节点、注释等等）</li>
<li><code>documentElement</code>：指向HTML元素的引用</li>
<li><code>firstChild</code>：指向元素的第一个子节点，没有子节点则返回null</li>
<li><code>getElementById(elemID)</code></li>
<li><code>getElementsByTagName(tagName)</code></li>
<li><code>lastChild</code>：指向元素的最后一个子节点，没有子节点则返回null</li>
<li><code>nextSibling</code>：指向下一个同辈节点</li>
<li><code>parentNode</code>：指向包含该节点的元素，只有文档节点返回null</li>
<li><code>previousSibling</code>：指向上一个同辈节点</li>
</ul>
<h3 id="节点信息"><a href="#节点信息" class="headerlink" title="节点信息"></a>节点信息</h3><ul>
<li><code>innerText</code>：返回一个包含当前元素内部所有文本内容的字符串</li>
<li><code>nodeName</code>：返回大写的tagName</li>
<li><code>nodeType</code>：返回一个对应节点类型的数字<ul>
<li>元素节点 - 1</li>
<li>文本节点 - 3</li>
<li>文档节点 - 9</li>
</ul>
</li>
<li><code>nodeValue</code>：返回用于访问和处理文本节点中的文本</li>
</ul>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li><code>className</code></li>
<li><code>getAttribute(attrName)</code></li>
<li><code>removeAttribute(attrName)</code></li>
<li><code>setAttribute(attrName, attrValue)</code></li>
</ul>
<h3 id="修改-DOM"><a href="#修改-DOM" class="headerlink" title="修改 DOM"></a>修改 DOM</h3><ul>
<li><p><code>appendChild(nodeToAppend)</code></p>
</li>
<li><p><code>cloneNode(true|false)</code></p>
<p>该函数接收true或false作为参数。<br>如果参数为true，节点以及节点内部的所有内容都会被复制；<br>如果参数为false，则只有节点自己被复制。</p>
</li>
</ul>
<p><em>复制<code>&lt;ul&gt;</code>并进行完全复制：</em></p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
ul<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ul<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<ul>
<li><code>createElement(tagName)</code>：创建元素</li>
<li><code>createElementNS(namespace, tagName)</code>：创建元素，但除此之外，它还能为元素指定命名空间</li>
<li><code>createTextNode(textString)</code>：创建一个能够插入DOM文档的新字符串</li>
</ul>
<pre class=" language-js"><code class="language-js">h<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token string">'Main Page'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<ul>
<li><code>innerHTML</code></li>
<li><code>insertBefore(nodeToInsert, nodeToInsertBefore)</code></li>
<li><code>removeChild(nodeToRemove)</code></li>
<li><code>replaceChild(nodeToInsert, nodeToPeplace)</code></li>
</ul>
]]></content>
      <categories>
        <category>精通JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML5+JavaScript动画基础笔记三(高级动画)</title>
    <url>/2019/11/04/HTML5-JavaScript%E5%8A%A8%E7%94%BB%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0%E4%B8%89-%E9%AB%98%E7%BA%A7%E5%8A%A8%E7%94%BB/</url>
    <content><![CDATA[<blockquote>
<p>《HTML5+JavaScript动画基础》</p>
</blockquote>
<h2 id="缓动与弹动"><a href="#缓动与弹动" class="headerlink" title="缓动与弹动"></a>缓动与弹动</h2><ul>
<li>比例运动 proportional motion</li>
<li>缓动 easing</li>
<li>弹动 springing</li>
</ul>
<h3 id="比例运动"><a href="#比例运动" class="headerlink" title="比例运动"></a>比例运动</h3><p>缓动是指物体滑动到目标点就停下来了。弹动是指物体来回地反弹一会儿，最终停在目标点的运动。<br>这两种技术有几个共同点：</p>
<ul>
<li>需要设定一个目标点</li>
<li>需要确定物体到目标点的距离</li>
<li>运动和距离是成正比的————距离越远，运动的程度越大</li>
</ul>
<p>缓动和弹动的不同点是运动和距离成正比的方面（或者方式）不一样。<br>缓动是指速度与距离成正比；物体离目标点越远，物体运动的速度越快。<br>弹动时随着距离成比例变化的是<strong>加速度</strong>。</p>
<h3 id="缓动"><a href="#缓动" class="headerlink" title="缓动"></a>缓动</h3><p>缓动的类型并不止一种，你可以缓入到一个位置，也可以从一个位置缓出。<br>缓动可以有一些不同的运动特征，比如，正弦波、跳跃、弹性。</p>
<h4 id="简单缓动"><a href="#简单缓动" class="headerlink" title="简单缓动"></a>简单缓动</h4><p>让我们来看一个例子：你正在开车回家，当你离家还有几英里的时候，你会开得尽可能快。<br>当你从高速路上下来，进入社区的时候，就会慢一些。<br>当你开到自己的那条街道，还有一两个街区就要到家的时候，会更慢一些。<br>当你快到家门口的时候，你会减速到每小时几英里。<br>当你快到车库门口的时候，你会再慢一些。<br>当车子还有几英寸就要停下来时，速度已经非常非常慢了。</p>
<p>如果你花点时间想想，就会发现在关门或关抽屉这样的小事中也能体现出这种行为。<br>当使用缓动的方式来移动一个物体到某个点的时候，它就会显得很自然。</p>
<p>以下是实现缓动的策略：</p>
<ul>
<li>为运动确定一个比例系数，这是一个小于1且大于0的小数。</li>
<li>确定目标点。</li>
<li>计算出物体与目标点的距离。</li>
<li>计算速度，速度=距离 x 比例系数。</li>
<li>用当前位置加上速度来计算新的位置。</li>
<li>重复第3步到第5步，直到物体到达目标。</li>
</ul>
<h5 id="何时停止缓动"><a href="#何时停止缓动" class="headerlink" title="何时停止缓动"></a>何时停止缓动</h5><h5 id="移动的目标点"><a href="#移动的目标点" class="headerlink" title="移动的目标点"></a>移动的目标点</h5><h4 id="高级缓动"><a href="#高级缓动" class="headerlink" title="高级缓动"></a>高级缓动</h4><h3 id="弹动"><a href="#弹动" class="headerlink" title="弹动"></a>弹动</h3><h4 id="一维坐标上的弹动"><a href="#一维坐标上的弹动" class="headerlink" title="一维坐标上的弹动"></a>一维坐标上的弹动</h4><h4 id="二维坐标上的弹动"><a href="#二维坐标上的弹动" class="headerlink" title="二维坐标上的弹动"></a>二维坐标上的弹动</h4><h4 id="向移动的目标点弹动"><a href="#向移动的目标点弹动" class="headerlink" title="向移动的目标点弹动"></a>向移动的目标点弹动</h4><h4 id="弹簧在哪儿"><a href="#弹簧在哪儿" class="headerlink" title="弹簧在哪儿"></a>弹簧在哪儿</h4><h4 id="链式弹动"><a href="#链式弹动" class="headerlink" title="链式弹动"></a>链式弹动</h4><h4 id="多个目标点的弹动"><a href="#多个目标点的弹动" class="headerlink" title="多个目标点的弹动"></a>多个目标点的弹动</h4><h4 id="目标偏移量"><a href="#目标偏移量" class="headerlink" title="目标偏移量"></a>目标偏移量</h4><h4 id="用弹簧连接多个物体"><a href="#用弹簧连接多个物体" class="headerlink" title="用弹簧连接多个物体"></a>用弹簧连接多个物体</h4>]]></content>
      <categories>
        <category>HTML5+JavaScript动画基础</category>
      </categories>
      <tags>
        <tag>HTML5</tag>
        <tag>JavaScript</tag>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML5+JavaScript动画基础笔记二(基本动画)</title>
    <url>/2019/10/31/HTML5-JavaScript%E5%8A%A8%E7%94%BB%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0%E4%BA%8C-%E5%9F%BA%E6%9C%AC%E5%8A%A8%E7%94%BB/</url>
    <content><![CDATA[<blockquote>
<p>《HTML5+JavaScript动画基础》</p>
</blockquote>
<h2 id="速度向量和加速度"><a href="#速度向量和加速度" class="headerlink" title="速度向量和加速度"></a>速度向量和加速度</h2><h3 id="速度向量-velocity"><a href="#速度向量-velocity" class="headerlink" title="速度向量 velocity"></a>速度向量 velocity</h3><p>速度向量的概念除了速度之外，还包含一个非常重要的因素：方向。通俗一点的说法是：某个方向上的速度。</p>
<p>为了实现物体在运动的假象，还需要为它在每一帧中指定一些具体的x、y轴坐标。</p>
<p>如果你需要开发一些对帧率要求恒定的游戏或仿真时，那么你可以考虑使用基于时间间隔的动画作为代替方案。</p>
<p>向量与速度向量：向量由大小和方向组成。在速度向量中，大小就是速度。</p>
<a id="more"></a>
<h4 id="单轴上的速度向量"><a href="#单轴上的速度向量" class="headerlink" title="单轴上的速度向量"></a>单轴上的速度向量</h4><p>首先，让我们尝试把问题简化，把速度向量只放在一条轴上：x轴（即水平运动）。</p>
<p>为了便于理解如“x轴速度向量为-1”这类的概念，你完全可以把负号看做是x轴上的“向左”指示符，y轴上的“向上”指示符。</p>
<p>在本书中，我们用<strong>vx</strong>表示x轴上的速度向量，用<strong>vy</strong>表示y轴上的速度向量。</p>
<h4 id="双轴上的速度向量"><a href="#双轴上的速度向量" class="headerlink" title="双轴上的速度向量"></a>双轴上的速度向量</h4><p>让物体沿着两条轴运动也很简单，只须定义vx和vy，并在每一帧中将vx的值加到x属性上，vy的值加到y属性上。</p>
<h4 id="角速度"><a href="#角速度" class="headerlink" title="角速度"></a>角速度</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 转换为弧度制</span>
angle <span class="token operator">=</span> angle <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 将角速度分解为x、y轴上的速度向量</span>
vx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> speed<span class="token punctuation">;</span>
vy <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> speed<span class="token punctuation">;</span></code></pre>
<h4 id="向量加法"><a href="#向量加法" class="headerlink" title="向量加法"></a>向量加法</h4><p>当向量相加时，只须将它们从头到尾依次相连，最终的合成向量就是那条从第一个向量的起点连接到最后一个向量的终点的向量。</p>
<p><img src="1.png" alt="向量加法"></p>
<h4 id="鼠标追随"><a href="#鼠标追随" class="headerlink" title="鼠标追随"></a>鼠标追随</h4><p><code>Math.atan2</code></p>
<h4 id="速度向量扩展"><a href="#速度向量扩展" class="headerlink" title="速度向量扩展"></a>速度向量扩展</h4><p>旋转速度变量<strong>vr</strong>，用于表示旋转速度。</p>
<h3 id="加速度"><a href="#加速度" class="headerlink" title="加速度"></a>加速度</h3><p>速度向量改变的是物体的位置，而加速度改变的是其速度向量。</p>
<ul>
<li><strong>ax</strong></li>
<li><strong>ay</strong></li>
<li><strong>gravity</strong></li>
<li><strong>force</strong></li>
</ul>
<h4 id="单轴加速度"><a href="#单轴加速度" class="headerlink" title="单轴加速度"></a>单轴加速度</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    ax <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  vx <span class="token operator">+</span><span class="token operator">=</span> ax<span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> vx<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>开始的速度向量vx为零，加速度<strong>ax</strong>为0.1。</p>
<h4 id="双轴加速度"><a href="#双轴加速度" class="headerlink" title="双轴加速度"></a>双轴加速度</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    vy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    ax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    ay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token comment" spellcheck="true">// 将加速度加入速度向量</span>
  vx <span class="token operator">+</span><span class="token operator">=</span> ax<span class="token punctuation">;</span>
  vy <span class="token operator">+</span><span class="token operator">=</span> ay<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 将速度向量加入位置坐标</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> vx<span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> vy<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="重力加速度"><a href="#重力加速度" class="headerlink" title="重力加速度"></a>重力加速度</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> gravity <span class="token operator">=</span> <span class="token number">0.02</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  vy <span class="token operator">+</span><span class="token operator">=</span> ay<span class="token punctuation">;</span>
  vy <span class="token operator">+</span><span class="token operator">=</span> gravity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="角加速度"><a href="#角加速度" class="headerlink" title="角加速度"></a>角加速度</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> force <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token keyword">var</span> dx <span class="token operator">=</span> mouse<span class="token punctuation">.</span>x <span class="token operator">-</span> arrow<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
      dy <span class="token operator">=</span> mouse<span class="token punctuation">.</span>y <span class="token operator">-</span> arrow<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
      angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> dx<span class="token punctuation">)</span><span class="token punctuation">,</span>

      <span class="token comment" spellcheck="true">// 将角加速度（作用域物体上的力）分解为x、y轴上的加速度</span>
      ax <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> force<span class="token punctuation">,</span>
      ay <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> force<span class="token punctuation">;</span>
  arrow<span class="token punctuation">.</span>rotation <span class="token operator">=</span> angle<span class="token punctuation">;</span>
  vx <span class="token operator">+</span><span class="token operator">=</span> ax<span class="token punctuation">;</span>
  vy <span class="token operator">+</span><span class="token operator">=</span> ay<span class="token punctuation">;</span>
  arrow<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> vx<span class="token punctuation">;</span>
  arrow<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> vy<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="宇宙飞船"><a href="#宇宙飞船" class="headerlink" title="宇宙飞船"></a>宇宙飞船</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> Ship <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>rotation <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>showFlame <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 控制飞船是否显示火焰</span>
<span class="token punctuation">}</span>
Ship<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>draw <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>cvsCtx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'#fff'</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>showFlame<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cvsCtx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cvsCtx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">7.5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cvsCtx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="飞船控制"><a href="#飞船控制" class="headerlink" title="飞船控制"></a>飞船控制</h4><p>1.首先定义旋转速度向量vr：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre>
<p>2.监听键盘事件：</p>
<pre class=" language-js"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">37</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">// left</span>
      vr <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">39</span><span class="token punctuation">:</span>
      vr <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  thrust <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  ship<span class="token punctuation">.</span>showFlame <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>3.声明一个<code>thrust</code>变量用于追踪飞船在任意时刻的推力大小。只有在火箭点火后飞船才具有加速度，所以该推力的初始值为零：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> thrust <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre>
<p>4.当↑按下：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">case</span> <span class="token number">38</span><span class="token punctuation">:</span>
  <span class="token comment" spellcheck="true">// 设置推力</span>
  thrust <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 绘制火焰</span>
  ship<span class="token punctuation">.</span>showFlame <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre>
<p>5.释放按键后，将thrust重置为零，并消除火焰：</p>
<pre class=" language-js"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  thrust <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  ship<span class="token punctuation">.</span>showFlame <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>6.在drawFrame函数内，可以计算出旋转角度和向飞船施加的反推力：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  ship<span class="token punctuation">.</span>rotation <span class="token operator">+</span><span class="token operator">=</span> vr <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> angle <span class="token operator">=</span> ship<span class="token punctuation">.</span>rotation<span class="token punctuation">,</span>

  <span class="token comment" spellcheck="true">// x、y轴上的加速度</span>
      ax <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> thrust<span class="token punctuation">,</span>
      ay <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> thrust<span class="token punctuation">;</span>

  vx <span class="token operator">+</span><span class="token operator">=</span> ax<span class="token punctuation">;</span>
  vy <span class="token operator">+</span><span class="token operator">=</span> ay<span class="token punctuation">;</span>
  ship<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> vx<span class="token punctuation">;</span>
  ship<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> vy<span class="token punctuation">;</span>
  ship<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="边界与摩擦力"><a href="#边界与摩擦力" class="headerlink" title="边界与摩擦力"></a>边界与摩擦力</h2><p>在真实的物理世界中有一类广泛存在的摩擦力，它会引起物体的速度向量发生改变，比如，来自空气的阻力。</p>
<h3 id="环境边界"><a href="#环境边界" class="headerlink" title="环境边界"></a>环境边界</h3><p>如果在你关注范围内的一个物体移出了那个空间，你就不得不为它做出一个选择：将该物体移动回空间或者不再关注该物体，抑或是追随那个物体，即移动空间使其继续包含该物体，即便物体仍在移动。在动画编程中，以上几种选择其实并没有太大差别。</p>
<h4 id="设置边界"><a href="#设置边界" class="headerlink" title="设置边界"></a>设置边界</h4><p>动画边界的左上角坐标为<code>(0,0)</code>，右下角坐标为<code>(canvas.width, canvas.height)</code>。可以将这些值保存在变量中，如下所示：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    right <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
    bottom <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span></code></pre>
<p>检查你关注的所有移动物体，看看它们是否处在这个空间中：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">></span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// do something</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// do something</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// do something</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// do something</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="移除物体"><a href="#移除物体" class="headerlink" title="移除物体"></a>移除物体</h4><p>如果物体会不断产生，那么移除物体的做法将非常有效。</p>
<p>当多个物体在移动时，应该将它们的引用保存到一个数组中，再通过遍历整个数组来移动它们。<br>使用<code>Array.splice</code>方法移除数组中的某个物体。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> canvas<span class="token punctuation">.</span>width <span class="token operator">||</span> ball<span class="token punctuation">.</span>x <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span>
   ball<span class="token punctuation">.</span>y <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">||</span> ball<span class="token punctuation">.</span>y <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  balls<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>balls<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ball<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>while循环反向遍历数组，只需要在遍历过程中没有新元素被添加到数组的头部：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> i <span class="token operator">=</span> balls<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">draw</span><span class="token punctuation">(</span>balls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="重置物体"><a href="#重置物体" class="headerlink" title="重置物体"></a>重置物体</h4><p>喷泉动画：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> balls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token comment" spellcheck="true">// balls数组</span>
    numBalls <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// ball数量</span>
    gravity <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 重力加速度</span>


<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ball<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numBalls<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 设置ball半径为2，颜色随机</span>
  ball <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ball</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0xffffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'ball'</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 设置ball初始位置</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 生成ball的x、y轴加速度</span>
  <span class="token comment" spellcheck="true">// x轴范围[-1, 1]     向左/向右</span>
  <span class="token comment" spellcheck="true">// y轴范围[-20, -18]  向上</span>
  ball<span class="token punctuation">.</span>vx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>vy <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">;</span>

  balls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ball<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span>ball<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// y轴速度向量增加重力加速度，最多40帧后y>0，ball向下运动</span>
  ball<span class="token punctuation">.</span>vy <span class="token operator">+</span><span class="token operator">=</span> gravity<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 设置ball的x、y轴合成加速度</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> ball<span class="token punctuation">.</span>vx<span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> ball<span class="token punctuation">.</span>vy<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 如果超出边界</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> canvas<span class="token punctuation">.</span>width <span class="token operator">||</span> ball<span class="token punctuation">.</span>x <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span>
    ball<span class="token punctuation">.</span>y <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">||</span> ball<span class="token punctuation">.</span>y <span class="token operator">+</span> ball<span class="token punctuation">.</span>y <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 重新定位ball</span>
    ball<span class="token punctuation">.</span>x <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    ball<span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 重新生成ball的x、y轴加速度</span>
    ball<span class="token punctuation">.</span>vx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    ball<span class="token punctuation">.</span>vy <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  ball<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 遍历balls数组中的所有元素，将每个元素作为参数传入draw函数</span>
  balls<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="屏幕环绕"><a href="#屏幕环绕" class="headerlink" title="屏幕环绕"></a>屏幕环绕</h4><p>如果一个物体从屏幕左边移出，它就会在屏幕右边再次出现；反之亦然。<br>很容易猜到，当物体从屏幕上方移出时，它又会出现在屏幕下方。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// screen wrapping</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ship<span class="token punctuation">.</span>x <span class="token operator">-</span> ship<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">></span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ship<span class="token punctuation">.</span>x <span class="token operator">=</span> left <span class="token operator">-</span> ship<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ship<span class="token punctuation">.</span>x <span class="token operator">+</span> ship<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&lt;</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ship<span class="token punctuation">.</span>x <span class="token operator">=</span> right <span class="token operator">+</span> ship<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ship<span class="token punctuation">.</span>y <span class="token operator">-</span> ship<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">></span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ship<span class="token punctuation">.</span>y <span class="token operator">=</span> top <span class="token operator">-</span> ship<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ship<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> top <span class="token operator">-</span> ship<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ship<span class="token punctuation">.</span>y <span class="token operator">=</span> bottom <span class="token operator">+</span> ship<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
ship<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="反弹"><a href="#反弹" class="headerlink" title="反弹"></a>反弹</h4><p>如果物体从屏幕的左边或右边越界，就对它的x轴速度向量取反。<br>同理，如果物体从上方或下方越界，则对它的y轴速度向量取反。<br>对单轴速度向量取反非常简单，只须将对应的值乘以-1即可。</p>
<pre class=" language-js"><code class="language-js">vx <span class="token operator">*</span><span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
vy <span class="token operator">*</span><span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></code></pre>
<p>反弹的步骤：</p>
<ul>
<li>检查物体是否越过任意边界；</li>
<li>如果发生越界，立即将物体置回边界；</li>
<li>反转物体的速度向量的方向。</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">=</span> right <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
  vx <span class="token operator">*</span><span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">=</span> left <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
  vx <span class="token operator">*</span><span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>反弹系数<code>bounce</code>：</li>
</ul>
<p>在反弹的过程中小球损失了一部分能量。重点在于球体在发生反弹后的运动速度比之前要慢一些。换句话讲，它在反弹的坐标轴上的速度向量变小了。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 定义bounce</span>
<span class="token keyword">var</span> bounce <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ball<span class="token punctuation">.</span>x <span class="token operator">=</span> right <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    vx <span class="token operator">*</span><span class="token operator">=</span> bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ball<span class="token punctuation">.</span>x <span class="token operator">=</span> left <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    vx <span class="token operator">*</span><span class="token operator">=</span> bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>y <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ball<span class="token punctuation">.</span>y <span class="token operator">=</span> bottom <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    vy <span class="token operator">*</span><span class="token operator">=</span> bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>y <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ball<span class="token punctuation">.</span>y <span class="token operator">=</span> top <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    vy <span class="token operator">*</span><span class="token operator">=</span> bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="摩擦力"><a href="#摩擦力" class="headerlink" title="摩擦力"></a>摩擦力</h3><p>摩擦力只会改变速度向量的大小而不会改变它的方向。换句话说，摩擦力只能将物体的速度降至零，但它无法让物体掉头向相反的方向移动。</p>
<h4 id="摩擦力，正确方法"><a href="#摩擦力，正确方法" class="headerlink" title="摩擦力，正确方法"></a>摩擦力，正确方法</h4><p>1.定义<code>friction</code>：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> friction <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span></code></pre>
<p>2.在<code>drawFrame</code>函数中：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token comment" spellcheck="true">// 定义速度和角度</span>
  <span class="token keyword">var</span> speed <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>vx <span class="token operator">*</span> vx <span class="token operator">+</span> vy <span class="token operator">*</span> vy<span class="token punctuation">)</span><span class="token punctuation">,</span>
      angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>vy<span class="token punctuation">,</span> vx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 如果speed变量大于friction，二者就相减；否则，让speed变为0</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>speed <span class="token operator">></span> friction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    speed <span class="token operator">-</span><span class="token operator">=</span> friction<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    speed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// 重新计算vx、vy并将它们加到球体的位置上</span>
  vx <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> speed<span class="token punctuation">;</span>
  vy <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> speed<span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> vx<span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> vy<span class="token punctuation">;</span>

  ball<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="摩擦力，简便方法"><a href="#摩擦力，简便方法" class="headerlink" title="摩擦力，简便方法"></a>摩擦力，简便方法</h4><p>将x、y轴上的速度向量乘以一个百分数即可，一个接近0.9的系数就能够很好地模拟出摩擦力的效果，当然可以根据你的观察做出相应的调整。</p>
<p>1.定义<code>friction</code>：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> friction <span class="token operator">=</span> <span class="token number">0.9</span><span class="token punctuation">;</span></code></pre>
<p>2.在<code>drawFrame</code>函数中：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token comment" spellcheck="true">// 比较vx与一个指定的较小的值从而节省一些不必要的计算</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>vx<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 模拟摩擦力</span>
    vx <span class="token operator">*</span><span class="token operator">=</span> friction<span class="token punctuation">;</span>
    ball<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> vx<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// 比较vy与一个指定的较小的值从而节省一些不必要的计算</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 模拟摩擦力</span>
    vy <span class="token operator">*</span><span class="token operator">=</span> friction<span class="token punctuation">;</span>
    ball<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> vy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  ball<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="摩擦力应用"><a href="#摩擦力应用" class="headerlink" title="摩擦力应用"></a>摩擦力应用</h4><p>1.加入一个摩擦力变量：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> friction <span class="token operator">=</span> <span class="token number">0.97</span><span class="token punctuation">;</span></code></pre>
<p>2.以宇宙飞船为例，将<code>drawFrame</code>函数修改为如下代码：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token comment" spellcheck="true">// 增加x、y轴上的加速度</span>
  vx <span class="token operator">+</span><span class="token operator">=</span> ax<span class="token punctuation">;</span>
  vy <span class="token operator">+</span><span class="token operator">=</span> ay<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 加入摩擦力变量</span>
  vx <span class="token operator">*</span><span class="token operator">=</span> friction<span class="token punctuation">;</span>
  vy <span class="token operator">*</span><span class="token operator">=</span> friction<span class="token punctuation">;</span>
  ship<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> vx<span class="token punctuation">;</span>
  ship<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> vy<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// screen wrapping</span>
  <span class="token comment" spellcheck="true">// ...</span>

  ship<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="用户交互：移动物体"><a href="#用户交互：移动物体" class="headerlink" title="用户交互：移动物体"></a>用户交互：移动物体</h2><p>交互动画的一个主要目标是创建出流畅的用户体验，其中大多数的用户交互都是通过鼠标和触摸屏实现的。</p>
<h3 id="按下及释放物体"><a href="#按下及释放物体" class="headerlink" title="按下及释放物体"></a>按下及释放物体</h3><p>在动画中，鼠标事件只能被HTML DOM树上的canvas元素所捕获。</p>
<ul>
<li><code>mousedown</code></li>
<li><code>mouseup</code></li>
<li><code>mousemove</code></li>
</ul>
<h4 id="使用触摸事件"><a href="#使用触摸事件" class="headerlink" title="使用触摸事件"></a>使用触摸事件</h4><ul>
<li><code>touchstart</code></li>
<li><code>touchend</code></li>
<li><code>touchmove</code></li>
</ul>
<h3 id="拖拽对象"><a href="#拖拽对象" class="headerlink" title="拖拽对象"></a>拖拽对象</h3><pre class=" language-js"><code class="language-js">canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">containsPoint</span><span class="token punctuation">(</span>ball<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mouse<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mouse<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    offsetX <span class="token operator">=</span> mouse<span class="token punctuation">.</span>x <span class="token operator">-</span> ball<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    offsetY <span class="token operator">=</span> mouse<span class="token punctuation">.</span>y <span class="token operator">-</span> ball<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> onMouseUp<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> onMouseMove<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onMouseUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  canvas<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> onMouseUp<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> onMouseMove<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onMouseMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">=</span> mouse<span class="token punctuation">.</span>x <span class="token operator">-</span> offsetX<span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>y <span class="token operator">=</span> mouse<span class="token punctuation">.</span>y <span class="token operator">-</span> offsetY<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="结合运动代码的拖拽"><a href="#结合运动代码的拖拽" class="headerlink" title="结合运动代码的拖拽"></a>结合运动代码的拖拽</h4><p>我们可以尝试为该动画引入一些速度、加速度以及反弹的内容，使其变得更加有趣。</p>
<p>1.声明一个<code>isMouseDown</code>变量：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> isMouseDown <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code></pre>
<p>2.在mousedown事件中设置<code>isMouseDown = true</code>：</p>
<pre class=" language-js"><code class="language-js">canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">containsPoint</span><span class="token punctuation">(</span>ball<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mouse<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mouse<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
    isMouseDown <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 开始拖拽时，不应该伴随有其他运动</span>
    vx <span class="token operator">=</span> vy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>3.在mouseup事件中设置<code>isMouseDown = false</code>：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> onMouseUp <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  isMouseDown <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p>4.将有关边界检查的代码都移入<code>checkBoundaries</code>函数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> checkBoundaries <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      right <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
      top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      bottom <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>

  vy <span class="token operator">+</span><span class="token operator">=</span> gravity<span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> vx<span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span>y <span class="token operator">+</span><span class="token operator">=</span> vy<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ball<span class="token punctuation">.</span>x <span class="token operator">=</span> right <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    vx <span class="token operator">*</span><span class="token operator">=</span> bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>x <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ball<span class="token punctuation">.</span>x <span class="token operator">=</span> left <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    vx <span class="token operator">*</span><span class="token operator">=</span> bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>y <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius <span class="token operator">></span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ball<span class="token punctuation">.</span>y <span class="token operator">=</span> bottom <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    vy <span class="token operator">*</span><span class="token operator">=</span> bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ball<span class="token punctuation">.</span>y <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius <span class="token operator">&lt;</span> top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ball<span class="token punctuation">.</span>y <span class="token operator">=</span> top <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    vy <span class="token operator">*</span><span class="token operator">=</span> bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>5.在<code>drawFrame</code>函数中：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>

  <span class="token comment" spellcheck="true">// 鼠标按下时</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMouseDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 检查边界</span>
    <span class="token function">checkBoundaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  ball<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="投掷"><a href="#投掷" class="headerlink" title="投掷"></a>投掷</h3><p>在动画中如何表现投掷呢？用鼠标选中一个物体，拖拽着它向某个方向移动，松开鼠标后物体沿着拖拽的方向继续移动。</p>
<p><strong>旧的位置+速度向量=新的位置</strong> =&gt; <strong>速度向量=新的位置-旧的位置</strong></p>
<p>首先，声明变量oldX、oldY为小球旧的x、y坐标位置，在小球开始拖拽时保存；<br>在drawFrame函数中检查鼠标是否按下，如果按下，调用trackVelocity函数更新小球的拖拽速度：</p>
<pre class=" language-js"><code class="language-js">canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">containsPoint</span><span class="token punctuation">(</span>ball<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mouse<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mouse<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>

    isMouseDown <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 保存小球的旧坐标位置</span>
    oldX <span class="token operator">=</span> ball<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    oldY <span class="token operator">=</span> ball<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> onMouseUp<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> onMouseMove<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> trackVelocity <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 更新小球的速度向量</span>
  vx <span class="token operator">=</span> ball<span class="token punctuation">.</span>x <span class="token operator">-</span> oldX<span class="token punctuation">;</span>
  vy <span class="token operator">=</span> ball<span class="token punctuation">.</span>y <span class="token operator">-</span> oldY<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 更新小球的旧坐标位置</span>
  oldX <span class="token operator">=</span> ball<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
  oldY <span class="token operator">=</span> ball<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMouseDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 鼠标按下时更新小球的速度向量和旧坐标位置</span>
    <span class="token function">trackVelocity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">checkBoundaries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  ball<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
]]></content>
      <categories>
        <category>HTML5+JavaScript动画基础</category>
      </categories>
      <tags>
        <tag>HTML5</tag>
        <tag>JavaScript</tag>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML5+JavaScript动画基础笔记一(JavaScript动画基础)</title>
    <url>/2019/10/26/HTML5-JavaScript%E5%8A%A8%E7%94%BB%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<blockquote>
<p>《HTML5+JavaScript动画基础》</p>
</blockquote>
<h2 id="动画的基本概念"><a href="#动画的基本概念" class="headerlink" title="动画的基本概念"></a>动画的基本概念</h2><h3 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h3><p>动画并不仅仅是运动，它还包括对任意可视属性的变化，如形状、大小、方向与颜色等。</p>
<p>时间是动画的基本组成部分。</p>
<h3 id="帧与运动"><a href="#帧与运动" class="headerlink" title="帧与运动"></a>帧与运动</h3><p>帧是一系列离散的图像以极快的速度连续播放从而模拟物体运动或变化。<br>将频率保持在每秒24帧，人们就会把这些帧视为一张运动的图像。如果低于此频率，人们就会察觉到跳帧，也就打破了这种运动的假象。但人的眼睛似乎无法区分比这更高的频率，每秒播放100帧并不会让你的动画显得更真实，尽管更高的帧率在电脑动画中会带来更好的互动感和流畅度。</p>
<a id="more"></a>
<h4 id="记录帧"><a href="#记录帧" class="headerlink" title="记录帧"></a>记录帧</h4><p>对一个系统在某一特定时间点的记录。<br>这个系统可以是一个人穿越房间，时间可以是当他走到房间中间的时候，而此时的记录就是他走到房间中间的那张照片。<br>另一方面，系统也可以是一个虚拟对象集合，这样，你的动画就不再是一系列静止的图像，而是一系列关于图像的描述信息。将这一思想进一步演化就衍生出了程序帧。</p>
<h4 id="程序帧"><a href="#程序帧" class="headerlink" title="程序帧"></a>程序帧</h4><p>你可以将动画简化为起始帧的一个描述，而后遵循某些特定的规则构建后续帧。<br>如果你想保持一定的帧率，那么给予电脑的处理时间（毫秒级）就极其有限。如果电脑无法及时完成计算，帧率就会下降。<br>而基于图像播放的动画就无须关心场景中的内容以及它有多复杂，更加准时。</p>
<h3 id="动态动画与静态动画"><a href="#动态动画与静态动画" class="headerlink" title="动态动画与静态动画"></a>动态动画与静态动画</h3><p>静态动画：每一帧，从开始到结束都是预先定义好的。<br>动态动画：根据用户提供的值计算物体的位置（键盘和鼠标设定动画中的一些参数等），实现与用户的交互。</p>
<h2 id="动画的JavaScript基础"><a href="#动画的JavaScript基础" class="headerlink" title="动画的JavaScript基础"></a>动画的JavaScript基础</h2><h3 id="HTML5简介"><a href="#HTML5简介" class="headerlink" title="HTML5简介"></a>HTML5简介</h3><p>HTML5是最新一代HTML，该语言用于将内容结构化为有组织的层次并展现在万维网上。HTML5是一系列独立功能的集合。</p>
<h4 id="对canvas的支持"><a href="#对canvas的支持" class="headerlink" title="对canvas的支持"></a>对canvas的支持</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>400<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>400<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

  <span class="token comment" spellcheck="true">&lt;!-- 警告消息仅在浏览器无法识别canvas标签时才显示 --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>This browser does not support the <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">></span></span>canvas<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">></span></span> element.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Success! The canvas element is supported."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>主流浏览器对canvas元素的支持：</p>
<table>
<thead>
<tr>
<th>IE</th>
<th>Firefox</th>
<th>Safari</th>
<th>Chrome</th>
<th>Opera</th>
<th>iOS Safari</th>
<th>Andriod Browser</th>
</tr>
</thead>
<tbody><tr>
<td>9</td>
<td>3.5</td>
<td>3.2</td>
<td>9</td>
<td>10.6</td>
<td>3.2</td>
<td>2.1</td>
</tr>
</tbody></table>
<h4 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h4><p>越来越多的人开始使用移动电话与平板电脑而不是传统的台式机来访问Web，开发者需要兼顾到各种不同设备上的性能差异。针对各种不同平台的测试和度量是确保代码能够表现良好的唯一手段。</p>
<h3 id="用代码实现动画"><a href="#用代码实现动画" class="headerlink" title="用代码实现动画"></a>用代码实现动画</h3><h4 id="动画循环"><a href="#动画循环" class="headerlink" title="动画循环"></a>动画循环</h4><pre class="mermaid">gantt
dateFormat  YYYY-MM-DD
title 逐帧动画

section 逐帧动画
显示第1帧            :done,    des1, 2014-01-06, 1d
显示第2帧            :active,  des2, after des1, 1d
显示第3帧            :         des3, after des2, 1d
显示第n帧            :         des4, after des3, 1d</pre>

<p>渲染并显示每一帧：</p>
<pre class="mermaid">graph TD;
  渲染第1帧-->显示第1帧;
  显示第1帧-->渲染第2帧;
  渲染第2帧-->显示第2帧;
  显示第2帧-->...;</pre>

<p>脚本动画：</p>
<pre class="mermaid">sequenceDiagram
    participant 获取初始状态
    participant 渲染帧
    participant 应用规则
    participant 显示帧
    获取初始状态->>渲染帧: 步骤1
    渲染帧->>应用规则: 步骤2
    loop 应用规则结束
        应用规则->>渲染帧: 否
        应用规则->>显示帧: 是 步骤3
    end</pre>

<p>例如创建一个JavaScript定时器启动循环：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> drawFrame <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ball<span class="token punctuation">.</span>x <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  ball<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 1s 60帧 ≈ 17ms一帧</span>
window<span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>JavaScript定时器并不是为实现动画设计的，因为它无法达到毫秒级的精确度（每个浏览器的定时器分辨率不同），所以无法依赖它实现高质量的动画。</p>
<h4 id="使用requestAnimationFrame的动画循环"><a href="#使用requestAnimationFrame的动画循环" class="headerlink" title="使用requestAnimationFrame的动画循环"></a>使用requestAnimationFrame的动画循环</h4><p>window.requestAnimationFrame函数接收一个回调函数作为参数，并确保在重绘屏幕前执行该回调函数。<br>在某些浏览器中，还支持一个可选的第二参数，可以通过它指定的一个HTML元素提供动画的可视区域。</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> drawFrame <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// animation code...</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>兼容实现：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>requestAnimationFrame<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>requestAnimationFrame <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>webkitRequestAnimationFrame <span class="token operator">||</span>
                                  window<span class="token punctuation">.</span>mozRequestAnimationFrame <span class="token operator">||</span>
                                  window<span class="token punctuation">.</span>oRequestAnimationFrame <span class="token operator">||</span>
                                  window<span class="token punctuation">.</span>msRequestAnimationFrame <span class="token operator">||</span>
                                  <span class="token keyword">function</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="JavaScript对象"><a href="#JavaScript对象" class="headerlink" title="JavaScript对象"></a>JavaScript对象</h3><ul>
<li>arr.forEach和for循环</li>
</ul>
<p>由于执行函数需要一些额外的计算，采用函数实现遍历的一个缺点就是其速度会慢于for循环。</p>
<h3 id="用户交互"><a href="#用户交互" class="headerlink" title="用户交互"></a>用户交互</h3><h4 id="事件与事件处理程序"><a href="#事件与事件处理程序" class="headerlink" title="事件与事件处理程序"></a>事件与事件处理程序</h4><ul>
<li>监听器决定一个元素是否应该响应某个事件。</li>
<li>事件处理程序是当事件发生时将要调用的函数。</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 添加监听器</span>
element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> handler <span class="token punctuation">[</span><span class="token punctuation">,</span> useCapture<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 删除监听器</span>
element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> handler <span class="token punctuation">[</span><span class="token punctuation">,</span> useCapture<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="鼠标位置"><a href="#鼠标位置" class="headerlink" title="鼠标位置"></a>鼠标位置</h4><p>每个鼠标事件有两个属性用于确定鼠标的当前位置：pageX与pageY。<br>不是所有的浏览器都支持这两个属性，所以可能要用到clientX与clientY。</p>
<p>创建utils.js，封装兼容的工具函数captureMouse：</p>
<pre class=" language-js"><code class="language-js">utils<span class="token punctuation">.</span>captureMouse <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> mouse <span class="token operator">=</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>pageX <span class="token operator">||</span> event<span class="token punctuation">.</span>pageY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      x <span class="token operator">=</span> event<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span>
      y <span class="token operator">=</span> event<span class="token punctuation">.</span>pageY<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

      x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">+</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollLeft <span class="token operator">+</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollLeft<span class="token punctuation">;</span>
      y <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">+</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    x <span class="token operator">-</span><span class="token operator">=</span> element<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>
    y <span class="token operator">-</span><span class="token operator">=</span> element<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> mouse<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="触摸事件"><a href="#触摸事件" class="headerlink" title="触摸事件"></a>触摸事件</h4><ul>
<li>touchstart</li>
<li>touchend</li>
<li>touchmove</li>
</ul>
<pre class=" language-js"><code class="language-js">window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> onTouchEvent <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> onTouchEvent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchend'</span><span class="token punctuation">,</span> onTouchEvent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span> onTouchEvent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="触摸位置"><a href="#触摸位置" class="headerlink" title="触摸位置"></a>触摸位置</h4><p>在utils.js创建工具函数：</p>
<pre class=" language-js"><code class="language-js">utils<span class="token punctuation">.</span>captureTouch <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> touch <span class="token operator">=</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    isPressed<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    touch<span class="token punctuation">.</span>isPressed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchend'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    touch<span class="token punctuation">.</span>isPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    touch<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    touch<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span>
      touch_event <span class="token operator">=</span> event<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>touch_event<span class="token punctuation">.</span>pageX <span class="token operator">||</span> touch_event<span class="token punctuation">.</span>pageY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      x <span class="token operator">=</span> touch_event<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span>
      y <span class="token operator">=</span> touch_event<span class="token punctuation">.</span>pageY<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      x <span class="token operator">=</span> touch_event<span class="token punctuation">.</span>clientX <span class="token operator">+</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollLeft <span class="token operator">+</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollLeft<span class="token punctuation">;</span>
      y <span class="token operator">=</span> touch_event<span class="token punctuation">.</span>clientY <span class="token operator">+</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    x <span class="token operator">-</span><span class="token operator">=</span> element<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>
    y <span class="token operator">-</span><span class="token operator">=</span> element<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>

    touch<span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    touch<span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> touch<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>使用：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 初始化一个touch对象</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    touch <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">captureTouch</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> onTouchEvent <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>touch<span class="token punctuation">.</span>isPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"x: "</span> <span class="token operator">+</span> touch<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">", y: "</span> <span class="token operator">+</span> touch<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> onTouchEvent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// ...</span></code></pre>
<h4 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h4><ul>
<li>keydown</li>
<li>keyup</li>
</ul>
<p>绑定到全局的window对象：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> onKeyboardEvent <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> onKeyboardEvent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> onKeyboardEvent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// ...</span></code></pre>
<h2 id="动画中的三角学"><a href="#动画中的三角学" class="headerlink" title="动画中的三角学"></a>动画中的三角学</h2><p>学习三角学主要就是掌握各种边角关系，事实上，用于实现基本动画的90%的三角学知识都可以归结于两个函数：Math.sin与Math.cos。</p>
<h3 id="三角学"><a href="#三角学" class="headerlink" title="三角学"></a>三角学</h3><p>三角学主要研究三角形以及它们的边角关系。</p>
<h3 id="角"><a href="#角" class="headerlink" title="角"></a>角</h3><p>一个角是由两条相交线形成的形状或两条线之间的空间。空间越大，角的度数也就越高。</p>
<h4 id="弧度和角度"><a href="#弧度和角度" class="headerlink" title="弧度和角度"></a>弧度和角度</h4><p>角的度量单位分别有角度和弧度了两大系统。<br>在衡量角的大小的时候，计算机更倾向于使用弧度的概念。</p>
<p>一弧度约等于57.2958°。π约等于3.1416，<code>360° = 2π = 6.2832弧度 = 1个圆</code></p>
<h4 id="canvas坐标系"><a href="#canvas坐标系" class="headerlink" title="canvas坐标系"></a>canvas坐标系</h4><ul>
<li>元素坐标系：(0,0)在左上角，往右x增大，往下y增大；往左x越小（负数），往上y越小（负数）</li>
<li>角度度量：顺时针旋转为正数，逆时针旋转为负数，和常见的角度测量相反</li>
</ul>
<h4 id="三角形的边"><a href="#三角形的边" class="headerlink" title="三角形的边"></a>三角形的边</h4><p>针对直角三角形：</p>
<ul>
<li>直角边 * 2</li>
<li>斜边</li>
</ul>
<p>对于角：</p>
<ul>
<li>邻边 * 2</li>
<li>对边</li>
</ul>
<h4 id="三角函数"><a href="#三角函数" class="headerlink" title="三角函数"></a>三角函数</h4><ul>
<li><strong>正弦</strong>：与该角相对的直角边与斜边的比例<code>Math.sin(angle)</code> [angle = angle * Math.PI / 180]</li>
<li><strong>余弦</strong>：角的邻边与斜边的比例<code>Math.cos(angle)</code></li>
<li>正切：角的对边与邻边的比例<code>Math.tan(angle)</code></li>
<li>反正弦：输入比率得到角的弧度<code>Math.asin(ratio)</code></li>
<li>反余弦：输入比率得到角的弧度<code>Math.acos(ratio)</code></li>
<li>反正切：输入角的对边与邻边比率，得到角的弧度<code>Math.atan(ratio)</code></li>
<li><strong>反正切2</strong>：输入角的对边与邻边，得到角的弧度<code>Math.atan2(y,x)</code> [y: 对边的长度，x: 邻边的长度]</li>
</ul>
<h3 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h3><p>创建arrow.js，并创建Arrow类：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> Arrow <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'#ff0'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>rotation <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Arrow<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>draw <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>cvsCtx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>这样，每当需要一个箭头对象时，只须调用<code>new Arrow()</code>方法即可。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            mouse <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">captureMouse</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">,</span>
            arrow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Arrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

arrow<span class="token punctuation">.</span>x <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
arrow<span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span> drawFrame <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// dx 邻边</span>
  <span class="token comment" spellcheck="true">// dy 对边</span>
  <span class="token keyword">var</span> dx <span class="token operator">=</span> mouse<span class="token punctuation">.</span>x <span class="token operator">-</span> arrow<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
      dy <span class="token operator">=</span> mouse<span class="token punctuation">.</span>y <span class="token operator">-</span> arrow<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 设置arrow的旋转弧度</span>
  arrow<span class="token punctuation">.</span>rotation <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> dx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  arrow<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="波"><a href="#波" class="headerlink" title="波"></a>波</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// ...</span>
<span class="token comment" spellcheck="true">// 线性运动</span>
y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span>单位<span class="token punctuation">;</span>
angle <span class="token operator">+</span><span class="token operator">=</span> speed<span class="token punctuation">;</span></code></pre>
<h3 id="圆与椭圆"><a href="#圆与椭圆" class="headerlink" title="圆与椭圆"></a>圆与椭圆</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// ...</span>
<span class="token comment" spellcheck="true">// 圆周运动</span>
x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token operator">*</span> radius<span class="token punctuation">;</span>
y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token operator">*</span> radius<span class="token punctuation">;</span>
angle <span class="token operator">+</span><span class="token operator">=</span> speed<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 椭圆运动</span>
<span class="token comment" spellcheck="true">// radiusX !== radiusY</span>
x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token operator">*</span> radiusX<span class="token punctuation">;</span>
y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token operator">*</span> radiusY<span class="token punctuation">;</span>
angle <span class="token operator">+</span><span class="token operator">=</span> speed<span class="token punctuation">;</span></code></pre>
<h3 id="勾股定律"><a href="#勾股定律" class="headerlink" title="勾股定律"></a>勾股定律</h3><p>直角三角形的两条边的平方和等于斜边的平方：<code>a² + b² = c²</code></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// dx, dy 直角边</span>
<span class="token comment" spellcheck="true">// dist 斜边</span>
dist <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="重要公式"><a href="#重要公式" class="headerlink" title="重要公式"></a>重要公式</h3><p>角度和弧度的转换公式：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 三角学基础函数</span>
sine of angle <span class="token operator">=</span> opposite / hypotenuse
cosine of angle <span class="token operator">=</span> adjacent / hypotenuse
tangent of angle <span class="token operator">=</span> opposite / adjacent</code></pre>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 角度与弧度互转</span>
radians <span class="token operator">=</span> degrees <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">180</span>
degrees <span class="token operator">=</span> radians <span class="token operator">*</span> <span class="token number">180</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span>PI

<span class="token comment" spellcheck="true">// 朝鼠标(或任意一点)旋转</span>
dx <span class="token operator">=</span> mouse<span class="token punctuation">.</span>x <span class="token operator">-</span> object<span class="token punctuation">.</span>x
dy <span class="token operator">=</span> mouse<span class="token punctuation">.</span>y <span class="token operator">-</span> object<span class="token punctuation">.</span>y
object<span class="token punctuation">.</span>rotation <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> dx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">180</span> <span class="token operator">/</span>Math<span class="token punctuation">.</span>PI

<span class="token comment" spellcheck="true">// 创建波</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> drawFrame <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

  value <span class="token operator">=</span> center <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> range<span class="token punctuation">;</span>
  angle <span class="token operator">+</span><span class="token operator">=</span> speed<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 创建圆形</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> drawFrame <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

  xposition <span class="token operator">=</span> centerX <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>
  yposition <span class="token operator">=</span> centerY <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>
  angle <span class="token operator">+</span><span class="token operator">=</span> speed<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 创建椭圆形</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> drawFrame <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

  xposition <span class="token operator">=</span> centerX <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radiusX<span class="token punctuation">;</span>
  yposition <span class="token operator">=</span> centerY <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radiusY<span class="token punctuation">;</span>
  angle <span class="token operator">+</span><span class="token operator">=</span> speed<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 获取两点间的距离</span>
dx <span class="token operator">=</span> x2 <span class="token operator">-</span> x1<span class="token punctuation">;</span>
dy <span class="token operator">=</span> y2 <span class="token operator">-</span> y1<span class="token punctuation">;</span>
dist <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="渲染技术"><a href="#渲染技术" class="headerlink" title="渲染技术"></a>渲染技术</h2><h3 id="canvas上的颜色"><a href="#canvas上的颜色" class="headerlink" title="canvas上的颜色"></a>canvas上的颜色</h3><ul>
<li>#RRGGBB: 十六进制</li>
<li>#RGB: 十六进制</li>
<li>rgb(R, G, B): 函数表达式</li>
<li>rgba(R, G, B, A): 包含透明度的函数表达式</li>
</ul>
<p><strong>二进制格式表示颜色</strong><br>24位颜色系统：一个24位（二进制）的颜色值可以经由0~16777215（256<em>256</em>256，256由8位二进制数字0/1表示）之间的任意一个整数表示。</p>
<p>32位颜色系统：其中一个额外的8位数字表示颜色的透明度。</p>
<p><strong>十六进制格式表示颜色</strong>：加上<code>#</code>号作为前缀。</p>
<table>
<thead>
<tr>
<th>十六进制</th>
<th>十进制</th>
<th>颜色字符串</th>
<th>二进制</th>
</tr>
</thead>
<tbody><tr>
<td>0xA</td>
<td>10</td>
<td>\\\\\\\#A</td>
<td>1010</td>
</tr>
<tr>
<td>0xF</td>
<td>15</td>
<td>\\\\\\\#F</td>
<td>1111</td>
</tr>
<tr>
<td>0x10</td>
<td>16</td>
<td>\\\\\\\#10</td>
<td>10000</td>
</tr>
<tr>
<td>0xFF0000</td>
<td>16711680</td>
<td>\\\\\\\#FF0000</td>
<td>11111111 00000000 00000000</td>
</tr>
</tbody></table>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 0x2b3: 2*256 + b*16 + 3*1 = 2*256 + 11*16 + 3*1 = 691</span>

<span class="token comment" spellcheck="true">// 十进制 转 十六进制</span>
<span class="token punctuation">(</span><span class="token number">16711680</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 输出：ff0000</span>

<span class="token comment" spellcheck="true">// 十六进制 转 十进制</span>
<span class="token punctuation">(</span><span class="token number">0xFF0000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 输出：16711680 &lt;-- Math.pow(16,5)*15+Math.pow(16,4)*15</span>

<span class="token comment" spellcheck="true">// 十六进制 转 二进制</span>
<span class="token punctuation">(</span><span class="token number">0xFF0000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 输出：111111110000000000000000</span></code></pre>
<h4 id="色彩合成"><a href="#色彩合成" class="headerlink" title="色彩合成"></a>色彩合成</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 按位组合</span>

<span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token number">0xff</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">16</span> <span class="token operator">|</span> <span class="token number">0x55</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">0x53</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 等同于</span>
<span class="token keyword">var</span> color <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">16</span> <span class="token operator">|</span> <span class="token number">85</span> <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token number">243</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &lt;&lt; 按位左移操作符</span>
<span class="token comment" spellcheck="true">// 根据指定的位数将一个数值的二进制格式向左移动若干位置</span>
<span class="token comment" spellcheck="true">// 0xff -> 11111111 左移16位   ->  111111110000000000000000</span>
<span class="token comment" spellcheck="true">// 0x55 -> 01010101 左移8位    ->  000000000101010100000000</span>
<span class="token comment" spellcheck="true">// 0x53 -> 11110011 无左移     ->  000000000000000011110011</span>

<span class="token comment" spellcheck="true">// | 或操作符</span>
<span class="token comment" spellcheck="true">// 如果R或G或B为1，则结果为1，这会将三原色合并为一个单独的颜色值</span></code></pre>
<h4 id="提取三原色"><a href="#提取三原色" class="headerlink" title="提取三原色"></a>提取三原色</h4><p>从一个颜色组合值中提取出红色、绿色和蓝色：</p>
<pre class=" language-js"><code class="language-js">red <span class="token operator">=</span> color <span class="token operator">></span><span class="token operator">></span> <span class="token number">16</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
green <span class="token operator">=</span> color <span class="token operator">></span><span class="token operator">></span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
blue <span class="token operator">=</span> color <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// >> 按位右移操作符</span>
<span class="token comment" spellcheck="true">// 111111110101010111110011 右移16位  ->  11111111</span>
<span class="token comment" spellcheck="true">// 111111110101010111110011 右移8位   ->  1111111101010101</span>
<span class="token comment" spellcheck="true">// 111111110101010111110011 无左移    ->  111111110101010111110011</span>

<span class="token comment" spellcheck="true">// &amp; 与操作符</span>
<span class="token comment" spellcheck="true">// 其中一个为0，则结果为0</span>
<span class="token comment" spellcheck="true">// green:</span>
<span class="token comment" spellcheck="true">//      1111111101010101</span>
<span class="token comment" spellcheck="true">//      0000000011111111</span>
<span class="token comment" spellcheck="true">// 由于所有代表红色的二进制位都与0做比较，因此它们的结果自然为0，所以最终结果为：</span>
<span class="token comment" spellcheck="true">//      0000000001010101 = 01010101 = 0x55</span></code></pre>
<h4 id="透明度"><a href="#透明度" class="headerlink" title="透明度"></a>透明度</h4><p>alpha值是0~1范围内的一个小数。</p>
<h4 id="与颜色相关的工具函数"><a href="#与颜色相关的工具函数" class="headerlink" title="与颜色相关的工具函数"></a>与颜色相关的工具函数</h4><ul>
<li>colorToRGB: 接受一个表示颜色值的数字或十六进制字符串作为输入参数，然后抽取出各个独立的三原色，并将它们拼接成一个CSS风格的函数作为返回值。</li>
<li>parseColor: 将一个颜色的数字值转换为一个十六进制格式的字符串，或者相反。</li>
</ul>
<pre class=" language-js"><code class="language-js">utils<span class="token punctuation">.</span>colorToRGB <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>color<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> color <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    color <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  alpha <span class="token operator">=</span> <span class="token punctuation">(</span>alpha <span class="token operator">===</span> undefined<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> alpha<span class="token punctuation">;</span>

  <span class="token keyword">var</span> r <span class="token operator">=</span> color <span class="token operator">></span><span class="token operator">></span> <span class="token number">16</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">,</span>
      g <span class="token operator">=</span> color <span class="token operator">></span><span class="token operator">></span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">,</span>
      b <span class="token operator">=</span> color <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">,</span>
      a <span class="token operator">=</span> <span class="token punctuation">(</span>alpha <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>alpha <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> alpha<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"rgb("</span> <span class="token operator">+</span> r <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> g <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"rgba("</span> <span class="token operator">+</span> r <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> g <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

utils<span class="token punctuation">.</span>parseColor <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>color<span class="token punctuation">,</span> toNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>toNumber <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> color <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>color <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> color <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'#'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      color <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> color <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      color <span class="token operator">=</span> <span class="token string">'#'</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'00000'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>color <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="绘图API"><a href="#绘图API" class="headerlink" title="绘图API"></a>绘图API</h3><ul>
<li><code>strokeStyle</code></li>
<li><code>fillStyle</code></li>
<li><code>lineWidth</code></li>
<li><code>save()</code></li>
<li><code>restore()</code></li>
<li><code>beginPath()</code></li>
<li><code>closePath()</code></li>
<li><code>stroke()</code></li>
<li><code>lineTo(x, y)</code></li>
<li><code>moveTo(x, y)</code></li>
<li><code>quadraticCurveTo(cpx, cpy, x, y)</code></li>
<li><code>bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)</code></li>
<li><code>arcTo(x1, y1, x2, y2, radius)</code></li>
<li><code>arc(x, y, radius, startAngle, endAngle [, anticlockwise])</code></li>
<li><code>createLinearGradient(x0,y0, x1, y1)</code></li>
<li><code>createRadialGradient(x0, y0, r0, x1, y1, r1)</code></li>
<li><code>clearRect(x, y, width, height)</code></li>
<li><code>fillRect(x, y, width, height)</code></li>
</ul>
<h3 id="canvas上下文-context"><a href="#canvas上下文-context" class="headerlink" title="canvas上下文 context"></a>canvas上下文 context</h3><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 还可以是3d</span></code></pre>
<h3 id="使用clearRect消除图案"><a href="#使用clearRect消除图案" class="headerlink" title="使用clearRect消除图案"></a>使用clearRect消除图案</h3><pre class=" language-js"><code class="language-js">context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>优化：</p>
<ul>
<li>如果只影响到帧的一个局部区域，可以指定一个稍小的矩形</li>
<li>将多个canvas元素相互叠加</li>
</ul>
<p>线条外观：</p>
<ul>
<li>strokeStyle：线条颜色</li>
<li>lineWidth：线条在其路径上的宽度</li>
<li>lineCap：线条终点如何绘制[butt(默认): 平的, round: 圆形的, square: 一段延长线]</li>
<li>lineJoin：两条连接线的弯头部分如何绘制[round, bevel, miter(默认)]</li>
<li>miterLimit：lineJoin为miter时，可用于可控制两条相交线外侧交点与内侧交点的距离。</li>
</ul>
<h3 id="使用lineTo与moveTo绘制路径"><a href="#使用lineTo与moveTo绘制路径" class="headerlink" title="使用lineTo与moveTo绘制路径"></a>使用lineTo与moveTo绘制路径</h3><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 开始绘制一条新路径</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 指定一个起点</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 绘制一条到(0, -25)的直线，终点自动成为下一条线的起点</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 渲染</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="使用quadraticCurveTo绘制曲线"><a href="#使用quadraticCurveTo绘制曲线" class="headerlink" title="使用quadraticCurveTo绘制曲线"></a>使用quadraticCurveTo绘制曲线</h4><ul>
<li>start    x0, y0</li>
<li>end      x2, y2</li>
<li>between  x1, y1</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 没有穿过控制点的曲线</span>
<span class="token keyword">var</span> x1 <span class="token operator">=</span> mouse<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    y1 <span class="token operator">=</span> mouse<span class="token punctuation">.</span>y<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 穿过控制点的曲线</span>
<span class="token keyword">var</span> x1 <span class="token operator">=</span> mouse<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token punctuation">(</span>x0 <span class="token operator">+</span> x2<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
    y1 <span class="token operator">=</span> mouse<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token punctuation">(</span>y0 <span class="token operator">+</span> y2<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span></code></pre>
<pre class=" language-js"><code class="language-js">cvsCtx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">quadraticCurveTo</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="其他形式的曲线"><a href="#其他形式的曲线" class="headerlink" title="其他形式的曲线"></a>其他形式的曲线</h4><ul>
<li><code>bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)</code>: 增加一个到当前路径的点，并由三次贝塞尔曲线连接两个控制点</li>
<li><code>arcTo(cp1x, cp1y, cp2x, cp2y, radius)</code>: 使用两个控制点和指定半径为连接到前一个点的直线路径添加一个弧度</li>
<li><code>arc(x, y, radius, startAngle, endAngle [, antiClockwise])</code>: 为连接到前一个点的直线路径添加一个弧度</li>
</ul>
<h3 id="使用填充色创建图形"><a href="#使用填充色创建图形" class="headerlink" title="使用填充色创建图形"></a>使用填充色创建图形</h3><p>一般来说，绘图的顺序如下：</p>
<ul>
<li>beginPath</li>
<li>moveTo</li>
<li>lineStyle</li>
<li>fillStyle</li>
<li>一系列lineTo与quadraticCurveTo方法</li>
<li>closePath</li>
<li>fill</li>
<li>stroke</li>
</ul>
<p>前4个可以任意调换顺序。线条和填充的样式不是必须的。</p>
<h4 id="创建渐变填充色"><a href="#创建渐变填充色" class="headerlink" title="创建渐变填充色"></a>创建渐变填充色</h4><ul>
<li>线性渐变<code>cvsCtx.createLinearGradient(x0, y0, x1, y1)</code></li>
<li>放射性渐变<code>cvsCtx.createRadialGradient(c1.x, c1.y, c1.radius, c2.x, c2.y, c2.radius)</code></li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 添加渐变色</span>
<span class="token keyword">var</span> gradient <span class="token operator">=</span> cvsCtx<span class="token punctuation">.</span><span class="token function">createLinearGradient</span><span class="token punctuation">(</span>pt1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pt1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> pt2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> pt2<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'#fff'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gradient<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'#f00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 赋值渐变色</span>
cvsCtx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> gradient<span class="token punctuation">;</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="加载并绘制图片"><a href="#加载并绘制图片" class="headerlink" title="加载并绘制图片"></a>加载并绘制图片</h3><ul>
<li><code>drawImage(image, dx, dy)</code>                            (dx, dy)是左上角位置</li>
<li><code>drawImage(image, dx, dy, dw, dh)</code>                    (dw, dh)设定图片的宽度与高度</li>
<li><code>drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh)</code>    将图片裁剪到矩形区域(sx, sy, sw, sh)中，并缩放至(dh, dw)，再将其绘制到(dx, dy)坐标</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'shop.png'</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cvsCtx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="使用视频元素"><a href="#使用视频元素" class="headerlink" title="使用视频元素"></a>使用视频元素</h4><pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'movieclip'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> drawFrame <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

  cvsCtx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="操纵像素"><a href="#操纵像素" class="headerlink" title="操纵像素"></a>操纵像素</h3><h4 id="获取像素数据"><a href="#获取像素数据" class="headerlink" title="获取像素数据"></a>获取像素数据</h4><p>获取canvas上一个矩形区域的像素数据：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> imagedata <span class="token operator">=</span> cvsCtx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span>
    pixels <span class="token operator">=</span> imagedata<span class="token punctuation">.</span>data<span class="token punctuation">;</span></code></pre>
<p>ImageData对象的data属性返回一个一维数组（RGBA值），以下数组表现了一个2x2正方形范围内的图像数据，其中的4个像素都设置为红色：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> pixels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
              <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>所以，遍历图像数据中的每个像素的方法如下：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> pixels<span class="token punctuation">.</span>length<span class="token punctuation">;</span> offset <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> offset <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  r <span class="token operator">=</span> pixels<span class="token punctuation">[</span>offset<span class="token punctuation">]</span><span class="token punctuation">;</span>
  g <span class="token operator">=</span> pixels<span class="token punctuation">[</span>offset <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  b <span class="token operator">=</span> pixels<span class="token punctuation">[</span>offset <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  a <span class="token operator">=</span> pixels<span class="token punctuation">[</span>offset <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>获得特定坐标的像素在该数组的偏移下标量：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token punctuation">(</span>xpos <span class="token operator">+</span> ypos <span class="token operator">*</span> imagedata<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span></code></pre>
<h4 id="绘制像素数据"><a href="#绘制像素数据" class="headerlink" title="绘制像素数据"></a>绘制像素数据</h4><pre class=" language-js"><code class="language-js">pixels <span class="token operator">=</span> imagedata<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// ...</span>
cvsCtx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imagedata<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
]]></content>
      <categories>
        <category>HTML5+JavaScript动画基础</category>
      </categories>
      <tags>
        <tag>HTML5</tag>
        <tag>JavaScript</tag>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>写个博客</title>
    <url>/2019/10/19/%E5%86%99%E4%B8%AA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h3 id="博客框架hexo"><a href="#博客框架hexo" class="headerlink" title="博客框架hexo"></a>博客框架hexo</h3><p><a href="https://hexo.io/zh-cn/index.html" target="_blank" rel="noopener">hexo官网</a><br>需要安装:</p>
<ul>
<li>Node</li>
<li>Git</li>
</ul>
<a id="more"></a>
<p>需要了解：</p>
<ul>
<li>markdown<ul>
<li><a href="https://markdown-zh.readthedocs.io/en/latest/" target="_blank" rel="noopener">官方文档</a></li>
<li><a href="https://www.jianshu.com/p/191d1e21f7ed" target="_blank" rel="noopener">Markdown基本语法</a></li>
</ul>
</li>
</ul>
<h3 id="编辑工具"><a href="#编辑工具" class="headerlink" title="编辑工具"></a>编辑工具</h3><p>支持.md文件的都可以，有高亮提示更好。<br>常用：</p>
<ul>
<li>sublime text</li>
<li>vs code</li>
</ul>
<h3 id="themes"><a href="#themes" class="headerlink" title="themes"></a>themes</h3><p><a href="https://hexo.io/themes/" target="_blank" rel="noopener">hexo theme</a><br><a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">next</a><br><a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">yilia</a></p>
<h3 id="部署平台"><a href="#部署平台" class="headerlink" title="部署平台"></a>部署平台</h3><p>国外：<a href="http://github.com" target="_blank" rel="noopener">github</a><br>国内：<a href="https://dev.tencent.com/" target="_blank" rel="noopener">腾讯云开发者平台</a></p>
<h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><p><a href="https://blog.csdn.net/sunshine940326/article/details/70936988" target="_blank" rel="noopener">hexo高阶教程：想让你的博客被更多的人在搜索引擎中搜到吗？</a><br><a href="https://www.jianshu.com/p/efbeddc5eb19" target="_blank" rel="noopener">Hexo+Next个人博客主题优化</a></p>
]]></content>
      <tags>
        <tag>blog</tag>
      </tags>
  </entry>
  <entry>
    <title>vue.config.js 配置</title>
    <url>/2019/10/19/vue-config-js-%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="publicPath"><a href="#publicPath" class="headerlink" title="publicPath"></a>publicPath</h2><p>如果需要build之后输出<code>./</code>路径的话，需要设置publicPath为<code>././</code>：</p>
<pre class=" language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  publicPath<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">'production'</span>
  <span class="token operator">?</span> <span class="token string">'././'</span>
  <span class="token punctuation">:</span> <span class="token string">'/'</span>
<span class="token punctuation">}</span></code></pre>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>vue.config.js</tag>
      </tags>
  </entry>
  <entry>
    <title>Web性能实践日志笔记</title>
    <url>/2019/08/13/Web%E6%80%A7%E8%83%BD%E5%AE%9E%E8%B7%B5%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<blockquote>
<p>《Web性能实践日志》</p>
</blockquote>
<h3 id="localStorage-读取性能"><a href="#localStorage-读取性能" class="headerlink" title="localStorage 读取性能"></a>localStorage 读取性能</h3><p>localStorage技术应用：</p>
<ul>
<li>使用localStorage来实时保存您正在输入的评论</li>
<li>谷歌和Bing用localStorage存储JavaScript和CSS，来改善他们的移动网站的性能</li>
</ul>
<p>为了保持跨浏览器会话，localStorage的数据被写入磁盘中。这意味着当你从localStorage中读取数据时，你实际上是从硬盘驱动器上读取这些字节。<br>读写硬盘的开销高昂，特别是相对于读写内存来说。</p>
<a id="more"></a>

<p>更有趣的是，localStorage按源存储数据，这意味着，在同一时间内，浏览器中的多个标签页可以访问相同的localStorage数据。</p>
<p>当需要从localStorage中读取数据时，浏览器首先需要停下来看看是否有其他标签页正在访问同一数据区域。如果是的话，浏览器必须等到之前的访问操作完成，才可以读取该值。</p>
<p>因此，与从localStorage读取数据相关的延迟是不定的，它在很大程度上取决于在那个时间点上浏览器还在进行的其他操作。</p>
<h4 id="优化策略"><a href="#优化策略" class="headerlink" title="优化策略"></a>优化策略</h4><p><a href="https://jsperf.com/localstorage-string-size" target="_blank" rel="noopener">基准测试</a>从单一localStorage键值中读取的数据量对速度没有影响。<br><a href="https://jsperf.com/localstorage-string-size-retrieval" target="_blank" rel="noopener">基准测试</a>在大多数浏览器中，读取100个字符10次比一次读取10000字符慢90%左右。<br>鉴于此，从localStorage读取数据的最佳策略是使用尽可能少的键值，存储尽可能多的数据。</p>
<h4 id="跟进"><a href="#跟进" class="headerlink" title="跟进"></a>跟进</h4><p>localStorage是一个同步API，这本身使浏览器实现这个API时捉襟见肘。<br>所有的localStorage数据都存储在磁盘文件上。这意味着，为了让您可以用JavaScript访问这些数据，浏览器必须先将该文件读取到内存中。<br>当第一次访问localStorage就可能产生性能问题，但在随后的读取操作中浏览器有可能会冻结。在处理少量数据时，这可能不是一个大问题，但如果你已经达到5MB限制时，就会有明显的影响。</p>
<h3 id="内联不是万能的"><a href="#内联不是万能的" class="headerlink" title="内联不是万能的"></a>内联不是万能的</h3><h4 id="没有浏览器缓存"><a href="#没有浏览器缓存" class="headerlink" title="没有浏览器缓存"></a>没有浏览器缓存</h4><p>将所有内容内联起来最明显的问题就是缓存损失。如果HTML承载了所有资源，HTML自身是不可以缓存的，所有资源每次都要下载一遍。<br>即使HTML是可缓存的，但它的缓存时间也是页面中所有资源缓存时间中最短的。假如你的HTML可以缓存10分钟，页面中另有一个资源可以缓存1天，显然你还是将资源缓存时间缩短到10分钟了。</p>
<h4 id="没有边缘缓存"><a href="#没有边缘缓存" class="headerlink" title="没有边缘缓存"></a>没有边缘缓存</h4><p>CDN的传统价值被称作边缘缓存。直接从CDN获取缓存资源远比从源服务器获取更加快速。</p>
<p><em>CDN的全称是Content Delivery Network，即内容分发网络。CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要有内容存储和分发技术。</em><br><em>——<a href="http://www.cnki.com.cn/Article/CJFDTotal-JSYW201714052.htm" target="_blank" rel="noopener">企业防御DDoS攻击需要多管齐下</a></em></p>
<p>即使是首次访问的用户，内联资源的方式也要比引用资源的方式体验更差。当客户浏览器位置离你的服务器很远的时候，效果尤其明显。</p>
<h4 id="没有按需加载"><a href="#没有按需加载" class="headerlink" title="没有按需加载"></a>没有按需加载</h4><p>所谓按需加载即只加载需要的资源。虽然资源被引用了，但并没有真的被下载，直到条件满足才会被下载。</p>
<p>浏览器提供了一个内置的按需加载CSS图像的机制。如果一个CSS规则引用了一张背景图片，即使页面中有多个元素匹配了这个规则，浏览器也只会下载一次这张图片。另一个按需加载图像的例子，只加载滚动到的可见区域的图片。</p>
<p>因为内联资源是在服务端已经决定的，所以按需加载不会对它产生效果。<br>这就意味着不管客户端是否需要，所有图片和CSS都会被嵌入到页面中返回回来。</p>
<h4 id="浏览器预加载失效"><a href="#浏览器预加载失效" class="headerlink" title="浏览器预加载失效"></a>浏览器预加载失效</h4><p>如果你的网站在HTML的底部引用了<code>http://www.3rdparty.com/code.js</code>，浏览器可能会解析<code>www.3rdparty.com</code>的DNS，甚至需要执行这个文件之前就开始下载它。</p>
<p>如果你大量地使用内联，HTML就会变大，有可能超过0.5MB。下载的时候，浏览器就不能预加载那些你无法内联的第三方工具资源。</p>
<h4 id="不完美的解决方案：只在第一次访问时采用内联方式"><a href="#不完美的解决方案：只在第一次访问时采用内联方式" class="headerlink" title="不完美的解决方案：只在第一次访问时采用内联方式"></a>不完美的解决方案：只在第一次访问时采用内联方式</h4><ul>
<li>用户首次访问你的网站时，把所有的资源内联起来并且为用户设置一个cookie，页面加载时，将所有资源以单独的文件下载，或者将数据存储到脚本缓存中。</li>
<li>当用户再次访问页面时发现存在cookie，服务器就意识到客户端已经存在缓存，数据就不需要内联到页面中返回。</li>
<li>缺陷：在现实中，网站的缓存状态是非常不稳定的，用户的缓存最多不会缓存超过一天</li>
</ul>
<p>另一方面，Cookies通常存活到你设定的失效时间为止。</p>
<p>另一个明显的问题就是并不是所有的CDN都支持通过cookie辨别不同的缓存。</p>
<h4 id="总结和建议"><a href="#总结和建议" class="headerlink" title="总结和建议"></a>总结和建议</h4><p>事实上，减少页面请求数是提高网站速度的绝佳方法，但不是唯一的方法。如果过度实施，将适得其反，它将拖慢网站的速度，而不是提高速度。</p>
<p>下面是使用内联方式的几个建议：</p>
<ol>
<li>非常小的文件需要内联起来（不应该内联超过4KB的文件）</li>
<li>页面中的图片（如从页面中引用的图片，而非CSS引用的图片）应该尽量不要内联</li>
<li>如果不是首屏至关重要的内容都不应该被内联起来</li>
<li>小心内联CSS图片</li>
<li>不要仅仅依靠综合测试——使用RUM（真实用户监控）</li>
</ol>
<h3 id="加载异步脚本的艺术"><a href="#加载异步脚本的艺术" class="headerlink" title="加载异步脚本的艺术"></a>加载异步脚本的艺术</h3><p>参考资料：<br><a href="https://yuiblog.com/blog/2008/07/22/non-blocking-scripts/" target="_blank" rel="noopener">Non-blocking JavaScript Downloads 非阻塞JavaScript加载</a><br><a href="https://calendar.perfplanet.com/2010/the-truth-about-non-blocking-javascript/" target="_blank" rel="noopener">The truth about non-blocking JavaScript 关于非阻塞JavaScript的事实</a></p>
<h4 id="Facebook插件JS-SDK"><a href="#Facebook插件JS-SDK" class="headerlink" title="Facebook插件JS SDK"></a>Facebook插件JS SDK</h4><p>从第三方代码提供者的角度考虑：<br>插件配置实例：</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 立即执行函数，不会污染到全局的命名空间 <span class="token operator">--</span><span class="token operator">></span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 第一行，函数接受<span class="token number">3</span>个参数，在代码最后一行函数被调用。 <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 将多次使用的document对象赋值给d，使整个代码片段更短， <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 同时，由于变量d是局部变量，查找起来比全局变量更快，还轻微提升了代码性能 <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> s<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 声明js变量，并在页面上查找第一个可用的script标签元素赋给fjs</span>
  <span class="token keyword">var</span> js<span class="token punctuation">,</span> fjs <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 检查脚本是否已经加载到页面中，防止重复加载</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 创建script标签并给其ID赋值</span>
  js <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> js<span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 设置script标签的地址，这里的URL缺少协议类型，意味着这个脚本将采用当前页面使用的协议加载</span>
  <span class="token comment" spellcheck="true">// 如果当前页面使用http://，这个脚本文件的加载会相对快一些</span>
  <span class="token comment" spellcheck="true">// 如果当前页面使用https://，你将不会受到关于混合内容的安全提示</span>
  js<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"//content.facebook.net/en_US/all.js#xfbml=1"</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// 将新创建的js元素添加到当前页面的DOM中，新创建的js被插入到body元素和fjs元素之间</span>
  <span class="token comment" spellcheck="true">// parentNode.insertBefore兼容性最好，相对于</span>
  <span class="token comment" spellcheck="true">// (document.head || document.getElementsByTagName('head')[0]).appendChild(js)</span>
  <span class="token comment" spellcheck="true">// document.body.appendChild(js)</span>
  <span class="token comment" spellcheck="true">// document.documentElement.firstChild.appendChild(js)</span>
  fjs<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>js<span class="token punctuation">,</span> fjs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">'script'</span><span class="token punctuation">,</span> <span class="token string">'facebook-jssdk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<p>如果我是代码片段的使用者，拥有页面标记的控制权：</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> js <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  js<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://example.org/my.js'</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>d<span class="token punctuation">.</span>head <span class="token operator">||</span> d<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<p>默认设置：</p>
<pre class=" language-js"><code class="language-js">js<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
js<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span><span class="token punctuation">;</span>
js<span class="token punctuation">.</span>language <span class="token operator">=</span> <span class="token string">'JavaScript'</span><span class="token punctuation">;</span></code></pre>
<p>这意味着，新创建的script标签已经是异步非阻塞的了。</p>
<h3 id="自动化网站性能优化"><a href="#自动化网站性能优化" class="headerlink" title="自动化网站性能优化"></a>自动化网站性能优化</h3><p>压缩合并CSS出现的问题：<br>大多数浏览器在碰到语法错误时，会立即停止解析当前CSS文件。当你盲目地合并CSS文件时，那些之前位于文件底部的错误，现在就处于合并之后的大文件的中间位置。这样，之前一个无关紧要的小问题，现在就可能是破坏站点整体布局的罪魁祸首。</p>
<h3 id="前端单点故障-frontend-SPOF"><a href="#前端单点故障-frontend-SPOF" class="headerlink" title="前端单点故障 frontend SPOF"></a>前端单点故障 frontend SPOF</h3><p><a href="http://www.stevesouders.com/blog/2010/06/01/frontend-spof/" target="_blank" rel="noopener">前端SPOF</a></p>
<p>例子：<br>浏览器花了很长时间下载anywhere.js，原因是这个脚本的来源域<code>platform.twitter.com</code>被屏蔽了。由于脚本会阻塞后续DOM元素的加载，我们猜测anywhere.js是在HEAD中以阻塞模式加载的。查看源码证实确实如此。<br>解决：使用异步方式加载</p>
<h4 id="引起前端单点故障的原因"><a href="#引起前端单点故障的原因" class="headerlink" title="引起前端单点故障的原因"></a>引起前端单点故障的原因</h4><p>任何需要很长时间返回的脚本、样式文件和字体文件都会引起前端单点故障。单点故障通常是由中断或其他类型的失败引发的，比如服务器超载，HTTP请求在服务器队列中一直没有得到响应，造成浏览器响应超时。<br>引起前端单点故障的真正原因是以阻塞的方式加载脚本、样式文件和字体文件。</p>
<h4 id="避免前端单点故障"><a href="#避免前端单点故障" class="headerlink" title="避免前端单点故障"></a>避免前端单点故障</h4><p>避免前端单点故障的最好方法就是异步加载脚本文件。许多流行的第三方组件默认采用异步的加载方式。</p>
<p>另一种解决办法就是将你的组件用iframe包裹起来。</p>
<h4 id="字体文件"><a href="#字体文件" class="headerlink" title="字体文件"></a>字体文件</h4><blockquote>
<p><a href="http://www.phpied.com/gzip-your-font-face-files/" target="_blank" rel="noopener">Gzip your @font-face files 压缩你的字体文件</a></p>
</blockquote>
<pre class=" language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'gzipper'</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">/* 给字体取个名字 */</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url">url(yanone.eot)</span><span class="token punctuation">;</span>                       <span class="token comment" spellcheck="true">/* 适配IE */</span>
  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token function">local</span><span class="token punctuation">(</span><span class="token string">'gzipper'</span><span class="token punctuation">)</span>,
        <span class="token url">url(yanone.ttf)</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'truetype'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">/* 使用ttf字体文件，几乎适配所有浏览器 */</span>

  <span class="token comment" spellcheck="true">/* 如果需要otf字体文件，otf是ttf向后兼容 */</span>
  <span class="token comment" spellcheck="true">/* src: local('gzipper'),
        url(yanone.otf) format('opentype'); */</span>

  <span class="token comment" spellcheck="true">/* 如果需要svg字体文件，svg字体文件适用于Chrome，也可以替代或补充ttf */</span>
  <span class="token comment" spellcheck="true">/* src: local('gzipper'),
        url(yanone.svg) format('svg'); */</span>
<span class="token punctuation">}</span>

<span class="token selector">body </span><span class="token punctuation">{</span>
    <span class="token property">font-family</span><span class="token punctuation">:</span> gzipper<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>必要字体文件格式：<ul>
<li>svg</li>
<li>ttf (FF 3.5，Opera 10，Safari 4，Chrome)</li>
<li>otf</li>
<li>eot (IE)</li>
</ul>
</li>
<li>总是发送gzip字体文件，平均节省40%的文件大小，甚至可能节省高达70%的大小</li>
<li>深入了解WEFT以确保您创建压缩的EOT（创建EOT的另一个选择是使用免费的开源工具ttf2eot并将TTF转换为EOT。）</li>
<li>请密切关注您即将使用的字体文件大小，它们可能非常庞大。如果您有选择，请选择10K字体文件，而不是1.5M字体文件</li>
</ul>
<blockquote>
<p>关于字体引起故障的解决方案：<a href="http://www.stevesouders.com/blog/2009/10/13/font-face-and-performance/" target="_blank" rel="noopener">@font-face and performance</a></p>
</blockquote>
<p><strong>@font-face 性能建议</strong><br>我的第一条建议是避免使用@font-face，除非它对页面至关重要。</p>
<p>这个建议的主要原因是如果在@font-face声明上面有一个<code>&lt;script&gt;</code>标记，那么字体文件将阻止IE中整个页面的呈现，直到它们完成下载。<br>样式表也存在阻止渲染问题。<br>但样式表为整个页面的所有方面提供样式，而字体文件只添加一个东西——自定义字体。</p>
<p>如果您没有被FOUT和中断问题所阻止，并希望继续使用@font-face，我建议<strong>推迟字体文件下载</strong>，直到页面呈现后再下载。<br>这解决了IE中的问题——页面渲染，然后在后台下载字体并在程式化文本到达时增强它们。这种技术在其他浏览器中也有好处。通过延迟加载字体文件，不会触发大多数浏览器忙指示符。<br>延迟加载代码如下所示：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">lazyload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sRule1 <span class="token operator">=</span>
    <span class="token string">"@font-face {"</span> <span class="token operator">+</span>
    <span class="token string">"  font-family: 'Yanone';"</span> <span class="token operator">+</span>
    <span class="token string">"  src: url('/bin/resource.cgi?type=font&amp;sleep=6');"</span> <span class="token operator">+</span>
    <span class="token string">"  src: local('Yanone'), "</span> <span class="token operator">+</span>
                <span class="token string">"url('/bin/resource.cgi?type=font&amp;sleep=6') "</span> <span class="token operator">+</span>
                <span class="token string">"format('truetype');"</span> <span class="token operator">+</span>
    <span class="token string">"}"</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> style1 <span class="token operator">=</span> document<span class="token punctuation">.</span>styleSheets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string">"function"</span> <span class="token operator">===</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span>style1<span class="token punctuation">.</span>insertRule<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Firefox, Safari, Chrome</span>
    style1<span class="token punctuation">.</span><span class="token function">insertRule</span><span class="token punctuation">(</span>sRule1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string">"string"</span> <span class="token operator">===</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span>style1<span class="token punctuation">.</span>cssText<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// IE</span>
    style1<span class="token punctuation">.</span>cssText <span class="token operator">=</span> sRule1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>这是一个原型，而不是一个强化的解决方案。</p>
<h3 id="高性能原生移动应用"><a href="#高性能原生移动应用" class="headerlink" title="高性能原生移动应用"></a>高性能原生移动应用</h3><p>为了分析移动app的网络流量，首先在电脑上建立一个点对点的Wi-Fi网络，把你的移动设备连接到这个网络并在电脑抓包。<br>然后使用Wireshark类似的应用检查你的应用产生的网络流量，或者把得到的抓包载入到类似PcapPerf的工具。<br>还有一种方法，即使用代理，类似Charles Proxy和Fiddler，但是请注意这样有可能会影响你的app的网络行为，比如限制并发连接数。</p>
<h4 id="注意你的瀑布流"><a href="#注意你的瀑布流" class="headerlink" title="注意你的瀑布流"></a>注意你的瀑布流</h4><p>通过检查HTTP瀑布流发现问题。比如：</p>
<ul>
<li>问题：图片阻塞并行下载<br>Web开发者通过简单的调整就可以期待浏览器厂商实现并行下载，而原生app开发者需要自己做出最佳并行下载方案。我们经过调查发现，即使在移动网络上，你也可以通过使用4个并行下载提升性能，高级用户还可以切换到HTTP管线化从而再次提速。</li>
</ul>
<h4 id="压缩这些资源"><a href="#压缩这些资源" class="headerlink" title="压缩这些资源"></a>压缩这些资源</h4><ul>
<li>问题：servies.xml大小为81KB，花费一秒钟从网络上获取（阻塞任何其后的资源）<br>光下载这一文件就花了812毫秒，查看响应头就知道这一文件发送前未压缩。假设经过压缩，这一文件只有6KB大小，可以节省至少半秒的响应时间。</li>
</ul>
<h4 id="不要重复下载"><a href="#不要重复下载" class="headerlink" title="不要重复下载"></a>不要重复下载</h4><ul>
<li>问题：图片重复下载<br>当实现一个原生app时，实现一套基本的缓存机制的责任就落到了开发者身上。仅仅设置http响应的缓存头部通常是不够的。创建一个缓存层来在应用运行期间将元素缓存到内存中，能极大提升性能。</li>
</ul>
<h4 id="太多图片会减慢你的速度么"><a href="#太多图片会减慢你的速度么" class="headerlink" title="太多图片会减慢你的速度么"></a>太多图片会减慢你的速度么</h4><p>Hipmunk，一款流行的航班搜索应用，使用时会下载一个巨大数据文件，压缩后文件大小为650KB，包含了整个搜索结果。<br>更好的做法是把这个文件分割成好几个小文件，其中一部分可以异步加载。<br>其他应用下载许多非常小的文件，而这些文件本来可以轻易合并成几个稍大文件，从而避免由于移动网络的高延迟导致的性能危机。</p>
<h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h4><p>这些例子说明了性能良好的原生移动app和网站遵循的原则并没有想象中那么不同。<br>去除不必要的下载（无论是字节数还是请求数），剩下的就是借助并行和异步加载更好地利用网络。<br>如果有一个重要的结论，它就是：总是尽早测试你的app，别想碰运气。</p>
<h3 id="纯CSS3图片"><a href="#纯CSS3图片" class="headerlink" title="纯CSS3图片"></a>纯CSS3图片</h3><h4 id="基准测试"><a href="#基准测试" class="headerlink" title="基准测试"></a>基准测试</h4><p>为了对比真正的图片文件和CSS3生成的图片，我做了几张页面，每一张都只包含一张图片，真正图片URL和dataURI或者纯CSS3图片。</p>
<h4 id="加载成本"><a href="#加载成本" class="headerlink" title="加载成本"></a>加载成本</h4><p>由于这些页面存储在我本地Apache服务器上，我能通过curl获取它们的压缩和未压缩版本（设置Accept-Encoding为gzip，deflate），得到未压缩的CSS3，data URI和真正图片URL页面内容的长度。</p>
<ul>
<li><em>curl：一个利用URL语法在命令行下工作的文件传输工具，1997年首次发行。它支持文件上传和下载，所以是综合传输工具，但按传统，习惯称cURL为下载工具</em></li>
</ul>
<h4 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h4><p>在这些页面底部添加一小段脚本，这段脚本会以1秒的间隔重复加载这个页面100次，利用sessionStorage计数，并配合Chrome开发者工具的时间轴面板记录页面活动信息，我可以导出这些日志数据。然后借助NodeJS脚本，我提取和过滤出只与渲染活动相关的时间数据，去掉上下各5%的噪音数据样本，就得到了毫秒单位的平均值。</p>
<p>CSS3生成的图片相比无论普通的图片URL还是data URI，加载成本更小。在YSlow logo例子中，遵循W3C标准的CSS3几乎比PNG24图片小34倍。<br>同一图片，压缩后的data URI版的加载成本大致一样，高出只有几字节大小。</p>
<p>另一方面，CSS3生成的图片的渲染时间比普通图片更长，大约是PNG24版本的6.5倍。遵循W3C标准的CSS3版本的渲染比带有-webkit-或者所有浏览器厂商前缀版本快2.5倍。<br>行内版的渲染时间是对应普通图片版的两倍还多。</p>
<h4 id="达到我们的目标了么"><a href="#达到我们的目标了么" class="headerlink" title="达到我们的目标了么"></a>达到我们的目标了么</h4><p>事实上，我们并没有真正达到目的。因为首先要解决特定浏览器前缀问题，能在所有浏览器通用，然后要手工利用DOM元素和样式画图，相当耗时——SVG是为此设计的。<br>这类任务迫切需要一个画图工具辅助，这样，人们就可以拖动<a href="https://pomax.github.io/bezierinfo/zh-CN/" target="_blank" rel="noopener">贝塞尔曲线</a>并调整控制点来得到相应的正确的CSS3边框圆角形状的几何线条。</p>
<h3 id="Android-2-x设备中下载无用背景图片"><a href="#Android-2-x设备中下载无用背景图片" class="headerlink" title="Android 2.x设备中下载无用背景图片"></a>Android 2.x设备中下载无用背景图片</h3><h4 id="无法解决"><a href="#无法解决" class="headerlink" title="无法解决"></a>无法解决</h4><p>没有避免的方法，所以有如下两条指导准则。</p>
<ul>
<li>在CSS中，只给id选择器添加背景图片</li>
<li>避免给同一元素使用多个设置了背景图片的选择器，也就是说不层叠的样式表</li>
</ul>
<h3 id="网络计时"><a href="#网络计时" class="headerlink" title="网络计时"></a>网络计时</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigation_timing_API" target="_blank" rel="noopener">Navigation Timing 导航计时</a><br><a href="https://www.w3.org/TR/navigation-timing/" target="_blank" rel="noopener">规范</a></p>
<ul>
<li>使用Navigation Timing来测量页面加载时间：</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
    <span class="token keyword">function</span> <span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> page_load_time <span class="token operator">=</span> now <span class="token operator">-</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>navigationStart<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"User-perceived page loading time: "</span> <span class="token operator">+</span> page_load_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>onLoad()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
<p>浏览器兼容性：</p>
<ul>
<li>桌面</li>
</ul>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Chrome</th>
<th>Firefox (Gecko)</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
</tr>
</thead>
<tbody><tr>
<td>Basic support</td>
<td>6.0</td>
<td>7 (7)</td>
<td>9</td>
<td>15.0</td>
<td>8</td>
</tr>
</tbody></table>
<ul>
<li>移动端</li>
</ul>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Android</th>
<th>Firefox Mobile (Gecko)</th>
<th>IE Mobile</th>
<th>Opera Mobile</th>
<th>Safari Mobile</th>
</tr>
</thead>
<tbody><tr>
<td>Basic support</td>
<td>4.0</td>
<td>15 (15)</td>
<td>9</td>
<td>15.0</td>
<td>8</td>
</tr>
</tbody></table>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API" target="_blank" rel="noopener">User Timing 用户计时</a><br><a href="http://www.chinaw3c.org/archives/357/" target="_blank" rel="noopener">W3C发布性能时间基线(Performance Timeline)和用户定时(User Timing)的正式推荐标准</a></p>
<p>user Timing例子:</p>
<iframe id="cp_embed_oKMKPq" src="//codepen.io/siluo2000/embed/oKMKPq?height=500&theme-id=dark&slug-hash=oKMKPq&default-tab=js,result&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>

<h3 id="导航计时-API实践"><a href="#导航计时-API实践" class="headerlink" title="导航计时 API实践"></a>导航计时 API实践</h3><h4 id="为什么要关心这些"><a href="#为什么要关心这些" class="headerlink" title="为什么要关心这些"></a>为什么要关心这些</h4><p>监控真实用户很关键，因为它能通过浏览器、地址以及网络得到真实用户体验的最精准的信息。这是唯一真正能度量缓存策略对用户体验的影响的方法。</p>
<h4 id="收集导航计时时间戳并将它们转为有用的度量值"><a href="#收集导航计时时间戳并将它们转为有用的度量值" class="headerlink" title="收集导航计时时间戳并将它们转为有用的度量值"></a>收集导航计时时间戳并将它们转为有用的度量值</h4><p>例子：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getPerfStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> timing <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span>timing<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    dns<span class="token punctuation">:</span> timing<span class="token punctuation">.</span>domainLookupEnd <span class="token operator">-</span> timing<span class="token punctuation">.</span>domainLookupStart<span class="token punctuation">,</span>
    connect<span class="token punctuation">:</span> timing<span class="token punctuation">.</span>connectEnd <span class="token operator">-</span> timing<span class="token punctuation">.</span>connectStart<span class="token punctuation">,</span>
    ttfb<span class="token punctuation">:</span> timing<span class="token punctuation">.</span>responseStart <span class="token operator">-</span> timing<span class="token punctuation">.</span>connectEnd<span class="token punctuation">,</span>
    basePage<span class="token punctuation">:</span> timing<span class="token punctuation">.</span>responseEnd <span class="token operator">-</span> timing<span class="token punctuation">.</span>responseStart<span class="token punctuation">,</span>
    frontEnd<span class="token punctuation">:</span> timing<span class="token punctuation">.</span>loadEventStart <span class="token operator">-</span> timing<span class="token punctuation">.</span>responseEnd
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="使用Google分析作为性能数据仓库"><a href="#使用Google分析作为性能数据仓库" class="headerlink" title="使用Google分析作为性能数据仓库"></a>使用Google分析作为性能数据仓库</h4><p><a href="https://marketingplatform.google.com/about/analytics/" target="_blank" rel="noopener">Google Analytics</a>是互联网上最流行的免费网站分析系统。简称GA。</p>
<h4 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h4><p>1.缺少浏览器覆盖范围<br>有些浏览器中不支持Navigation Timing特性，而缺乏特定浏览器数据的影响很大。</p>
<p>2.缺少对象级别的数据<br>在写书时（2011年）没有主流浏览器支持Resource Timing。</p>
<p>3.受Google分析报告系统能力的限制</p>
<h3 id="考虑移动界面的性能"><a href="#考虑移动界面的性能" class="headerlink" title="考虑移动界面的性能"></a>考虑移动界面的性能</h3><h4 id="电池寿命"><a href="#电池寿命" class="headerlink" title="电池寿命"></a>电池寿命</h4><p>大多数用户都知道打电话以及使用GPS会消耗电量，但很少有人知道有些网站比其他网站更耗电。<br>管理CPU使用量，避免重绘，最小化JavaScript的尺寸和活动，制作动画时总是使用CSS而不是JavaScript，最后，即使设备支持也永远不要在移动设备上使用WebGL。</p>
<h4 id="延迟"><a href="#延迟" class="headerlink" title="延迟"></a>延迟</h4><p>关于延迟必须知道的是，与那些固定设备或使用WiFi访问互联网的设备相比，延迟对移动设备上的下载速度影响巨大。真实的速度与丢包和延迟有很大关系。空气——包从移动设备传到手机基站的介质是延迟的主因。<br>由于延迟的影响，在移动领域，减少DNS查询以及HTTP请求是非常重要的。这就带来了第一个性能优化反模式：嵌入样式表以及脚本。</p>
<h4 id="嵌入CSS和JS：最佳实践"><a href="#嵌入CSS和JS：最佳实践" class="headerlink" title="嵌入CSS和JS：最佳实践"></a>嵌入CSS和JS：最佳实践</h4><p>为了减少延迟对移动站点的负面影响，可以让Web应用只用一个单独的HTTP请求就得到所有HTML、CSS、JS以及图片，实现步骤如下所示：</p>
<ul>
<li>在首次加载时嵌入CSS及JS</li>
<li>将上面的资源解压保存在localStorage中</li>
<li>将解压后的文件的文件名保存在cookie中</li>
<li>后续请求中，服务器检查对应的cookie</li>
<li>根据cookie的值，只嵌入新的或丢失的脚本</li>
<li>加载时，从localStorage资源中载入文件</li>
</ul>
<p>从localStorage中提取数据是性能的一个重大提升。不过在移动端，与延迟相比它作用有限，尤其当延迟是由宽带受限造成的。</p>
<h4 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h4><p>在移动世界，只关注花了多少时间才完成是不够的。<br>设备上跑着的程序越多，你的Web应用可以使用的内存就越少。高内存占用会导致UI变慢，一旦浏览器内存不足，那应用也就内存不足了，这时，移动浏览器通常会关闭或崩溃以便释放内存。</p>
<h5 id="优化图片"><a href="#优化图片" class="headerlink" title="优化图片"></a>优化图片</h5><p>在内存有限的情况下，你还必须考虑图片文件解压后有多大。所有的图片都会消耗内存。<br>合成图像使用GPU内存而不是CPU内存，虽然这可能是一种释放些许内存的技巧，但合成图片所需的内存是对应的非合成图片的4倍，因此，不要常用这种技巧。</p>
<p>我建议你的Web应用中同时使用的文件（当前显示的JS、CSS、HTML以及图片）不要超过80MB。</p>
<h5 id="权衡CSS的好处"><a href="#权衡CSS的好处" class="headerlink" title="权衡CSS的好处"></a>权衡CSS的好处</h5><p>使用渐变、圆角、盒阴影及文字阴影，以及图片边框，可以大大地减少HTTP的请求数。CSS的好处有：</p>
<ul>
<li>更少的HTTP请求</li>
<li>可更新</li>
<li>可扩展</li>
<li>可使用过渡效果</li>
<li>可使用动画</li>
</ul>
<p>不过，在屏幕上展示这些效果也是有成本的，有时候，使用png、gif或jpeg可以比CSS渲染得更快并且占用的内存更少。<br>带过渡特性的CSS一般会在每次重排或重绘时重新计算，这会耗尽内存。png、gif或jpeg以位图的方式渲染并过渡，使用的内存通常更少（但会有更多的HTTP请求）。</p>
<p>对径向渐变及内阴影来说，就需要评估下它们的性能与下载对应图片的成本对比了。<br>要注意有些CSS特性在内存使用及渲染速度方面会有隐性的成本。</p>
<h5 id="GPU的好处及陷阱"><a href="#GPU的好处及陷阱" class="headerlink" title="GPU的好处及陷阱"></a>GPU的好处及陷阱</h5><p>在一些设备上，将一个元素过渡或转换到3维空间时，这个元素会使用硬件加速。通过将元素渲染从CPU转移到GPU的方式，可以大幅提升性能，尤其在动画中。<br>不过，硬件加速元素是复合性的，而这种元素会占用4倍的内存。使用GPU代替CPU能提升性能，但也有上限。</p>
<p>使用硬件加速的元素虽然使用的内存（RAM）较少，但它们会用尽显存，因此，使用<code>transform: translateZ(0)</code>技巧要谨慎。</p>
<h5 id="视口"><a href="#视口" class="headerlink" title="视口"></a>视口</h5><p>移动设备的视口就是屏幕的可见区域。<br>绘制到页面上的内容，即使现在不在视口内，也仍然会占用内存。</p>
<h5 id="最小化DOM"><a href="#最小化DOM" class="headerlink" title="最小化DOM"></a>最小化DOM</h5><p>读写DOM操作的成本是昂贵的，因此请将它们缓存起来，保存到变量中。<br>同样的，批量DOM查询及操作时应分开操作，可以先在外部更新好DOM的内容，再更新对应的节点，以便将DOM的操作减至最少。</p>
<h4 id="UI响应"><a href="#UI响应" class="headerlink" title="UI响应"></a>UI响应</h4><p>在用户做了某个操作后，很重要的一点是在200毫秒内给用户一个反馈。如果是显示或隐藏一个元素，就不需要提供反馈了，因为应用本身会响应。</p>
<p>另外，由于移动设备是一种触摸设备，“双触摸”是一种可能的用户操作，事实上在第一次触摸之后，移动设备会等待可能的第二次触摸，然后才响应用户的操作。<br>在IOS设备上，在触摸事件真正生效之前大约有300毫秒的等待时间。考虑到这一点，你可能希望处理默认事件，比如添加一个监听触摸结束事件（touchend）的函数来处理轻击（tap）操作，以便让你的应用响应更快。</p>
<h3 id="超越Web开发者工具：Strace"><a href="#超越Web开发者工具：Strace" class="headerlink" title="超越Web开发者工具：Strace"></a>超越Web开发者工具：Strace</h3><h4 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h4><p>下面的调用将打印出用Google Chrome访问google.com时产生的所有系统调用：</p>
<pre class=" language-powershell"><code class="language-powershell">strace <span class="token operator">-</span>f <span class="token operator">-</span>ttt <span class="token operator">-</span>T google<span class="token operator">-</span>chrome http:<span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>google<span class="token punctuation">.</span>com<span class="token operator">/</span></code></pre>
<ul>
<li>-f 用于跟踪子进程（fork）</li>
<li>-ttt 用于打印出每个调用的时间戳</li>
<li>-T 用于打印出每个调用的耗时</li>
</ul>
<h4 id="校正"><a href="#校正" class="headerlink" title="校正"></a>校正</h4><p>运行上面的命令时，你可能会被现代Web浏览器所产生的潮水般的调用信息淹没。要过滤出感兴趣的内容，可以用-e参数。<br>例如只想看文件或网络访问，则可以使用-e trace=file或-e trace=network。</p>
<h4 id="示例：本地存储"><a href="#示例：本地存储" class="headerlink" title="示例：本地存储"></a>示例：本地存储</h4><pre class=" language-powershell"><code class="language-powershell">strace <span class="token operator">-</span>f <span class="token operator">-</span>T <span class="token operator">-</span>p _&lt;<span class="token keyword">process</span> id>_ <span class="token operator">-</span>e trace=open<span class="token punctuation">,</span>read<span class="token punctuation">,</span>white</code></pre>
<h3 id="mod-spdy"><a href="#mod-spdy" class="headerlink" title="mod_spdy"></a>mod_spdy</h3><p>SPDY协议能让网站更高效地传送到浏览器上，这能让页面加载时间有高达55%的提升。<br>mod_spdy是一个Apache HTTP Server的开源模块，为Apache HTTP服务提供了SPDY支持。<br>SPDY与性能相关的一个重要特性是<strong>多路复用</strong>，允许在一个单独的SPDY会话中发起多个并发请求，对应的响应将交错下载。</p>
<h3 id="CommonJS模块的惰性求值"><a href="#CommonJS模块的惰性求值" class="headerlink" title="CommonJS模块的惰性求值"></a>CommonJS模块的惰性求值</h3><h4 id="深入理解Text-JavaScript类型"><a href="#深入理解Text-JavaScript类型" class="headerlink" title="深入理解Text/JavaScript类型"></a>深入理解Text/JavaScript类型</h4><p>本地未缓存的JavaScript资源的获取、解析及执行：</p>
<pre class="mermaid">graph TD;
  Latency-->Download;
  Download-->Parsing;
  Parsing-->Evaluation;</pre>

<p>已缓存的JavaScript资源的获取、解析及执行：</p>
<pre class="mermaid">graph TD;
  HTTP-cache-hit-->Parsing;
  Parsing-->Evaluation;</pre>

<p>这儿值得注意的不是缓存显著的收益，而是无论存不存在缓存，每次页面加载时JavaScript文件都需要解析与执行。</p>
<h4 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h4><p>解决初始化延迟的常用推荐方案是按需加载脚本。<br>不过，这个方法也有很多不足。首先，无法保证代码能正常加载——网络或服务器此时可能会不可用了。<br>其次，代码传输的速度取决于网络质量，差异可能非常大。<br>最后，代码是异步加载的。<br>这些不足迫使开发者需要同时考虑到防御性及异步性，实现与分发机制也不得不绑定在一起。</p>
<h4 id="用延迟执行来挽救"><a href="#用延迟执行来挽救" class="headerlink" title="用延迟执行来挽救"></a>用延迟执行来挽救</h4><p>延迟执行只专注于推迟解析与执行的步骤，从而避免了这些问题。<br>为了避免它在页面初始化时执行，可以将它注释掉，或者将它转为一个字符串。<br>与字符串形式的代码相比，注释的代码性能稍微好一点。不过，如果不是以内联方式嵌入，注释的代码提取起来会很复杂。另外，它也比较容易出错，已知有一些手机浏览器会去掉JavaScript注释。更推荐使用字符串形式。</p>
<h4 id="在CommonJS模块中创建懒执行"><a href="#在CommonJS模块中创建懒执行" class="headerlink" title="在CommonJS模块中创建懒执行"></a>在CommonJS模块中创建懒执行</h4><p>就实现而言，要在CommonJS模块中开启懒执行，需要修改运行时，以便它可以正确地执行并包装那些字符串化形式的模块。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'require'</span><span class="token punctuation">,</span> <span class="token string">'exports'</span><span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>这意味着懒执行的模块在服务端创建之时、传送之前就已经被转码。</p>
<h3 id="关于接受建议的建议"><a href="#关于接受建议的建议" class="headerlink" title="关于接受建议的建议"></a>关于接受建议的建议</h3><ul>
<li>使用第三方内容意味着你不再能控制所有可能影响页面加载时间的因素。即使是一个井然有序的、设置良好并且优化过的站点，也有可能因为第三方内容的问题而产生糟糕的用户体验。</li>
<li>当一个HTTPS页面引用了HTTP内容时，就会出现混合内容警告。</li>
<li>SSL很棒，但是也有成本。若无必要请勿使用。<ul>
<li><strong>创建HTTPS连接比常规HTTP连接花费的时间更多</strong>。在SSL连接开始之前，可能需要发送额外的请求到其他服务器，以便验证X.509证书链，这会阻塞后面所有的向这个服务器的连接。</li>
<li><strong>建立HTTPS连接需要更多的计算</strong>。在SSL握手期间，浏览器及服务器都必须做大量的工作，发送时还有更多的编码和解码的工作。</li>
<li>由于HTTPS和HTTP运行在不同的TCP/IP端口上，因此浏览器不能将现有的HTTP连接用于HTTPS连接，即使正在访问的是同一个主机。</li>
<li>使用SSL意味着共享缓存服务器等内联设备将看不到相应的通信，也无法用于提升性能。</li>
<li><strong>浏览器缓存SSL的内容比缓存HTTP的内容复杂很多</strong>。取决于浏览器及其配置，内容可能只会在内存中缓存并很快被丢弃，或者要启用通常不需要的条件请求。</li>
</ul>
</li>
</ul>
<p>这个问题的解决方案是使用相对协议URL。相对协议URL是一种不指定检索协议来引用不同主机上的资源的方法。也就是使用<code>//xx.js</code>代替<code>https://xx.js</code>或<code>http://xx.js</code>。</p>
<h3 id="为什么你对性能测试结果的解读可能是错误的（至少你在大公司里工作）"><a href="#为什么你对性能测试结果的解读可能是错误的（至少你在大公司里工作）" class="headerlink" title="为什么你对性能测试结果的解读可能是错误的（至少你在大公司里工作）"></a>为什么你对性能测试结果的解读可能是错误的（至少你在大公司里工作）</h3><p>我们的思维很自然地把重点聚焦在数据上，而不是数据来源的可靠性上。更让我惊讶地是，我们忽视了样本量的重要性。我们是失败的凭直觉分析问题的统计学家。我们对样本的大小或如何衡量测试结果不够敏感。</p>
<ol>
<li>我们需要工具来提醒我们的样本数量太小。</li>
<li>均值是一种错误的衡量RUM结果的方法。</li>
<li>直方图是最好的图像化数据分析工具。</li>
</ol>
<h3 id="有损图像压缩"><a href="#有损图像压缩" class="headerlink" title="有损图像压缩"></a>有损图像压缩</h3><p>有很多种优化图片的方法，如压缩、拼接（Spriting）、选择合适的格式、缩放等。当然还有其他方法，如延迟加载、缓存、区分URL版本、CDN等。</p>
<p>图像品质值的范围从1到100，75通常对所有图片都比较适合。<br>得到的图片很大程度取决于原始图像和图像的视觉功能，有时甚至可以节省80%的空间，并且无明显的视觉损失。<br>图片压缩工具：<br><a href="https://tinypng.com/" target="_blank" rel="noopener">tinypng</a><br><a href="https://www.jpegmini.com/" target="_blank" rel="noopener">JPEGmini</a><br><a href="https://zhitu.isux.us/" target="_blank" rel="noopener">腾讯智图</a></p>
<h3 id="基于Selenium和JavaScript的性能测试"><a href="#基于Selenium和JavaScript的性能测试" class="headerlink" title="基于Selenium和JavaScript的性能测试"></a>基于Selenium和JavaScript的性能测试</h3><p>现在很多网站都采用了真实用户监控工具来评测应用程序的性能，如<a href="https://newrelic.com/" target="_blank" rel="noopener">New Relic</a>或<a href="https://www.compuware.com/" target="_blank" rel="noopener">Compuware</a>。这些工具非常实用，能够获取实时的性能参数，让工程师能够识别并最终解决性能瓶颈。</p>
<p>这非常适合已经部署到互联网上的应用程序，但对预发测试环境中的应用程序又如何呢？<br>再者，对于运行于防火墙环境内的应用程序又如何呢？</p>
<p>也许我们应该考虑用托管Selenium的解决方案？</p>
<h3 id="超越带宽：UI性能"><a href="#超越带宽：UI性能" class="headerlink" title="超越带宽：UI性能"></a>超越带宽：UI性能</h3><ul>
<li>页面加载后：UI层——鲜有人关心CSS选择器的高昂开销，或是当用户滚动页面时由CSS导致的页面严重滞后。UI性能不被重视的原因之一也许是因为无法量化。</li>
<li>UI性能分析工具：比如Chrome的开发者工具和Opera的调试器Dragonfly已经加入了CSS性能分析工具。</li>
<li>CSS压力测试：<a href="https://css-tricks.com" target="_blank" rel="noopener">CSS Stress Test</a></li>
<li>CSS性能分析器：已经应用于浏览器中，可以让我们更深入了解CSS实际执行速度</li>
<li><a href="http://csslint.net/" target="_blank" rel="noopener">CSS Lint</a></li>
<li><a href="http://mir.aculo.us/dom-monster/" target="_blank" rel="noopener">DOM Monster</a></li>
</ul>
<h4 id="对速度的感知-速度感"><a href="#对速度的感知-速度感" class="headerlink" title="对速度的感知/速度感"></a>对速度的感知/速度感</h4><p>我们多数时候致力于真实性能的提升，但是有时也必须认识到其中的局限性，明白我们并不总能控制带宽，网络延迟或者用户的浏览器性能。我们竭尽所能，但有时不得不造假。“造假直到你能真正提高性能”。</p>
<p>造假是什么意思？<br>一类情况可能是指预加载内容，例如：移动版Gmail就是在用户单击“显示更多信息……”按钮前就提前加载。用户单击时，内容实际上早已经加载完成。<br>造假也可能是指以简单的方式快速响应用户操作，例如提供一个视觉反馈。</p>
<p>另一个更聪明的<a href="https://www.youtube.com/watch?v=05C0GQPKA4g" target="_blank" rel="noopener">例子</a>：在页面中加载一个很小的类库，用来捕获页面上所有的事件，将其添加到队列中，并在随后重新执行。最重要的是，这个小类库还提供UI（表示加载进行中的旋转图标），作为用户操作后给出用户反馈，尽管其实什么也没有发生，直到JavaScript准备好后重新执行队列中的事件。</p>
<h4 id="花絮"><a href="#花絮" class="headerlink" title="花絮"></a>花絮</h4><ul>
<li>雪碧图减少了HTTP请求，但大的雪碧图会占用过多内存</li>
<li>纯CSS3图片？虽然减少了带宽，却是以降低了渲染速度为代价。事实证明，图片渲染更快。</li>
<li>微软的FishIE Tank是一个测试Canvas渲染速度的不错的基准工具，以每秒帧数来衡量。</li>
<li>CSS渐变比SVG背景渲染速度更快。</li>
<li>旧版本Webkit浏览器大量使用box shadow在滚动和渲染页面时有延迟问题。有时使用图片虽然会下载更多的数据，却可以换来更好的UI性能。</li>
<li>CSS径向渐变很不错，而且减少了图片请求，但在某些浏览器中会有渲染问题，特别是Android。</li>
<li>避免使用IE CSS 滤镜，因为会遇到性能问题。</li>
<li>尽可能使用硬件加速CSS动画替代JavaScript动画，但注意一些限制（Webkit有1024像素x1024像素的最大尺寸限制）。如果仍然需要使用JavaScript动画，尽可能使用<code>requestAnimationFrame</code>代替<code>setTimeout</code>和<code>setInterval</code>。</li>
</ul>
<h3 id="CSS-Selector性能改变了（变得更好了）"><a href="#CSS-Selector性能改变了（变得更好了）" class="headerlink" title="CSS Selector性能改变了（变得更好了）"></a>CSS Selector性能改变了（变得更好了）</h3><ul>
<li>样式共享</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>foo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>bar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>假如浏览器引擎已经计算出了第一个段落的样式，那么它就不再需要为第二个段落做同样的计算。</p>
<ul>
<li>规则哈希</li>
</ul>
<pre class=" language-css"><code class="language-css"><span class="token selector">a </span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector">div p </span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector">div p<span class="token class">.legal</span> </span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#sidebar</span> a </span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#sidebar</span> p </span><span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>上方的样式表被分成了3组：</p>
<table>
<thead>
<tr>
<th>a</th>
<th>p</th>
<th>p.legal</th>
</tr>
</thead>
<tbody><tr>
<td>a {}</td>
<td>div p {}</td>
<td>div p.legal {}</td>
</tr>
<tr>
<td>#sidebar a {}</td>
<td>#sidebar p {}</td>
<td></td>
</tr>
</tbody></table>
<p>当浏览器使用规则哈希时，它不再需要检测整个样式表中的所有选择器，而是检测真正有可能匹配的更小范围的几组选择器。<br>它免去了对页面内每一个HTML元素都进行匹配的不必要工作。</p>
<ul>
<li>父过滤器</li>
<li>快速路径</li>
</ul>
<h3 id="PhantomJS和confess-js"><a href="#PhantomJS和confess-js" class="headerlink" title="PhantomJS和confess.js"></a>PhantomJS和confess.js</h3><p>我们渴望有一套强大且可靠的方法来评估Web应用程序的性能和用户体验。<br>PhantomJS提供一个无界面的、功能齐全的Webkit浏览器，可以方便地使用命令行来启动，然后可以用JavaScript编写脚本进行操作。<br><a href="https://github.com/jamesgpearce/confess" target="_blank" rel="noopener">confess.js</a>是一个可以让你很容易地根据不同目的分析网页和应用程序的微型库。目前，它有两个主要功能：提供简单的页面性能概况和生成应用程序缓存清单。<br><strong>PhantomJS在2018年4月已经暂停开发</strong></p>
<h3 id="两次测量一次优化"><a href="#两次测量一次优化" class="headerlink" title="两次测量一次优化"></a>两次测量一次优化</h3><p>测量的关键是工具。从宏观层面开始，你的网站最重要的部分是什么？可能是那个用得最多的部分，或者对业务影响最大的部分（如结算流程）。真正了解网站上哪些页面比较重要的唯一方法是查看统计数据，或者和网站负责人讨论优先级。</p>
<h4 id="识别需要优化的页面-部分"><a href="#识别需要优化的页面-部分" class="headerlink" title="识别需要优化的页面/部分"></a>识别需要优化的页面/部分</h4><p>先查看哪些网页访问次数最多。这可以让你得到一个明确目标的清单。<br>现在，你应该得到了网站中最热门或对业务最重要的页面或部分内容的列表。这就是你的目标列表。保持这个列表定期更新。直到优化完目标列表而没有产生新的性能问题。</p>
<h4 id="识别需要优化的功能"><a href="#识别需要优化的功能" class="headerlink" title="识别需要优化的功能"></a>识别需要优化的功能</h4><p>一般来说，我们的目标是找出用户最可能需要哪些东西。作为一种非正式的经验法则，考虑按以下顺序优化加载的项目：</p>
<ul>
<li>一屏显示的内容</li>
<li>导航组件（菜单、搜索栏）</li>
<li>提供信息的内容（产品介绍、新闻报道）</li>
<li>操作选项（添加到购物车等）</li>
<li>一屏之后的内容</li>
</ul>
<p>你可以用WebPageTest的电影胶片功能来检查各种内容加载的速度。</p>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><p>如果那些使用率高达90%的功能还没有被优化，那就不要把你所有时间都花费在已经优化了的东西上。<br>优化的目标应该是根据你的测量，然后最合理地利用你的时间来优化用户体验。</p>
<h3 id="后端问题检测"><a href="#后端问题检测" class="headerlink" title="后端问题检测"></a>后端问题检测</h3><p>抛开顶级互联网发布商，我们转而关注那些使用现成内容管理系统（Drupal、WordPress或Joomal等）来管理的网站。网站拥有者很少或根本没有检查他们的网站所在的系统的实际性能。<br>几乎所有的CMS系统都会有8~20秒的后端时间。</p>
<h4 id="适当的后端时间该是多少"><a href="#适当的后端时间该是多少" class="headerlink" title="适当的后端时间该是多少"></a>适当的后端时间该是多少</h4><p>对于仅处理后端请求来说，较好的目标时间是100ms。这并不意味着你应该期望TTFB（Time To First Byte，最初的网络请求被发起到从浏览器接收到第一个字节这段时间）为100ms，而是尽量使后端处理时间不宜长于该时间。<br>在使用WebPagetest这样的前端工具来计算后端时间时，你需要记住这个时间还包含网络延迟。因此，我通常采用服务器的套接字连接时间作为RTT（Round-Trip Time，往返时延），并将其作为其他一切评测的基准。<br>在本例中，后端时间 = Time To First Byte - Initial Connection</p>
<h4 id="搞清楚是怎么回事"><a href="#搞清楚是怎么回事" class="headerlink" title="搞清楚是怎么回事"></a>搞清楚是怎么回事</h4><p>后端问题几乎肯定是由以下因素之一引起的：</p>
<ul>
<li>Web服务器配置问题，没有可用资源来处理请求</li>
<li>低效的数据库查询</li>
<li>后端调用外部服务</li>
</ul>
<h3 id="Web字体性能：-font-face及其他解决方案间的权衡"><a href="#Web字体性能：-font-face及其他解决方案间的权衡" class="headerlink" title="Web字体性能：@font-face及其他解决方案间的权衡"></a>Web字体性能：@font-face及其他解决方案间的权衡</h3><h4 id="字体托管服务与自主开发"><a href="#字体托管服务与自主开发" class="headerlink" title="字体托管服务与自主开发"></a>字体托管服务与自主开发</h4><p>1.字体托管服务<br>Typekit、Fonts.com、Fontdeck等服务为设计师提供一个简单的接口来管理已购买的字体，并产生一个指向用于加载字体的动态CSS或JavaScript文件的链接。谷歌甚至还提供了类似的免费服务。</p>
<p>2.DIY方式<br>这种方式涉及购买字体的网络使用授权，以及使用类似FontSquirrel这样的工具来优化字体文件大小。</p>
<h4 id="FOUT是什么"><a href="#FOUT是什么" class="headerlink" title="FOUT是什么"></a>FOUT是什么</h4><p>FOUT（Flash of Unstyled Text），即无样式文本的闪烁，指Web字体下载并渲染之前短暂显示无样式文本的情况。<br>FOUT以某种形式存在于Internet Explorer所有版本和Firefox 3.6及更低级版本中。<br>为避免FOUT，我的建议是：</p>
<ul>
<li>将字体托管在一个CDN上</li>
<li>GZIP压缩所有字体文件，.woff文件除外（已压缩）</li>
<li>通过增加缓存过期头来缓存字体文件30天</li>
<li>从字体文件移除多余的字形</li>
<li>确保@font-face是页面中第一个样式表的第一条规则（IE）</li>
</ul>
<h4 id="移除多余的字体字形"><a href="#移除多余的字体字形" class="headerlink" title="移除多余的字体字形"></a>移除多余的字体字形</h4><p><a href="https://www.fontsquirrel.com/" target="_blank" rel="noopener">Font Squirrel</a>提供一个很棒的工具，可以帮助你将桌面版本的字体文件转换成网络版本。</p>
<h4 id="JavaScript字体加载器"><a href="#JavaScript字体加载器" class="headerlink" title="JavaScript字体加载器"></a>JavaScript字体加载器</h4><p><a href="https://github.com/typekit/webfontloader" target="_blank" rel="noopener">WebFont Loader</a>可以在字体下载过程中，用CSS和JavaScript钩子机制表明字体的状态。<br>它所追踪的状态有3种：加载中（loading/wf-loading）、活跃（active/wf-active）和非活跃（超时 inactive/wf-inactive）。相应的CSS类可以通过先隐藏标题，下载完成后再显示的方式来解决FOUT问题。</p>
<pre class=" language-css"><code class="language-css"><span class="token selector">h1 </span><span class="token punctuation">{</span>
  <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.wf-active</span> h1 </span><span class="token punctuation">{</span>
  <span class="token property">visibility</span><span class="token punctuation">:</span> visible<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>这些相同事件的JavaScript钩子也可以从配置对象的回调函数中获得。</p>
<pre class=" language-js"><code class="language-js">WebFontConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  google<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    families<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Tangerine'</span><span class="token punctuation">,</span> <span class="token string">'Cantarell'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">// example</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  typekit<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'myKitId'</span>                         <span class="token comment" spellcheck="true">// example</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  loading<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  active<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  inactive<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h4 id="Boot-getFont介绍：一种快速、小巧的Web字体加载器"><a href="#Boot-getFont介绍：一种快速、小巧的Web字体加载器" class="headerlink" title="Boot.getFont介绍：一种快速、小巧的Web字体加载器"></a>Boot.getFont介绍：一种快速、小巧的Web字体加载器</h4><p><a href="https://raw.githubusercontent.com/artzstudio/Boot/master/src/standalone/boot.getfont.js" target="_blank" rel="noopener">boot.getfont.js 开发版本</a><br>你可以非常简单地改变文件结尾处的“Boot”字符串来更改其命名空间，例如：jQuery。<br>通过一个JavaScript函数就可以加载字体，并在字体完成渲染后，执行提供的回调方法。</p>
<pre class=" language-js"><code class="language-js">Boot<span class="token punctuation">.</span><span class="token function">getFont</span><span class="token punctuation">(</span><span class="token string">'opensans'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// when font is active</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>通过加载一个配置对象，你可以很轻松地配置它来抓取基于你的目录结构的字体。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// Global</span>
Boot<span class="token punctuation">.</span>getFont<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'/fonts/{f}/{f}-webfont'</span> <span class="token comment" spellcheck="true">// {f} is replaced with the font name</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// Font-specific</span>
Boot<span class="token punctuation">.</span><span class="token function">getFont</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'http://mycdn.com/fonts/{f}/{f}-wf'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'futura'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>CSS类：</p>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.wf-opensans-loading</span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.wf-opensans-active</span></span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.wf-opensans-inactive</span></span><span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<h4 id="Gentlefonts，启动你的引擎"><a href="#Gentlefonts，启动你的引擎" class="headerlink" title="Gentlefonts，启动你的引擎"></a>Gentlefonts，启动你的引擎</h4><ul>
<li>B1      -&gt;  Boot.getFont</li>
<li>B2      -&gt;  Boot.getFont(CDN)</li>
<li>FS1     -&gt;  FontSquirrel Optimal</li>
<li>FS2     -&gt;  FontSquirrel Expert</li>
<li>FS3     -&gt;  FontSquirrel Expert(CDN)</li>
<li>GWF1    -&gt;  Google Web Fonts Standard</li>
<li>GWF2    -&gt;  Google Web Fonts JavaScript<br>(时间越少越好)</li>
</ul>

      <div id="802u6hj6jf9" class="hexo-tag-easy-charts" style="width: 100%; height: 480px;"></div>

      <script type="text/javascript">
        var chart = echarts.init(document.getElementById('802u6hj6jf9'));
        chart.setOption({"title":{"text":"字体实现基准测试"},"animation":true,"tooltip":{"trigger":"axis"},"xAxis":{"data":["GWF1","GWF2","FS1","Typekit","FS2","B1","FS3","B2","System"]},"yAxis":{},"series":[{"name":"IE 9","type":"bar","data":["896","1096","997","798","822","812","710","692","373"]},{"name":"IE 8","type":"bar","data":["850","1097","800","999","704","698","697","697","358"]},{"name":"IE 7","type":"bar","data":["870","1126","803","959","784","798","681","696","370"]},{"name":"Firefox","type":"bar","data":["1003","1254","933","795","802","693","667","652","506"]},{"name":"Chrome","type":"bar","data":["899","801","925","815","792","704","681","680","398"]}],"legend":{"data":["IE 9","IE 8","IE 7","Firefox","Chrome"]}});
      </script>
    


      <div id="kcgupkt9l3k" class="hexo-tag-easy-charts" style="width: 100%; height: 480px;"></div>

      <script type="text/javascript">
        var chart = echarts.init(document.getElementById('kcgupkt9l3k'));
        chart.setOption({"title":{"text":"字体实现的最快速度"},"animation":true,"tooltip":{"trigger":"axis"},"xAxis":{"data":["GWF1","GWF2","FS1","Typekit","FS2","B1","FS3","B2","System"]},"yAxis":{},"series":[{"name":"Value","type":"bar","data":["850","801","800","795","704","693","667","652","358"]}]});
      </script>
    

<p>资料：</p>
<ul>
<li><a href="https://www.filamentgroup.com/lab/font-loading.html" target="_blank" rel="noopener">How we use web fonts responsibly, or, avoiding a @font-face-palm 我们如何负责任地使用网络字体，或​​避免使用@ font-face-palm</a></li>
<li><a href="https://www.filamentgroup.com/lab/font-events.html" target="_blank" rel="noopener">How We Load Web Fonts Progressively 我们如何逐步加载Web字体</a></li>
<li><a href="https://filamentgroup.github.io/font-loading/data-uris-cookie.html" target="_blank" rel="noopener">cookie加载字体demo</a></li>
</ul>
]]></content>
      <categories>
        <category>Web性能</category>
      </categories>
      <tags>
        <tag>Web性能实践日志</tag>
        <tag>性能</tag>
      </tags>
  </entry>
  <entry>
    <title>A tale of two viewports 笔记</title>
    <url>/2019/08/10/A-table-of-two-viewports/</url>
    <content><![CDATA[<ul>
<li>两个视口的故事一<a href="https://www.quirksmode.org/mobile/viewports.html" target="_blank" rel="noopener">A tale of two viewports - part one</a></li>
<li>两个视口的故事二<a href="https://www.quirksmode.org/mobile/viewports2.html" target="_blank" rel="noopener">A tale of two viewports - part two</a></li>
</ul>
<h2 id="Part-one"><a href="#Part-one" class="headerlink" title="Part one"></a>Part one</h2><p><strong>在这个小系列中，我将解释视口和各种重要元素的宽度如何工作，例如<code>&lt;html&gt;</code>元素，以及窗口和屏幕。</strong></p>
<p>此页面是关于桌面浏览器的，其唯一目的是为移动浏览器的类似讨论设置阶段。 大多数Web开发人员已经直观地理解了大多数桌面概念。 在移动设备上，我们会发现相同的概念，但更复杂。<br>因此，事先讨论每个人已经知道的术语将极大地帮助您理解移动浏览器。</p>
<a id="more"></a>
<h3 id="Concept-device-pixels-amp-CSS-pixels-概念-设备像素和CSS像素"><a href="#Concept-device-pixels-amp-CSS-pixels-概念-设备像素和CSS像素" class="headerlink" title="Concept: device pixels &amp; CSS pixels 概念: 设备像素和CSS像素"></a>Concept: device pixels &amp; CSS pixels 概念: 设备像素和CSS像素</h3><p>您需要了解的第一个概念是CSS像素，以及与设备像素的差异。</p>
<p>设备像素是我们认为“真实”的像素类型。这些像素为您正在处理的任何设备提供正式分辨率，并且（通常）可以从screen.width / height读出。</p>
<p>如果你给某个元素一个宽度：128px，你的显示器是1024px宽，并且你最大化你的浏览器屏幕，那么你的显示器宽度可以包容8个该元素（粗略地说，让我们暂时忽略这些棘手的部分）。</p>
<p>但是，如果用户缩放浏览器页面，则此计算将发生变化。如果用户放大到200％，即放大2倍，则宽度为128px的元素在其1024px宽的显示器上仅适合四次。</p>
<p>在现代浏览器中实现的缩放只不过是“拉伸”像素。也就是说，元素的宽度不会从128像素变为256像素;相反，实际像素的大小加倍。形式上，该元素仍然具有128个CSS像素的宽度，即使它恰好占用256个设备像素的空间。</p>
<p>换句话说，放大到200％会使一个CSS像素增长到一个设备像素大小的四倍。 （宽度的两倍，高度的两倍，总共产生四倍）。</p>
<p>一些图像将阐明这一概念。这是100％缩放级别的四个像素。没什么可看的; CSS像素与设备像素完全重叠。</p>
<p><img src="csspixels_100.gif" alt="CSS pixels * 1"></p>
<p>现在让我们缩小浏览器页面大小。 CSS像素开始缩小，这意味着一个设备像素现在与几个CSS像素重叠。</p>
<p><img src="csspixels_out.gif" alt="zoom out"></p>
<p>如果放大，则会发生相反的情况。 CSS像素开始增长，现在一个CSS像素与几个设备像素重叠。</p>
<p><img src="csspixels_in.gif" alt="zoom in"></p>
<p>这里的要点是你只对CSS像素感兴趣。 这些像素决定了样式表的呈现方式。</p>
<p>设备像素几乎完全没用。<br>用户将放大或缩小页面直到他可以舒适地阅读它。 但是，缩放级别对您无关紧要。 浏览器将自动确保您的CSS布局被拉伸或挤压。</p>
<h4 id="100-zoom-100-缩放"><a href="#100-zoom-100-缩放" class="headerlink" title="100% zoom 100%缩放"></a>100% zoom 100%缩放</h4><p>我假设缩放级别为100％开始了这个例子。 现在是时候更严格地定义：</p>
<p>在缩放级别100％时，一个CSS像素正好等于一个设备像素。</p>
<p>100％缩放的概念在接下来的解释中非常有用，但您不应该在日常工作中过度担心它。 在桌面上，您通常会以100％缩放测试您的网站，但即使用户放大或缩小CSS像素的魔力也会确保您的布局保持相同的比例。</p>
<h3 id="Screen-size-屏幕尺寸"><a href="#Screen-size-屏幕尺寸" class="headerlink" title="Screen size 屏幕尺寸"></a>Screen size 屏幕尺寸</h3><p>我们来看看一些实际测量。 我们将从screen.width和screen.height开始。 它们包含用户屏幕的总宽度和高度。 这些尺寸是以设备像素为单位测量的，因为它们永远不会改变：它们是显示器的一个功能，而不是浏览器的功能。</p>
<p><img src="desktop_screen.jpg" alt="Screen size"></p>
<p>有趣！ 但是我们如何处理这些信息呢？</p>
<p>基本上没什么。 用户的显示器大小对我们来说并不重要 - 除非您想测量它以用于Web统计数据库。</p>
<h3 id="Window-size-窗口尺寸"><a href="#Window-size-窗口尺寸" class="headerlink" title="Window size 窗口尺寸"></a>Window size 窗口尺寸</h3><p>反而，您想知道的是浏览器窗口的内部尺寸。 这可以告诉您用户当前有多少空间可用于CSS布局。 您可以在window.innerWidth和window.innerHeight中找到这些尺寸。</p>
<p><img src="desktop_inner.jpg" alt="Window size"></p>
<p>显然，窗口的内部宽度是以CSS像素为单位测量的。 您需要知道可以在浏览器窗口中挤出多少布局，并且随着用户放大，该数量会减少。因此，如果用户放大，则窗口中的可用空间会减少，而window.innerWidth / Height会反映出来减少。</p>
<p>（这里的例外是Opera，其中window.innerWidth / Height在用户放大时不会减小：它们是以设备像素为单位测量的。这在桌面上很烦人，但在移动设备上会很致命，我们稍后会看到。）</p>
<p><img src="desktop_inner_zoomed.jpg" alt="Window size"></p>
<p>请注意，测量的宽度和高度包括滚动条。 它们也被视为内部窗口的一部分。 （这主要是出于历史原因。）</p>
<h3 id="Scrolling-offset-滚动偏移"><a href="#Scrolling-offset-滚动偏移" class="headerlink" title="Scrolling offset 滚动偏移"></a>Scrolling offset 滚动偏移</h3><p>window.pageXOffset和window.pageYOffset，包含文档的水平和垂直滚动偏移。 因此，您可以了解用户滚动了多少。</p>
<p><img src="desktop_page.jpg" alt="Scrolling offset"></p>
<p>这些属性也以CSS像素为单位进行测量。 您想知道已经滚动了多少文档，无论它处于何种缩放状态。</p>
<p>理论上，如果用户向上滚动然后放大，window.pageX / YOffset将会改变。 但是，浏览器尝试通过在用户缩放时将相同元素保持在可见页面的顶部来保持网页的一致性。 这并不总是完美无缺，但这意味着在实践中window.pageX / YOffset并没有真正改变：滚出窗口的CSS像素数量保持（大致）相同。</p>
<p><img src="desktop_page_zoomed.jpg" alt="Scrolling offset"></p>
<h3 id="Concept-the-viewport-概念-视口"><a href="#Concept-the-viewport-概念-视口" class="headerlink" title="Concept: the viewport 概念: 视口"></a>Concept: the viewport 概念: 视口</h3><p>在继续使用更多JavaScript属性之前，我们必须引入另一个概念：视口。</p>
<p>视口的功能是约束<code>&lt;html&gt;</code>元素，它是站点中最上面的包含块。</p>
<p>这可能听起来有点模糊，所以这是一个实际的例子。假设您有液体布局，其中一个侧边栏的宽度为10％。现在，当您调整浏览器窗口大小时，侧边栏会整齐地增长和缩小。但究竟是如何运作的呢？</p>
<p>从技术上讲，会发生边栏获得其父级宽度的10％。假设是<code>&lt;body&gt;</code>（并且你没有给它宽度）。所以问题就变成了<code>&lt;body&gt;</code>的宽度。</p>
<p>通常，所有块级元素都占用其父级宽度的100％（有异常，但现在让我们忽略它们）。所以<code>&lt;body&gt;</code>和它的父<code>&lt;html&gt;</code>元素一样宽。</p>
<p><code>&lt;html&gt;</code>元素有多宽？为什么，它和浏览器窗口一样宽。这就是为什么宽度为10％的侧边栏将覆盖整个浏览器窗口的10％。所有Web开发人员都直观地了解并使用了这一事实。</p>
<p>你可能不知道的是它在理论上是如何运作的。理论上，<code>&lt;html&gt;</code>元素的宽度受视口宽度的限制。 <code>&lt;html&gt;</code>元素占用该视口宽度的100％。</p>
<p>反过来，视口完全等于浏览器窗口：它已被定义为这样。视口不是HTML构造，因此您无法通过CSS对其进行影响。它只有浏览器窗口的宽度和高度 - 在桌面上。<br>在移动设备上，它要复杂得多。</p>
<h3 id="Consequences-后果"><a href="#Consequences-后果" class="headerlink" title="Consequences 后果"></a>Consequences 后果</h3><p>这种状况有一些奇怪的后果。 你可以在这个网站上看到其中一个。 一直向上滚动到顶部，然后放大两到三步，以便该站点的内容溢出浏览器窗口。</p>
<p>现在滚动到右侧，您将看到站点顶部的蓝色栏不再正常排列。</p>
<p><img src="desktop_htmlbehaviour.jpg" alt="Consequences"></p>
<p>此行为是视口定义方式的结果。 我给了顶部的蓝色条宽度：100％。 100％的是什么？ <code>&lt;html&gt;</code>元素，与视口一样宽，与浏览器窗口一样宽。</p>
<p>重点是：虽然这在100％缩放时工作正常，但现在我们放大了视口已经变得小于我的网站的总宽度。 内容现在溢出<code>&lt;html&gt;</code>元素本身无关紧要，但该元素设置了<code>overflow: visible</code>，这意味着任何情况下都会显示溢出内容。</p>
<p>但蓝色的顶栏没有溢出。 我给它一个宽度：100％，毕竟，浏览器遵守视口的宽度。 他们并不关心那个宽度现在太窄了。</p>
<p><img src="desktop_100percent.jpg" alt="Consequences"></p>
<h4 id="document-width-文档流宽度"><a href="#document-width-文档流宽度" class="headerlink" title="document width? 文档流宽度"></a>document width? 文档流宽度</h4><p><em>（或者文档对象宽度？）</em><br>我真正需要知道的是页面的总内容有多宽，包括“突出”的位。据我所知，不可能找到该值（好吧，除非你计算在页面上的所有元素各自的宽度和边距 ，但这是容易出错的。</p>
<p>我开始相信我们需要一对JavaScript属性（宽和高），它给出了我所谓的“文档宽度”（显然是CSS像素）。</p>
<p><img src="desktop_documentwidth.jpg" alt="document width"></p>
<p>如果我们真的感觉很时髦，为什么不将这个值暴露给CSS呢？ 我希望能够制作宽度：我的蓝色条的100％取决于文档宽度，而不是<code>&lt;html&gt;</code>元素的宽度。 （但这肯定是棘手的，如果不可能实现，我也不会感到惊讶。）</p>
<p>浏览器厂商，您怎么看？</p>
<h3 id="Measuring-the-viewport-测量视口"><a href="#Measuring-the-viewport-测量视口" class="headerlink" title="Measuring the viewport 测量视口"></a>Measuring the viewport 测量视口</h3><p>您可能想知道视口的尺寸。 它们可以在document.documentElement.clientWidth和-Height中找到。</p>
<p><img src="desktop_client.jpg" alt="Measuring the viewport"></p>
<p>如果你知道你的DOM，你知道document.documentElement实际上是<code>&lt;html&gt;</code>元素：任何HTML文档的根元素。 但是，视口高一级，可以这么说; 它是包含<code>&lt;html&gt;</code>元素的元素。</p>
<p>在那种情况下，document.documentElement.clientWidth和-Height仍然给出视口的尺寸，而不是<code>&lt;html&gt;</code>元素的尺寸。 （这是一个特殊规则，仅适用于此对属性元素。在所有其他情况下，使用元素的实际宽度。）</p>
<p><img src="desktop_client_smallpage.jpg" alt="Measuring the viewport"></p>
<p>因此，无论<code>&lt;html&gt;</code>元素的尺寸如何，document.documentElement.clientWidth和-Height始终都会提供视口尺寸。</p>
<h4 id="Two-property-pairs-两个属性对"><a href="#Two-property-pairs-两个属性对" class="headerlink" title="Two property pairs 两个属性对"></a>Two property pairs 两个属性对</h4><p>但是不是window.innerWidth / Height给出的视口宽度的尺寸？ 嗯，是的，不。</p>
<p>两个属性对之间存在形式上的差异：document.documentElement.clientWidth和-Height不包括滚动条，而window.innerWidth / Height则包含滚动条。</p>
<p>我们有两个属性对的事实是浏览器大战的延续。 那时Netscape只支持window.innerWidth / Height和IE only document.documentElement.clientWidth和-Height。 从那以后所有其他浏览器开始支持clientWidth / Height，但IE没有选择window.innerWidth / Height。</p>
<p>有两个可用的属性对是桌面上的一个小麻烦 - 但事实证明，这对移动设备来说是一种祝福，我们将会看到。</p>
<h3 id="Measuring-the-lt-html-gt-element-测量html元素"><a href="#Measuring-the-lt-html-gt-element-测量html元素" class="headerlink" title="Measuring the &lt;html&gt; element 测量html元素"></a>Measuring the <code>&lt;html&gt;</code> element 测量html元素</h3><p>所以clientWidth / Height在所有情况下都给出了视口尺寸。<br>但是我们在哪里可以找到<code>&lt;html&gt;</code>元素本身的尺寸？ 它们存储在document.documentElement.offsetWidth和-Height中。</p>
<p><img src="desktop_offset.jpg" alt="Measuring the `&lt;html&gt;` element"></p>
<p>这些属性真正允许您作为块级元素访问<code>&lt;html&gt;</code>元素; 如果设置宽度，offsetWidth将反映它。</p>
<p><img src="desktop_offset_smallpage.jpg" alt="Measuring the `&lt;html&gt;` element"></p>
<h3 id="Event-coordinates-事件坐标"><a href="#Event-coordinates-事件坐标" class="headerlink" title="Event coordinates 事件坐标"></a>Event coordinates 事件坐标</h3><p>然后是事件坐标。 发生鼠标事件时，会暴露不少于五个属性对，以提供有关事件确切位置的信息。 对于我们的讨论，其中三个很重要：</p>
<table>
<thead>
<tr>
<th>属性对</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>pageX/Y</td>
<td>给出了CSS像素中相对于`<html>`元素的坐标</html></td>
</tr>
<tr>
<td>clientX/Y</td>
<td>给出CSS像素中相对于视口的坐标</td>
</tr>
<tr>
<td>screenX/Y</td>
<td>给出设备像素中相对于屏幕的坐标</td>
</tr>
</tbody></table>
<p><img src="desktop_pageXY.jpg" alt="Event coordinates"></p>
<p>您将在90％的时间内使用pageX/Y; 通常你想知道相对于文档的事件位置。<br>另外10％的时间你会使用clientX/Y. 您永远不需要知道相对于屏幕的事件坐标。</p>
<h3 id="Media-queries-媒体查询"><a href="#Media-queries-媒体查询" class="headerlink" title="Media queries 媒体查询"></a>Media queries 媒体查询</h3><p>最后，关于媒体查询的一些话。 这个想法非常简单：您可以定义特殊的CSS规则，仅当页面宽度大于，等于或小于特定大小时才执行。 例如：</p>
<pre class=" language-css"><code class="language-css"><span class="token selector">div<span class="token class">.sidebar</span> </span><span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">300</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@media</span> all and <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 400px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">/* 宽度小于400px时指定的样式; */</span>
  <span class="token selector">div<span class="token class">.sidebar</span> </span><span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>现在侧边栏宽300px，除非宽度小于400px，在这种情况下侧边栏变宽100px。</p>
<p>问题当然是：我们在这里测量的宽度是多少？</p>
<p>有两个相关的媒体查询： width/height和device-width/device-height。</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>width/height</td>
<td>使用与documentElement .clientWidth / Height（换句话说，视口）相同的值。 它适用于CSS像素。</td>
</tr>
<tr>
<td>device-width/device-height</td>
<td>使用与screen.width/height相同的值（换句话说，屏幕）。 它适用于设备像素。</td>
</tr>
</tbody></table>
<p><img src="desktop_mediaqueries.jpg" alt="Media queries"></p>
<p>你应该用哪个？ 当然，这是一个明智的选择：width。 Web开发人员对设备宽度不感兴趣; 这是浏览器窗口的宽度。</p>
<p>所以在桌面上使用宽度并忘记设备宽度。 正如我们所看到的，移动设备的情况要严重得多。</p>
<h3 id="Conclusion-结论"><a href="#Conclusion-结论" class="headerlink" title="Conclusion 结论"></a>Conclusion 结论</h3><p>这就结束了我们对桌面浏览器行为的尝试。 本系列的第二部分将这些概念移植到移动设备，并突出了与桌面的一些重要差异。</p>
<h2 id="Part-two"><a href="#Part-two" class="headerlink" title="Part two"></a>Part two</h2><p>在这个小系列中，我将解释视口和各种重要元素的宽度如何工作，例如<code>&lt;html&gt;</code>元素，以及窗口和屏幕。</p>
<p>在这个页面里，我们将讨论移动浏览器。 如果您对移动设备完全陌生，我建议您先阅读有关桌面浏览器的第一部分。</p>
<h3 id="The-problem-of-mobile-browsers-移动浏览器的问题"><a href="#The-problem-of-mobile-browsers-移动浏览器的问题" class="headerlink" title="The problem of mobile browsers 移动浏览器的问题"></a>The problem of mobile browsers 移动浏览器的问题</h3><p>当我们将移​​动浏览器与桌面浏览器进行比较时，最明显的区别是屏幕尺寸。移动浏览器显示的网站，桌面优化显着少于桌面浏览器，或者通过缩小直到文本不可读的小，或者只能显示桌面网站的一小部分。</p>
<p>移动屏幕远小于桌面屏幕，考虑最大宽度为400px，有时候要少得多。 （有些手机报告的宽度较大，但它们在撒谎 - 或者至少给我们无用的信息。）</p>
<p>平板电脑设备之中，如iPad或传闻中的基于HP webOS的平板设备，将弥合台式机和移动设备之间的差距，但这不会改变根本问题。网站也必须在移动设备上运行，因此我们必须让它们在小屏幕上显示。</p>
<p>最重要的问题集中在CSS上，尤其是视口的尺寸。如果我们一对一地复制桌面模型，我们的CSS就会开始惨不忍睹。</p>
<p>让我们回到我们的侧边栏，宽度：10％。如果移动浏览器与桌面浏览器完全相同，那么它们最多只能生成40px宽的元素，而且这个元素太窄了。你的液体布局看起来会非常可怕。</p>
<p>解决问题的一种方法是为移动浏览器构建一个特殊网站。即使除了你是否应该这样做的基本问题之外，实际的问题是只有极少数的网站所有者被充分利用以满足移动设备的需求。</p>
<p>移动浏览器供应商希望为他们的客户提供最佳体验，现在这意味着“尽可能像桌面一样”。<br>因此需要一些技巧。</p>
<h3 id="The-two-viewports-两个视口"><a href="#The-two-viewports-两个视口" class="headerlink" title="The two viewports 两个视口"></a>The two viewports 两个视口</h3><p>因此视口太窄而无法作为CSS布局的基础。显而易见的解决方案是使视口更宽。但是，这需要将其拆分为两个：可视视口和布局视口(the visual viewport and the layout viewport)。</p>
<p>George Cummins在 <a href="https://stackoverflow.com/questions/6333927/difference-between-visual-viewport-and-layout-viewport" target="_blank" rel="noopener">Stack Overflow</a> 中解释了最基本的概念：</p>
<blockquote>
<p>想象一下，布局视口是一个不会改变大小或形状的大图像。现在，您可以使用较小的浏览器窗口来查看大图像。<br>小窗口被不透明材料包围，这些材料遮挡了除大部分图像之外的所有部分的视图。<br>您可以通过窗口看到的大图像部分是可视视口。<br>您可以在保持窗口的同时远离大图像（缩小）以一次查看整个图像，或者您可以靠近（放大）以仅查看一部分。<br>您也可以更改窗口的方向，但大图像（布局视口）的大小和形状永远不会更改。</p>
</blockquote>
<p>另见 <a href="https://stackoverflow.com/questions/7344886/visual-viewport-vs-layout-viewport-on-mobile-devices" target="_blank" rel="noopener">克里斯</a> 的这个解释。</p>
<blockquote>
<p>可视视口是当前在屏幕上显示的页面的一部分。<br>用户可以滚动以更改他看到的页面部分，或者缩放以更改可视视口的大小。</p>
</blockquote>
<p><img src="mobile_visualviewport.jpg" alt="The two viewports"></p>
<p>但是，CSS布局（尤其是百分比宽度）是相对于布局视口计算的，布局视口比视觉视口宽得多。</p>
<p>因此，<code>&lt;html&gt;</code>元素最初采用布局视口的宽度，并且您的CSS被解释为屏幕明显比手机屏幕宽。 这可确保您网站的布局与桌面浏览器上的布局相同。</p>
<p>布局视口有多宽？ 这与浏览器不同。 Safari iPhone使用980px，Opera 850px，Android WebKit 800px和IE 974px。</p>
<p>有些浏览器有特殊行为：</p>
<ul>
<li>Symbian WebKit尝试保持布局视口等于可视视口，是的，这意味着具有百分比宽度的元素可能表现得很奇怪。 但是，如果页面由于绝对宽度而不适合视觉视口，则浏览器会将布局视口拉伸到最大850px。</li>
<li>三星WebKit（在bada上）使布局视口与最宽的元素一样宽。</li>
<li>在BlackBerry上，布局视口等于100％缩放的可视视口。 这不会改变。</li>
</ul>
<h3 id="Zooming-缩放"><a href="#Zooming-缩放" class="headerlink" title="Zooming 缩放"></a>Zooming 缩放</h3><p>显然，两个视口都以CSS像素为单位进行测量。 但是，当视觉视口尺寸随着缩放而变化时（如果放大，屏幕上的CSS像素较少），布局视口尺寸保持不变。 （如果他们没有，您的页面将不断重排，因为重新计算百分比宽度。）</p>
<h3 id="Understanding-the-layout-viewport-了解布局视口"><a href="#Understanding-the-layout-viewport-了解布局视口" class="headerlink" title="Understanding the layout viewport 了解布局视口"></a>Understanding the layout viewport 了解布局视口</h3><p>为了理解布局视口的大小，我们必须看一下页面完全缩小时会发生什么。 许多移动浏览器最初以完全缩小模式显示任何页面。</p>
<p>重点是：浏览器选择了布局视口的尺寸，使其在完全缩小模式下完全覆盖屏幕（因此等于可视视口）。</p>
<p><img src="mobile_viewportzoomedout.jpg" alt="Understanding the layout viewport"></p>
<p>因此，布局视口的宽度和高度等于在最大缩小模式下可以在屏幕上显示的任何宽度和高度。<br>当用户放大这些尺寸时保持不变。</p>
<p><img src="mobile_layoutviewport.jpg" alt="Understanding the layout viewport"></p>
<p>布局视口宽度始终相同。 如果旋转手机，视觉视口会发生变化，但浏览器会通过稍微放大来适应此新方向，以使布局视口再次与视觉视口一样宽。</p>
<p><img src="mobile_viewportzoomedout_la.jpg" alt="Understanding the layout viewport"></p>
<p>这会对布局视口的高度产生影响，现在这个高度远远小于纵向模式。 但Web开发人员并不关心高度，只关心宽度。</p>
<p><img src="mobile_layoutviewport_la.jpg" alt="Understanding the layout viewport"></p>
<h3 id="Measuring-the-layout-viewport-测量布局视口"><a href="#Measuring-the-layout-viewport-测量布局视口" class="headerlink" title="Measuring the layout viewport 测量布局视口"></a>Measuring the layout viewport 测量布局视口</h3><p>我们现在有两个想要测量的视口。 因此，浏览器大战为我们提供了两个属性对，这是非常幸运的。</p>
<p>document.documentElement.clientWidth和-Height包含布局视口的尺寸。</p>
<p><img src="mobile_client.jpg" alt="Measuring the layout viewport"></p>
<p>方向对于高度很重要，但对于宽度则不重要。</p>
<p><img src="mobile_client_la.jpg" alt="Measuring the layout viewport"></p>
<h3 id="Measuring-the-visual-viewport-测量视觉视口"><a href="#Measuring-the-visual-viewport-测量视觉视口" class="headerlink" title="Measuring the visual viewport 测量视觉视口"></a>Measuring the visual viewport 测量视觉视口</h3><p>对于视觉视口，它由window.innerWidth/Height测量。 显然，当用户缩小或放大时，测量值会发生变化，因为更多或更少的CSS像素适合屏幕。</p>
<p><img src="mobile_inner.jpg" alt="Measuring the visual viewport"></p>
<p>不幸的是，这是一个不兼容的领域。许多浏览器仍然需要添加对视觉视口测量的支持。 尽管如此，没有浏览器将此测量值存储在任何其他属性对中，所以我猜window.innerWidth/Height是一个标准，尽管是一个兼容性差的。</p>
<h3 id="The-screen-屏幕"><a href="#The-screen-屏幕" class="headerlink" title="The screen 屏幕"></a>The screen 屏幕</h3><p>在桌面上，screen.width/height给出屏幕尺寸，以设备像素为单位。 与在桌面上一样，作为Web开发人员，您永远不需要这些信息。 您对屏幕的物理尺寸不感兴趣，但对当前适合的CSS像素数量感兴趣。</p>
<p><img src="mobile_screen.jpg" alt="The screen"></p>
<h4 id="The-zoom-level-缩放级别"><a href="#The-zoom-level-缩放级别" class="headerlink" title="The zoom level 缩放级别"></a>The zoom level 缩放级别</h4><p>无法直接读出缩放级别，但您可以通过window.innerWidth划分screen.width来获得缩放级别。 当然，只有在完全支持这两个属性时才有效。</p>
<p>幸运的是，缩放级别并不重要。 您需要知道的是屏幕上当前有多少CSS像素。 并且您可以从window.innerWidth获取该信息——如果它被正确支持。</p>
<h3 id="Scrolling-offset-滚动偏移-1"><a href="#Scrolling-offset-滚动偏移-1" class="headerlink" title="Scrolling offset 滚动偏移-"></a>Scrolling offset 滚动偏移-</h3><p>您还需要知道的是视觉视口相对于布局视口的当前位置。 这是滚动偏移，就像在桌面上一样，它存储在window.pageX/YOffset中。</p>
<p><img src="mobile_page.jpg" alt="Scrolling offset"></p>
<h3 id="lt-html-gt-element-html元素"><a href="#lt-html-gt-element-html元素" class="headerlink" title="&lt;html&gt; element html元素"></a><code>&lt;html&gt;</code> element html元素</h3><p>与在桌面上一样，document.documentElement.offsetWidth/Height以CSS像素为单位给出<code>&lt;html&gt;</code>元素的总大小。</p>
<h3 id="Media-queries-媒体查询-1"><a href="#Media-queries-媒体查询-1" class="headerlink" title="Media queries 媒体查询-"></a>Media queries 媒体查询-</h3><p>媒体查询与桌面上的查询工作方式相同。 width/height使用布局视口作为参考，以CSS像素为单位测量，device-width/height使用设备屏幕，以设备像素为单位进行测量。</p>
<p>换句话说，width/height反映了document.documentElement.clientWidth/Height，而device-width/height反映screen.width/height的值。 （他们实际上在所有浏览器中都这样做，即使镜像值不正确。）</p>
<p><img src="mobile_mediaqueries.jpg" alt="Media queries"></p>
<p>现在哪个测量对我们的Web开发人员更有用？ 重点是，我不知道。</p>
<p>我开始认为device-width是最重要的一个，因为它为我们提供了一些我们可以使用的设备信息。 例如，您可以改变布局的宽度以适应设备的宽度。 但是，您也可以使用<code>&lt;meta viewport&gt;</code>。 使用device-width媒体查询并不是绝对必要的。</p>
<p>那么width是更重要的媒体查询吗？ 也许。 它提供了一些线索，比如浏览器认为该设备上的网站宽度是多少。 但这是相当模糊的，width媒体查询并没有真正提供任何其他信息。</p>
<p>所以我还没有决定。 目前我认为媒体查询对于确定您是在台式机，平板电脑还是移动设备上非常重要，但对于区分各种平板电脑或移动设备并不是那么有用。</p>
<p>或者其他的东西。</p>
<h3 id="Event-coordinates-事件坐标-1"><a href="#Event-coordinates-事件坐标-1" class="headerlink" title="Event coordinates 事件坐标-"></a>Event coordinates 事件坐标-</h3><p>事件坐标或多或少在桌面上工作。 不幸的是，在12个经过测试的浏览器中，只有两个，Symbian WebKit和Iris，完全正确。 所有其他浏览器都有或多或少的严重问题。</p>
<p>pageX/Y仍然是相对于CSS像素中的页面，这是三个属性对中最有用的，就像它在桌面上一样。</p>
<p><img src="mobile_pageXY.jpg" alt="Event coordinates"></p>
<p>clientX/Y相对于CSS像素中的可视视口。 这是有用的，虽然我不完全确定它有什么可用之处。</p>
<p>screenX/Y是相对于设备像素中的屏幕。 当然，这与clientX/Y使用的引用相同，并且设备像素无用。 所以我们不需要担心screenX/Y。 它与桌面上的一样无用。</p>
<p><img src="mobile_clientXY.jpg" alt="Event coordinates"></p>
<h3 id="Meta-viewport-元视口"><a href="#Meta-viewport-元视口" class="headerlink" title="Meta viewport 元视口"></a>Meta viewport 元视口</h3><p>最后，让我们讨论<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=320&quot;&gt;</code>。 最初是Apple扩展程序，但同时被更多浏览器复制。 它旨在调整布局视口的大小。 为了理解为什么这是必要的，让我们退后一步。</p>
<p>假设你构建一个简单的页面并且你的元素没有设置宽度。 现在它们伸展到占据布局视口宽度的100％。 大多数浏览器缩小以在屏幕上显示整个布局视口，产生如下效果：</p>
<p><img src="mq_none.jpg" alt="Meta viewport"></p>
<p>所有用户都会立即放大，这是有效的，但大多数浏览器保持元素的宽度不变，这使得文本难以阅读。</p>
<p><img src="mq_none_zoomed.jpg" alt="Meta viewport"></p>
<p>（这里的重要例外是Android WebKit，它实际上减少了包含文本的元素的大小，使它们适合屏幕。这绝对是非常棒的，我觉得所有其他浏览器都应该复制这种行为。我将在以后完整记录它。）</p>
<p>现在您可以尝试设置html {width：320px}。 现在<code>&lt;html&gt;</code>元素缩小了，所有其他元素都缩小了，现在占用了320px的100％。 这在用户放大时起作用，但最初不是在用户遇到大部分不包含任何内容的缩小页面时。</p>
<p><img src="mq_html300.jpg" alt="Meta viewport"></p>
<p>为了解决这个问题，Apple发明了meta视口标签。 设置<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=320&quot;&gt;</code>时，将布局视口的宽度设置为320px。 现在页面的初始状态也是正确的。</p>
<p><img src="mq_yes.jpg" alt="Meta viewport"></p>
<p>您可以将布局视口的宽度设置为所需的任何尺寸，包括设备宽度。 最后一个将screen.width（在设备像素中）作为其引用，并相应地调整布局视口的大小。</p>
<p>不过，这里有一个问题。 有时正式的screen.width没有多大意义，因为像素数太高了。 例如，Nexus One的正式宽度为480像素，但Google工程师已经决定在使用设备宽度时给布局视口宽度为480像素太多了。 它们将它缩小到2 / 3rds，因此设备宽度可以为您提供320px的宽度，就像在iPhone上一样。</p>
<p>如果传言新iPhone将会有更大的像素数（不一定等于更大的屏幕！），如果Apple复制这种行为，我也不会感到惊讶。 也许到最后，设备宽度仅意味着320px。</p>
<h3 id="Related-research-相关的研究"><a href="#Related-research-相关的研究" class="headerlink" title="Related research 相关的研究"></a>Related research 相关的研究</h3><p>必须进一步研究几个相关主题：</p>
<ul>
<li>position: fixed。 如我们所知，固定元素相对于视口定位。 但相对于哪个视口？我同时做了这项<a href="https://www.quirksmode.org/blog/archives/2010/12/the_fifth_posit.html" target="_blank" rel="noopener">研究</a>。</li>
<li>其他媒体查询：dpi，方向，宽高比( dpi, orientation, aspect-ratio )。 特别是dpi是一个灾难区域，不仅因为所有浏览器报告96dpi，这通常是错误的，而且因为我还不完全确定dpi是Web开发人员最感兴趣的值。</li>
<li>当元素比布局视口/HTML element更宽时会发生什么？ 假设我将一个宽度为1500px的元素插入到我的一个测试页面中？ 元素将突出HTML元素（overflow: visible），但这意味着实际视口可以变得比布局视口更宽。 此外，旧的Android（Nexus One）在发生这种情况时放大了HTML元素。 这是一个好主意吗？</li>
</ul>
]]></content>
      <tags>
        <tag>viewports</tag>
      </tags>
  </entry>
  <entry>
    <title>NODE安装笔记</title>
    <url>/2019/08/10/NODE%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h3 id="卸载node和npm"><a href="#卸载node和npm" class="headerlink" title="卸载node和npm"></a>卸载node和npm</h3><p>在安装nvm前要先卸载已经安装的node和npm。</p>
<p>命令行卸载的方法没看懂。可以找到自带的卸载程序卸载node。</p>
<a id="more"></a>
<h3 id="安装nvm"><a href="#安装nvm" class="headerlink" title="安装nvm"></a>安装nvm</h3><p>1.<a href="https://github.com/coreybutler/nvm-windows/releases" target="_blank" rel="noopener">NVM下载</a><br>2.下载完成后，将内容解压到C:\dev\nvm （需为全英文路径）<br>3.新建settings.txt文件：</p>
<pre class=" language-js"><code class="language-js">root<span class="token punctuation">:</span> C<span class="token punctuation">:</span>\dev\nvm
path<span class="token punctuation">:</span> C<span class="token punctuation">:</span>\dev\nodejs
arch<span class="token punctuation">:</span> <span class="token number">64</span>
proxy<span class="token punctuation">:</span> none
node_mirror<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org<span class="token operator">/</span>mirrors<span class="token regex">/node/</span>
npm_mirror<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org<span class="token operator">/</span>mirrors<span class="token regex">/npm/</span></code></pre>
<p>4.配置环境变量</p>
<ul>
<li>window + r 打开运行面板，然后输入 : sysdm.cpl，打开系统属性面板</li>
<li>在系统属性面板中切换到高级面板，点击下方的环境变量按钮，打开环境变量面板</li>
<li>新建系统变量如下：</li>
</ul>
<pre class=" language-js"><code class="language-js">NVM_HOME<span class="token punctuation">:</span> C<span class="token punctuation">:</span>\dev\nvm
NVM_SYMLINK<span class="token punctuation">:</span> C<span class="token punctuation">:</span>\dev\nodejs</code></pre>
<ul>
<li>在系统变量PATH中新增 <code>%NVM_HOME%;%NVM_SYMLINK%;</code></li>
</ul>
<p>5.打开cmd，检查是否配置成功</p>
<pre class=" language-powershell"><code class="language-powershell"><span class="token function">set</span> NVM_HOME
<span class="token function">set</span> NVM_SYMLINK
nvm <span class="token operator">-</span>v</code></pre>
<h3 id="安装node"><a href="#安装node" class="headerlink" title="安装node"></a>安装node</h3><p>命令：</p>
<pre class=" language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 查看所有版本</span>
nvm <span class="token function">ls</span>

<span class="token comment" spellcheck="true"># 查看可安装版本</span>
nvm <span class="token function">ls</span><span class="token operator">-</span>remote

<span class="token comment" spellcheck="true"># 安装最新版本</span>
nvm install latest

<span class="token comment" spellcheck="true"># 安装随意版本</span>
nvm install 4<span class="token punctuation">.</span>6<span class="token punctuation">.</span>0

<span class="token comment" spellcheck="true"># 切换node版本</span>
nvm use 4<span class="token punctuation">.</span>6<span class="token punctuation">.</span>0

<span class="token comment" spellcheck="true"># 安装稳定版本</span>
nvm install stable

<span class="token comment" spellcheck="true"># 查看当前版本</span>
nvm current</code></pre>
<h3 id="配置node全局模块路径"><a href="#配置node全局模块路径" class="headerlink" title="配置node全局模块路径"></a>配置node全局模块路径</h3><ul>
<li>方法一：<br>设置到自己想要放的位置：</li>
</ul>
<p>打开：nodejs安装目录/node_modules/npm/.npmrc这个文件，修改里面的路径</p>
<pre class=" language-powershell"><code class="language-powershell">prefix = E:\nodejs\node_global_modules</code></pre>
<ul>
<li>方法二：</li>
</ul>
<p>进入cmd，输入如下代码：</p>
<pre class=" language-powershell"><code class="language-powershell"><span class="token comment" spellcheck="true"># 查看npm配置</span>
npm config <span class="token function">ls</span>  

<span class="token comment" spellcheck="true"># 配置prefix修改node的全局模块安装路径</span>
npm config <span class="token function">set</span> prefix E:\nodejs\node_global_modules</code></pre>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://blog.csdn.net/qwdafedv/article/details/55802747" target="_blank" rel="noopener">NVM，Windows下环境配置</a><br><a href="https://www.jianshu.com/p/28bca6529150" target="_blank" rel="noopener">在windows下用nvm 安装node</a><br><a href="https://www.jianshu.com/p/e21e3783304f" target="_blank" rel="noopener">nvm 使用攻略</a><br><a href="https://www.cnblogs.com/kongxianghai/p/5660101.html" target="_blank" rel="noopener">使用nvm利器，管理node版本</a><br><a href="https://www.cnblogs.com/niuxiaoling/p/7993032.html" target="_blank" rel="noopener">nodejs全局安装路径的位置</a></p>
]]></content>
      <categories>
        <category>Node</category>
      </categories>
      <tags>
        <tag>node</tag>
        <tag>nvm</tag>
        <tag>global_modules</tag>
      </tags>
  </entry>
  <entry>
    <title>Git</title>
    <url>/2019/08/10/Git/</url>
    <content><![CDATA[<h3 id="Git-Error"><a href="#Git-Error" class="headerlink" title="Git Error"></a>Git Error</h3><h4 id="failed-to-push-some-refs-to"><a href="#failed-to-push-some-refs-to" class="headerlink" title="failed to push some refs to"></a><code>failed to push some refs to</code></h4><pre class=" language-powershell"><code class="language-powershell">git pull <span class="token operator">--</span>rebase origin master
git push origin master</code></pre>
<a id="more"></a>]]></content>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue入门笔记七(生产环境构建)</title>
    <url>/2019/08/07/Vue%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%E4%B8%83-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA/</url>
    <content><![CDATA[<blockquote>
<p>《Vue.js项目实战》</p>
</blockquote>
<h3 id="将样式提取到CSS文件"><a href="#将样式提取到CSS文件" class="headerlink" title="将样式提取到CSS文件"></a>将样式提取到CSS文件</h3><p>安装包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D extract<span class="token operator">-</span>text<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin</code></pre>
<a id="more"></a>
<p>在webpack.config.js导入并配置：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'extract-text-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment" spellcheck="true">// ...</span>
    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token punctuation">:</span> <span class="token string">'common.[chunkhash].css'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="新的npm脚本"><a href="#新的npm脚本" class="headerlink" title="新的npm脚本"></a>新的npm脚本</h3><p>1.安装包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D rimraf</code></pre>
<p>2.为客户端bundle和服务器bundle各添加一个build脚本：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
  <span class="token string">"build:client"</span><span class="token punctuation">:</span> <span class="token string">"cross-env NODE_ENV=production webpack --progress --hide-modules --config webpack/client.js"</span><span class="token punctuation">,</span>
  <span class="token string">"build:server"</span><span class="token punctuation">:</span> <span class="token string">"cross-env NODE_ENV=production webpack --progress --hide-modules --config webpack/server.js"</span>
<span class="token punctuation">}</span></code></pre>
<p>3.新建一个build脚本，用来清空dist文件夹并运行build:client和build:server这两个脚本：</p>
<pre class=" language-powershell"><code class="language-powershell"><span class="token string">"build"</span>: <span class="token string">"rimraf dist &amp;&amp; npm run build:client &amp;&amp; npm run build:server"</span></code></pre>
<p>4.添加最后一个名为start的脚本，它会以生产模式运行express服务器：</p>
<pre class=" language-powershell"><code class="language-powershell"><span class="token string">"start"</span>: <span class="token string">"cross-env NODE_ENV=production node server"</span></code></pre>
<p>5.运行构建：</p>
<pre class=" language-powershell"><code class="language-powershell">npm run build</code></pre>
<p>6.启动express服务器：</p>
<pre class=" language-powershell"><code class="language-powershell">npm <span class="token function">start</span></code></pre>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>extract-text-webpack-plugin</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue入门笔记六(全局组件 过滤器 插件 变量)</title>
    <url>/2019/08/07/Vue%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%E5%85%AD-%E5%85%A8%E5%B1%80%E7%BB%84%E4%BB%B6-%E8%BF%87%E6%BB%A4%E5%99%A8-%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<blockquote>
<p>《Vue.js项目实战》</p>
</blockquote>
<h3 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h3><p>1.在components文件夹创建Loading.vue：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<a id="more"></a>
<p>2.在main.js旁边创建一个global-components.js，然后使用<code>Vue.component()</code>方法全局地注册Loading组件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">"./components/Loading"</span>

Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">"Loading"</span><span class="token punctuation">,</span> Loading<span class="token punctuation">)</span></code></pre>
<p>3.然后，在main.js中导入global-components.js：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./global-components'</span></code></pre>
<p>现在可以全局使用<code>&lt;Loading /&gt;</code>了！</p>
<h3 id="全局过滤器"><a href="#全局过滤器" class="headerlink" title="全局过滤器"></a>全局过滤器</h3><p>1.以momentjs为例，首先安装moment：</p>
<pre class=" language-powershell"><code class="language-powershell">npm install <span class="token operator">-</span>S moment</code></pre>
<p>2.在main.js文件旁边创建一个新的filters.js，它包含date过滤器：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">"moment"</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> date <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">moment</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>3.在main.js中导入filters.js并用一个循环注册它们：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> filters <span class="token keyword">from</span> <span class="token string">'./filters'</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> filters<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>现在完成注册全局过滤器了！</p>
<ul>
<li>在组件中使用：</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  Created on <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">></span></span>{{ ticket.date | date }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<h3 id="全局插件"><a href="#全局插件" class="headerlink" title="全局插件"></a>全局插件</h3><p>用自己的插件扩展Vue：</p>
<h4 id="创建一个插件"><a href="#创建一个插件" class="headerlink" title="创建一个插件"></a>创建一个插件</h4><p>（1）在src文件夹中创建一个plugins文件夹<br>（2）在plugins文件夹中创建一个fetch.js<br>（3）让我们通过导出一个带有install对象的方法创建一个插件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  install <span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Installed!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>（4）在main.js中导入这个插件，然后像我们为vue-router所做的那样调用Vue.use()方法：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> VueFetch <span class="token keyword">from</span> <span class="token string">'./plugins/fetch'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueFetch<span class="token punctuation">)</span></code></pre>
<h4 id="插件选项"><a href="#插件选项" class="headerlink" title="插件选项"></a>插件选项</h4><p>我们可以使用options参数配置插件。<br>（1）编辑install方法，添加options参数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  install <span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Installed!'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>（2）添加一个baseURL属性到配置中：</p>
<pre class=" language-js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueFetch<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  baseURL<span class="token punctuation">:</span> <span class="token string">'http://localhost:3000/'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>（3）将baseURL存储到一个变量中，稍后使用：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> baseURL
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  install <span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Installed!'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>

    baseURL <span class="token operator">=</span> options<span class="token punctuation">.</span>baseURL
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="fetch方法"><a href="#fetch方法" class="headerlink" title="$fetch方法"></a>$fetch方法</h4><p>（1）在fetch.js中使用fetch方法实现$fetch方法：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> $fetch <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>（2）添加到Vue的原型，使它在所有组件中都可用：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  install <span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Installed!'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>

    baseURL <span class="token operator">=</span> options<span class="token punctuation">.</span>baseURL

    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$fetch <span class="token operator">=</span> $fetch
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>（3）然后在组件中使用$fetch方法，比如：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>question <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'question'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> e
<span class="token punctuation">}</span></code></pre>
<h5 id="改进fetch插件"><a href="#改进fetch插件" class="headerlink" title="改进fetch插件"></a>改进fetch插件</h5><p>目前，我们的$fetch方法只能对服务器发出GET请求。</p>
<p>（1）在plugins/fetch.js文件中添加options参数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">$fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p>options参数是fetch方法的可选参数，允许我们更改不同的参数，例如使用的HTTP方法、请求主体等。</p>
<p>（2）在$fetch方法头部设置option参数的默认值：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> finalOptions <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span>  <span class="token comment" spellcheck="true">// 始终在请求主体中发送JSON</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  credentials<span class="token punctuation">:</span> <span class="token string">'include'</span>                <span class="token comment" spellcheck="true">// 包含用户登录所需的授权令牌</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></code></pre>
<p>（3）接下来，将新选项添加到浏览器fetch方法：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> finalOptions<span class="token punctuation">)</span></code></pre>
<p>（4）另外，服务器总是将错误作为文本发送，所以可以捕获它们并显示给用户：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> data
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
  error<span class="token punctuation">.</span>response <span class="token operator">=</span> response
  <span class="token keyword">throw</span> error
<span class="token punctuation">}</span></code></pre>
<ul>
<li>在组件中使用：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">async</span> signup <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'signup'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      username<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span>
      password<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">,</span>
      email<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>email
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> <span class="token string">'login'</span>
<span class="token punctuation">}</span></code></pre>
<p>（5）会话过期</p>
<p>服务器始终返回403错误。</p>
<p>1.在修改请求方法（<code>/plugin/fetch.js</code>）前，需要导入state和路由器：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> state <span class="token keyword">from</span> <span class="token string">"../state"</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">"../router"</span></code></pre>
<p>2.在<code>fetch.js</code>响应处理中添加一个条件分支：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 如果会话不在有效</span>
  <span class="token comment" spellcheck="true">// 我们登出</span>
  state<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token comment" spellcheck="true">// 如果这个路由是私有的</span>
  <span class="token comment" spellcheck="true">// 我们跳转到登录页面</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>r <span class="token operator">=</span><span class="token operator">></span> r<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span> params<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      wantedRoute<span class="token punctuation">:</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p>现在这个插件完成了！</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> state <span class="token keyword">from</span> <span class="token string">"../state"</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">"../router"</span>
<span class="token keyword">let</span> baseUrl

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> $fetch <span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> finalOptions <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    credentials<span class="token punctuation">:</span> <span class="token string">'include'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> finalOptions<span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 如果会话不在有效</span>
    <span class="token comment" spellcheck="true">// 我们登出</span>
    state<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment" spellcheck="true">// 如果这个路由是私有的</span>
    <span class="token comment" spellcheck="true">// 我们跳转到登录页面</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>r <span class="token operator">=</span><span class="token operator">></span> r<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span> params<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        wantedRoute<span class="token punctuation">:</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath
      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    error<span class="token punctuation">.</span>response <span class="token operator">=</span> response
    <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  install <span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    baseUrl <span class="token operator">=</span> options<span class="token punctuation">.</span>baseUrl

    Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$fetch <span class="token operator">=</span> $fetch
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="fetch补充"><a href="#fetch补充" class="headerlink" title="fetch补充"></a>fetch补充</h4><p>兼容性：</p>
<p class="ciu_embed" data-feature="fetch" data-periods="[future_1,current,past_1,past_2,past_3]"><a href="http://caniuse.com/#feat=fetch" target="_blank" rel="noopener">Can I Use fetch?</a> Data on support for the fetch feature across the major browsers from caniuse.com.</p><script async src="//cdn.jsdelivr.net/caniuse-embed/1.1.0/caniuse-embed.min.js"></script>

<h3 id="全局变量-对象"><a href="#全局变量-对象" class="headerlink" title="全局变量/对象"></a>全局变量/对象</h3><h4 id="将用户存储在一个集中式state里"><a href="#将用户存储在一个集中式state里" class="headerlink" title="将用户存储在一个集中式state里"></a>将用户存储在一个集中式state里</h4><p>（1）在main.js旁边创建state.js，用于导出state对象：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  user<span class="token punctuation">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span></code></pre>
<p>（2）在main.js导入state：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> state <span class="token keyword">from</span> <span class="token string">"./state"</span></code></pre>
<p>（3）然后，将其用作根实例的数据，以便使其成为响应式的：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> state<span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> h <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span>AppLayout<span class="token punctuation">)</span><span class="token punctuation">,</span>
  router
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="state原型对象"><a href="#state原型对象" class="headerlink" title="$state原型对象"></a>$state原型对象</h4><p>（1）在plugins文件夹中，创建一个导出插件state.js：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  install <span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$state'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> state<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>（2）在main.js中导入插件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> VueState <span class="token keyword">from</span> <span class="token string">'./plugins/state'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueState<span class="token punctuation">,</span> state<span class="token punctuation">)</span></code></pre>
<p>现在可以在组件中使用$state来访问全局状态了！</p>
<ul>
<li>实例：</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$state.user<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token comment" spellcheck="true">&lt;!-- ... --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$state<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>components</tag>
        <tag>filters</tag>
        <tag>plugins</tag>
        <tag>vars</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue入门笔记五(常用插件)</title>
    <url>/2019/08/07/Vue%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%E4%BA%94-%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<blockquote>
<p>《Vue.js项目实战》</p>
</blockquote>
<h3 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h3><p>1.安装包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm install axios <span class="token operator">-</span>S</code></pre>
<p>2.在src/utils文件夹中创建http.js：</p>
<a id="more"></a>

<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">const</span> http <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token punctuation">:</span> <span class="token string">'http://localhost:3000/'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> install <span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$http <span class="token operator">=</span> http
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> http</code></pre>
<ul>
<li>在src/plugins.js中导入和注册http：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Http <span class="token keyword">from</span> <span class="token string">'./utils/http'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Http<span class="token punctuation">)</span></code></pre>
<p>3.在vuexStore中使用：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">'../utils/http'</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`items/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`comments?itemId=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span></code></pre>
<p>在组件中使用：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span></code></pre>
<h3 id="json-server-生成快速开发API"><a href="#json-server-生成快速开发API" class="headerlink" title="json-server 生成快速开发API"></a>json-server 生成快速开发API</h3><p>创建本地API。</p>
<p>1.安装包</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D json<span class="token operator">-</span>server</code></pre>
<p>2.创建db.json：<br>示例：</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Blue Socks"</span><span class="token punctuation">,</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">2.99</span><span class="token punctuation">,</span>
      <span class="token property">"originalPrice"</span><span class="token operator">:</span> <span class="token number">3.99</span><span class="token punctuation">,</span>
      <span class="token property">"rating"</span><span class="token operator">:</span> <span class="token number">4.3</span><span class="token punctuation">,</span>
      <span class="token property">"img"</span><span class="token operator">:</span> <span class="token string">"http://lorempixel.com/400/400/abstract/1/"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Green Socks"</span><span class="token punctuation">,</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3.99</span><span class="token punctuation">,</span>
      <span class="token property">"rating"</span><span class="token operator">:</span> <span class="token number">3.9</span><span class="token punctuation">,</span>
      <span class="token property">"img"</span><span class="token operator">:</span> <span class="token string">"http://lorempixel.com/400/400/abstract/2/"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Red Socks"</span><span class="token punctuation">,</span>
      <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3.99</span><span class="token punctuation">,</span>
      <span class="token property">"rating"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token property">"img"</span><span class="token operator">:</span> <span class="token string">"http://lorempixel.com/400/400/abstract/3/"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"comments"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"This is awesome!"</span><span class="token punctuation">,</span>
      <span class="token property">"itemId"</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3.在package.json添加一个脚本以启动JSON服务器：</p>
<pre class=" language-js"><code class="language-js"><span class="token string">"db"</span><span class="token punctuation">:</span> <span class="token string">"json-server --watch db.json"</span></code></pre>
<p>4.在终端打开：</p>
<pre class=" language-powershell"><code class="language-powershell">npm run db</code></pre>
<p>默认监听3000这个端口，在浏览器中打开REST地址<code>http://localhost:3000/items</code>就可以访问了。</p>
<h3 id="autoprefixer-添加前缀"><a href="#autoprefixer-添加前缀" class="headerlink" title="autoprefixer 添加前缀"></a>autoprefixer 添加前缀</h3><p>1.安装包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D autoprefixer</code></pre>
<p>2.vue-loader已经包含PostCSS，则无需安装PostCSS。为了激活PostCSS，需要在项目根目录中添加一个postcss.config.js的配置文件：</p>
<pre class=" language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>这样，autoprefixer就会处理我们的代码了！</p>
<h3 id="ESLint-提升代码质量和风格"><a href="#ESLint-提升代码质量和风格" class="headerlink" title="ESLint 提升代码质量和风格"></a>ESLint 提升代码质量和风格</h3><p>ESLint提供了一系列可以开启和关闭的lint规则，用于检查代码质量。还可以通过添加插件来添加更多规则，有些包则定义了一些预设规则。</p>
<p>1.我们将使用StandardJS预设规则以及eslint-plugin-vue包，添加了更多队则，有助于遵循Vue官方风格指南：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D eslint eslint<span class="token operator">-</span>config<span class="token operator">-</span>standard eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>vue@beta</code></pre>
<p>2.安装eslint-config-standard的4个平级依赖：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>import eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>node eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>promise eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>standard</code></pre>
<p>3.为了使ESLint解析文件时支持使用Babel的JavaScript代码，需要安装一个额外的包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D babel<span class="token operator">-</span>eslint</code></pre>
<h4 id="配置ESLint"><a href="#配置ESLint" class="headerlink" title="配置ESLint"></a>配置ESLint</h4><p>在项目的根目录中创建一个.eslintrc.js文件并写入以下配置：</p>
<pre class=" language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 仅使用本配置</span>
  root<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 文件解析器</span>
  parser<span class="token punctuation">:</span> <span class="token string">'vue-eslint-parser'</span><span class="token punctuation">,</span>
  parserOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 对JavaScript使用babel-eslint</span>
    <span class="token string">'parser'</span><span class="token punctuation">:</span> <span class="token string">'babel-eslint'</span><span class="token punctuation">,</span>
    <span class="token string">'ecmaVersion'</span><span class="token punctuation">:</span> <span class="token number">2017</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// 使用import/export语法</span>
    <span class="token string">'sourceType'</span><span class="token punctuation">:</span> <span class="token string">'module'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 全局环境对象</span>
  env<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    browser<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    es6<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 指定预设规则</span>
  <span class="token keyword">extends</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment" spellcheck="true">// https://github.com/feross/standard/blob/master/RULES.md#javascript-standard-style</span>
    <span class="token string">'standard'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// https://github.com/vuejs/eslint-plugin-vue#bulb-rules</span>
    <span class="token string">'plugin:vue/recommended'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>自定义规则</li>
</ul>
<pre class=" language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// https://github.com/babel/babel-eslint/issues/517</span>
    <span class="token string">'no-use-before-define'</span><span class="token punctuation">:</span> <span class="token string">'off'</span><span class="token punctuation">,</span>
    <span class="token string">'comma-dangle'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'always-multiline'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h4 id="运行ESLint"><a href="#运行ESLint" class="headerlink" title="运行ESLint"></a>运行ESLint</h4><p>在package.json添加一个script脚本：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
  <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"eslint"</span><span class="token punctuation">:</span> <span class="token string">"eslint --ext .js,.jsx,.vue src"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>一些问题可以通过在eslint命令中加入–fix参数自动修复：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token string">"eslint"</span><span class="token punctuation">:</span> <span class="token string">"eslint --ext .js,.jsx,.vue src --fix"</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>如果出现Do not use ‘new’ for side effects no-new错误</strong>，需要为错误代码禁用<code>no-new</code>这条规则，在代码前加上一条特殊的注释即可：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// eslint-disable-next-line no-new</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h4 id="在Webpack中使用ESLint"><a href="#在Webpack中使用ESLint" class="headerlink" title="在Webpack中使用ESLint"></a>在Webpack中使用ESLint</h4><p>1.将eslint-loader和friendly-errors-webpack-plugin包一起安装到开发依赖，后者能优化控制台信息：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D eslint<span class="token operator">-</span>loader friendly<span class="token operator">-</span>errors<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin</code></pre>
<p>2.在webpack.config.js中，module.rules顶部添加新的规则：</p>
<pre class=" language-js"><code class="language-js">module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(jsx?|vue)$/</span><span class="token punctuation">,</span>
      loader<span class="token punctuation">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
      enforce<span class="token punctuation">:</span> <span class="token string">'pre'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>3.导入friendly-errors-webpack-plugin：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> FriendlyErrors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span></code></pre>
<p>4.在开发模式中添加这个插件：</p>
<pre class=" language-js"><code class="language-js">plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token comment" spellcheck="true">// ...</span>
  <span class="token keyword">new</span> <span class="token class-name">FriendlyErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre>
<p>现在运行npm run dev，可以在webpack输出中看到ESLint错误信息。<br>没有错误，则看到<code>DONE</code>信息。</p>
<h3 id="Jest-单元测试"><a href="#Jest-单元测试" class="headerlink" title="Jest 单元测试"></a>Jest 单元测试</h3><p>1.安装包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D jest vue<span class="token operator">-</span>test<span class="token operator">-</span>utils</code></pre>
<p>2.还需要安装一些与vue相关的使用工具，以便使用jest-vue来编译.vue文件，并创建组件快照：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D vue<span class="token operator">-</span>jest jest<span class="token operator">-</span>serializer<span class="token operator">-</span>vue vue<span class="token operator">-</span>server<span class="token operator">-</span>renderer</code></pre>
<p>需要安装一些Babel包来支持Babel编译，并在Jest内动态导入Webpack：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D babel<span class="token operator">-</span>jest babel<span class="token operator">-</span>plugin<span class="token operator">-</span>dynamic<span class="token operator">-</span>import<span class="token operator">-</span>node</code></pre>
<p><strong>babel-jest不支持babel7，jest运行会报错</strong><br>所以，如果你的babel/core版本为7.x，需要安装包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D babel<span class="token operator">-</span>core@^7<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token operator">-</span>bridge<span class="token punctuation">.</span>0</code></pre>
<h4 id="配置Jest"><a href="#配置Jest" class="headerlink" title="配置Jest"></a>配置Jest</h4><p>在项目根目录中创建jest.config.js来配置Jest：</p>
<pre class=" language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  transform<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'.+\\.jsx?$'</span><span class="token punctuation">:</span> <span class="token string">'&lt;rootDir>/node_modules/babel-jest'</span><span class="token punctuation">,</span>
    <span class="token string">'.+\\.vue$'</span><span class="token punctuation">:</span> <span class="token string">'&lt;rootDir>/node_modules/vue-jest'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  snapshotSerializers<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">'&lt;rootDir>/node_modules/jest-serializer-vue'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  mapCoverage<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre>
<p>为了支持JavaScript import/export 模块以及Jest中的动态导入，需要为Jest配置Babel：</p>
<ul>
<li>如果是babel7，.babelrc文件是这样的：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment" spellcheck="true">// Stage 3</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"env"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"transform-es2015-modules-commonjs"</span><span class="token punctuation">,</span>
        <span class="token string">"dynamic-import-node"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>如果是babel6：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"modules"</span><span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"stage-0"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"env"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"transform-es2015-modules-commonjs"</span><span class="token punctuation">,</span>
        <span class="token string">"dynamic-import-node"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="第一个单元测试"><a href="#第一个单元测试" class="headerlink" title="第一个单元测试"></a>第一个单元测试</h4><p>为了使所有地方都默认支持Jest，文件应该命名为component.test.js或者component.spec.js。</p>
<p>1.在src/components文件夹中创建一个测试文件，如BaseButton.spec.js，从vue-test-utils中导入组件及shallow方法：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> BaseButton <span class="token keyword">from</span> <span class="token string">'./BaseButton.vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-test-utils'</span></code></pre>
<p>2.通过<code>describe</code>函数创建测试套件：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'BaseButton'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 测试</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>3.在测试套件内，通过test函数添加第一个单元测试：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'BaseButton'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'click event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 测试代码</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>4.在组件外创建一个wrapper对象，它将提供用于测试这个组件的函数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span>BaseButton<span class="token punctuation">)</span></code></pre>
<p>5.我们要测试点击这个组件时是否会触发click事件，模拟对组件的点击：</p>
<pre class=" language-js"><code class="language-js">wrapper<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span></code></pre>
<p>6.使用Jest的expect方法检测是否触发了click事件：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>7.在package.json中添加运行Jest的脚本：</p>
<pre class=" language-js"><code class="language-js"><span class="token string">"jest"</span><span class="token punctuation">:</span> <span class="token string">"jest"</span></code></pre>
<p>8.然后在终端运行：</p>
<pre class=" language-powershell"><code class="language-powershell">npm run jest</code></pre>
<h4 id="ESLint和Jest全局变量"><a href="#ESLint和Jest全局变量" class="headerlink" title="ESLint和Jest全局变量"></a>ESLint和Jest全局变量</h4><p>ESLint检查测试文件会对<code>describe</code>，<code>test</code>， <code>expect</code>等关键字报错，所以要在.eslintrc.js指定jest环境：</p>
<pre class=" language-js"><code class="language-js">env<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  browser<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  es6<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  jest<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre>
<p>现在就不会再出现错误提示了！</p>
<h4 id="Jest快照"><a href="#Jest快照" class="headerlink" title="Jest快照"></a>Jest快照</h4><p>Jest快照是在每次运行测试时保存并比较的字符串，可以检测潜在的退化。</p>
<p>对于Vue组件，我们将通过名为<code>vue-server-renderer</code>的服务端渲染工具保存HTML渲染快照：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createRenderer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-server-renderer'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> renderer <span class="token operator">=</span> <span class="token function">createRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span>BaseButton<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      icon<span class="token punctuation">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span>
      disabled<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      badge<span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    slots<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">'&lt;span>Add Item&lt;/span>'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h5 id="更新快照"><a href="#更新快照" class="headerlink" title="更新快照"></a>更新快照</h5><p>使用<code>--updateSnapshot</code>参数时，当vue文件修改之后再次测试，不会提示快照不再匹配。<br>1.在package.json添加一个脚本：</p>
<pre class=" language-js"><code class="language-js"><span class="token string">"jest"</span><span class="token punctuation">:</span> <span class="token string">"jest --updateSnapshot"</span></code></pre>
<p>2.通过新的脚本更新快照：</p>
<pre class=" language-powershell"><code class="language-powershell">npm run jest:update</code></pre>
<h3 id="i18n-国际化和代码拆分"><a href="#i18n-国际化和代码拆分" class="headerlink" title="i18n 国际化和代码拆分"></a>i18n 国际化和代码拆分</h3><p><a href="http://kazupon.github.io/vue-i18n/zh/introduction.html" target="_blank" rel="noopener">官网</a><br>安装包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>S vue<span class="token operator">-</span>i18n</code></pre>
<p>1.安装插件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueI18n <span class="token keyword">from</span> <span class="token string">'vue-i18n'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueI18n<span class="token punctuation">)</span></code></pre>
<p>2.在项目根目录新建一个i18n文件夹，在其中新建index.js，里面导出了应用支持的语言列表：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token string">'en'</span><span class="token punctuation">,</span>
  <span class="token string">'fr'</span><span class="token punctuation">,</span>
  <span class="token string">'es'</span><span class="token punctuation">,</span>
  <span class="token string">'de'</span><span class="token punctuation">,</span>
  <span class="token string">'zh'</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">]</span></code></pre>
<p>3.在index.js旁边新建文件夹locales，并在locales下创建翻译文件</p>
<ul>
<li>en.js：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token string">'change-lang'</span><span class="token punctuation">:</span> <span class="token string">'Change language'</span><span class="token punctuation">,</span>
  lang<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    en<span class="token punctuation">:</span> <span class="token string">'English'</span><span class="token punctuation">,</span>
    fr<span class="token punctuation">:</span> <span class="token string">'Français'</span><span class="token punctuation">,</span>
    es<span class="token punctuation">:</span> <span class="token string">'Español'</span><span class="token punctuation">,</span>
    de<span class="token punctuation">:</span> <span class="token string">'Deutsch'</span><span class="token punctuation">,</span>
    zh<span class="token punctuation">:</span> <span class="token string">'简体中文'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  back<span class="token punctuation">:</span> <span class="token string">'Back'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>zh.js：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token string">'change-lang'</span><span class="token punctuation">:</span> <span class="token string">'选择语言'</span><span class="token punctuation">,</span>
  lang<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    en<span class="token punctuation">:</span> <span class="token string">'English'</span><span class="token punctuation">,</span>
    fr<span class="token punctuation">:</span> <span class="token string">'Français'</span><span class="token punctuation">,</span>
    es<span class="token punctuation">:</span> <span class="token string">'Español'</span><span class="token punctuation">,</span>
    de<span class="token punctuation">:</span> <span class="token string">'Deutsch'</span><span class="token punctuation">,</span>
    zh<span class="token punctuation">:</span> <span class="token string">'简体中文'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  back<span class="token punctuation">:</span> <span class="token string">'返回'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>de.js, es.js, fr.js…</li>
</ul>
<p><strong>在编书时还需要<code>babel-preset-stage-2</code>（或更低），以便Babel能解析动态导入</strong></p>
<p><a href="https://babeljs.io/docs/en/v7-migration" target="_blank" rel="noopener">升级到Babel7</a></p>
<ul>
<li>babel6:</li>
</ul>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D babel<span class="token operator">-</span>preset<span class="token operator">-</span>stage<span class="token operator">-</span>2</code></pre>
<ul>
<li>babel7:</li>
</ul>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>D @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span>decorators @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span><span class="token keyword">function</span><span class="token operator">-</span>sent @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span>export<span class="token operator">-</span>namespace<span class="token operator">-</span><span class="token keyword">from</span> @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span>numeric<span class="token operator">-</span>separator @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span><span class="token keyword">throw</span><span class="token operator">-</span>expressions</code></pre>
<h4 id="动态导入的代码拆分"><a href="#动态导入的代码拆分" class="headerlink" title="动态导入的代码拆分"></a>动态导入的代码拆分</h4><p>通过import函数对文件进行动态导入，它需要将路径作为接收参数并返回一个Promise，这个Promise会在从服务器加载完毕后最终确定对应的JavaScript模块。<br>在Webpack中，动态导入功能有时候也叫“代码拆分”。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> createI18n <span class="token punctuation">(</span>locale<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 动态导入加载异步模块</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token punctuation">:</span> localeMessages <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`../../i18n/locales/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>locale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>locale<span class="token punctuation">]</span><span class="token punctuation">:</span> localeMessages<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// 传入locale参数</span>
  <span class="token keyword">const</span> i18n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueI18n</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    locale<span class="token punctuation">,</span>
    messages<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> i18n
<span class="token punctuation">}</span></code></pre>
<h4 id="自动加载用户区域设置"><a href="#自动加载用户区域设置" class="headerlink" title="自动加载用户区域设置"></a>自动加载用户区域设置</h4><p>1.获取语言包：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> getAutoLang <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 通过 navigator.userLanguage 来获取区域代码</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>userLanguage <span class="token operator">||</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>language
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment" spellcheck="true">// 默认en</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>langs<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'en'</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>2.在src/main.js中，导入如下两个新的工具函数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createI18n<span class="token punctuation">,</span> getAutoLang <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./utils/i18n'</span></code></pre>
<p>3.然后修改main函数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> main <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// 获取首选区域设置</span>
  <span class="token keyword">const</span> locale <span class="token operator">=</span> <span class="token function">getAutoLang</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">// 创建并等待返回i18n函数</span>
  <span class="token keyword">const</span> i18n <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createI18n</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>locale<span class="token punctuation">)</span>
  <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span>

  <span class="token comment" spellcheck="true">// eslint-disable-next-line no-new</span>
  <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
    router<span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    i18n<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 将i18n注入应用</span>
    <span class="token operator">...</span>App<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="更改语言页面"><a href="#更改语言页面" class="headerlink" title="更改语言页面"></a>更改语言页面</h4><p>1.在src/router.js导入PageLocale组件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> PageLocale <span class="token keyword">from</span> <span class="token string">'./components/PageLocale.vue'</span></code></pre>
<p>2.接着在routes数组的最后一个路由之前加入locale路由：</p>
<pre class=" language-js"><code class="language-js">  <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/locale'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'locale'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> PageLocale <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<p>3.在AppFooter.vue中，将路由加入模板：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$route.name !<span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>locale<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{name: <span class="token punctuation">'</span>locale<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ $t('change-lang') }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>PageLocale的代码如下：</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BasePage</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>page-locale<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fade<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BaseLoading</span>
        <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span>
        <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>overlay<span class="token punctuation">"</span></span>
      <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'change-lang'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>locales<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
            <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lang</span> <span class="token attr-name">of</span> <span class="token attr-name">langs"</span>
            <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>lang<span class="token punctuation">"</span></span>
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>locale<span class="token punctuation">"</span></span>
          <span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BaseButton</span>
              <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{</span> <span class="token attr-name"><span class="token namespace">selected:</span></span> <span class="token attr-name">lang</span> <span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span></span> <span class="token attr-name">$i18n.locale</span> <span class="token attr-name">}"</span>
              <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setLocale(lang)<span class="token punctuation">"</span></span>
            <span class="token punctuation">></span></span>
              <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`lang.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lang<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BaseButton</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>toolbar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BaseButton</span>
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>secondary<span class="token punctuation">"</span></span>
            <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>goBack<span class="token punctuation">"</span></span>
          <span class="token punctuation">></span></span>
            <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'back'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BaseButton</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BasePage</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> langs <span class="token keyword">from</span> <span class="token string">'../../i18n'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  data <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      langs<span class="token punctuation">,</span>
      loading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    goBack <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token keyword">async</span> setLocale <span class="token punctuation">(</span>locale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span>messages<span class="token punctuation">[</span>locale<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token punctuation">:</span> messages <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`../../i18n/locales/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>locale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span><span class="token function">setLocaleMessage</span><span class="token punctuation">(</span>locale<span class="token punctuation">,</span> messages<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span>locale <span class="token operator">=</span> locale
      <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylus<span class="token punctuation">"</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">/* ... */</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre>
<h3 id="moment"><a href="#moment" class="headerlink" title="moment"></a>moment</h3><p>1.安装包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>S moment</code></pre>
<p>2.<code>filters.js</code>：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">"moment"</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> date <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">moment</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>3.导入<code>main.js</code>并全局注册：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> filters <span class="token keyword">from</span> <span class="token string">'./filters'</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> filters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> filters<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>vue-plugin</tag>
        <tag>axios</tag>
        <tag>json-server</tag>
        <tag>autoprefixer</tag>
        <tag>ESLint</tag>
        <tag>Jest</tag>
        <tag>i18n</tag>
        <tag>moment</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript</title>
    <url>/2019/08/06/JavaScript/</url>
    <content><![CDATA[<h3 id><a href="#" class="headerlink" title="!!"></a><code>!!</code></h3><p>类型转换：将对应的类型转换为boolean型<br><strong>!!b指的是将b转换为boolean值</strong>，<em>取两次非是因为将b转换位boolean值后取了一次非，所以得到的值正好相反，再取一次反回来</em></p>
<a id="more"></a>
<h3 id="计算运行时间（性能）"><a href="#计算运行时间（性能）" class="headerlink" title="计算运行时间（性能）"></a>计算运行时间（性能）</h3><iframe id="cp_embed_pMpZpe" src="//codepen.io/siluo2000/embed/pMpZpe?height=500&theme-id=dark&slug-hash=pMpZpe&default-tab=[js,result]&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>

<p>总结:</p>
<ol>
<li>有开有关</li>
<li>参数一致</li>
<li>ie不支持,要使用Date计算</li>
</ol>
<h3 id="document-addEventListener"><a href="#document-addEventListener" class="headerlink" title="document.addEventListener"></a>document.addEventListener</h3><p>参考资料：<a href="http://blog.sina.com.cn/s/blog_5d64f7e301017qdp.html" target="_blank" rel="noopener">js之事件冒泡和事件捕获</a></p>
<p>1.冒泡和下沉<br><code>document.addEventListener(&quot;事件名称&quot;, 函数, Boolean);</code><br>addEventListener里最后一个参数决定该事件的响应顺序；</p>
<iframe id="cp_embed_bXajyB" src="//codepen.io/siluo2000/embed/bXajyB?height=500&theme-id=dark&slug-hash=bXajyB&default-tab=js,result&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>

<ul>
<li>true 的触发顺序总是在 false 之前；</li>
<li>如果多个均为 true，则外层的触发先于内层；</li>
<li>如果多个均为 false，则内层的触发先于外层。</li>
</ul>
<p>2.解决让一个js事件执行多个函数</p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span>onclick<span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// --->只输出b</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// --->输出a,b</span></code></pre>
]]></content>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS</title>
    <url>/2019/08/06/CSS/</url>
    <content><![CDATA[<h3 id="offsetTop"><a href="#offsetTop" class="headerlink" title="offsetTop"></a>offsetTop</h3><ol>
<li>父级边框不算</li>
<li>offsetTop是相对 relative 的定位</li>
</ol>
<a id="more"></a>

<h3 id="nth-child-amp-nth-of-type"><a href="#nth-child-amp-nth-of-type" class="headerlink" title="nth-child &amp; nth-of-type"></a>nth-child &amp; nth-of-type</h3><iframe id="cp_embed_oKMRaR" src="//codepen.io/siluo2000/embed/oKMRaR?height=500&theme-id=dark&slug-hash=oKMRaR&default-tab=[html,result]&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>

<h3 id="手机屏幕分辨率-amp-手机浏览器分辨率"><a href="#手机屏幕分辨率-amp-手机浏览器分辨率" class="headerlink" title="手机屏幕分辨率 &amp; 手机浏览器分辨率"></a>手机屏幕分辨率 &amp; 手机浏览器分辨率</h3><p>手机屏幕分辨率<br>做手机应用时：<br><code>@media screen and (min-device-width:640px) and (max-device-width:960px)</code><br>手机浏览器分辨率<br><code>@media screen and (min-width:320px) and (max-width:480px)</code></p>
<pre class=" language-js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"浏览器分辨率是"</span><span class="token operator">+</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientWidth<span class="token operator">+</span><span class="token string">"*"</span><span class="token operator">+</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight <span class="token punctuation">)</span><span class="token punctuation">;</span>  
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"屏幕分辨率是"</span><span class="token operator">+</span>window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token operator">+</span><span class="token string">"*"</span><span class="token operator">+</span>window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="负边距"><a href="#负边距" class="headerlink" title="负边距"></a>负边距</h3><p>在文档流中，元素的最终边界是由margin决定的，margin为负的时候就相当于元素的边界向里收，文档流认的只是这个边界，不会管你实际的尺寸是多少。</p>
<iframe id="cp_embed_eqKEqy" src="//codepen.io/siluo2000/embed/eqKEqy?height=500&theme-id=dark&slug-hash=eqKEqy&default-tab=[html,result]&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>

<h3 id="清浮动"><a href="#清浮动" class="headerlink" title="清浮动"></a>清浮动</h3><p>1.给浮动元素父级加float — 不实用<br>2.空标签清浮动</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">
  <span class="token selector"><span class="token class">.clear</span></span><span class="token punctuation">{</span> <span class="token property">clear</span><span class="token punctuation">:</span>both<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clear<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>3.在父级加<code>overflow: hidden</code>清浮动</p>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.clear</span></span><span class="token punctuation">{</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">zoom</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>4.after伪类清浮动</p>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.clear</span></span><span class="token punctuation">{</span>
  <span class="token property">zoom</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.clear</span><span class="token pseudo-element">:after</span></span><span class="token punctuation">{</span>
  <span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* Firefox &lt; 3.5 */</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>Bootstrap3的清除是这样的：</li>
</ul>
<pre class=" language-css"><code class="language-css"><span class="token comment" spellcheck="true">/**
 * 现代浏览器
 * 1. content的空格内容是为了避免Opera浏览器bug，但是它会导致空格内容出现在元素顶部和底部。
 * 2. 当使用 `before` 包含子元素的上边距时，必须使用 `table` 而不使用 `block`，可以防止上边距折叠。
 */</span>
<span class="token selector"><span class="token class">.cf</span><span class="token pseudo-element">:before</span>,
<span class="token class">.cf</span><span class="token pseudo-element">:after</span> </span><span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">" "</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 1 */</span>
  <span class="token property">display</span><span class="token punctuation">:</span> table<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* 2 */</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.cf</span><span class="token pseudo-element">:after</span> </span><span class="token punctuation">{</span>
  <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * For IE 6/7 only
 * 触发hasLayout并清除浮动
 */</span>
<span class="token selector"><span class="token class">.cf</span> </span><span class="token punctuation">{</span>
  *<span class="token property">zoom</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>支持：Firefox 3.5 +，Safari 4 +，Chrome，Opera 9 +，IE 6+</strong><br>资料：<a href="http://nicolasgallagher.com/micro-clearfix-hack/" target="_blank" rel="noopener">clearfix hack</a></p>
<ul>
<li>Bootstrap4的清除是这样的：</li>
</ul>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.clearfix</span><span class="token pseudo-element">::after</span></span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
  <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="两端对齐"><a href="#两端对齐" class="headerlink" title="两端对齐"></a>两端对齐</h3><p>参考资料：<a href="https://www.cnblogs.com/runhua/p/7106060.html" target="_blank" rel="noopener">css：text-align：justify的用法</a></p>
<iframe id="cp_embed_OKEqWz" src="//codepen.io/siluo2000/embed/OKEqWz?height=500&theme-id=dark&slug-hash=OKEqWz&default-tab=[html,result]&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>

<h3 id="样式系统匹配规则"><a href="#样式系统匹配规则" class="headerlink" title="样式系统匹配规则"></a>样式系统匹配规则</h3><p>样式系统匹配规则是从key selector开始的，然后往左移动（根据选择器寻找任何的祖先元素）。</p>
<h3 id="CSS选择器"><a href="#CSS选择器" class="headerlink" title="CSS选择器"></a>CSS选择器</h3><p>比较难记的：</p>
<iframe id="cp_embed_xvzvjp" src="//codepen.io/siluo2000/embed/xvzvjp?height=500&theme-id=dark&slug-hash=xvzvjp&default-tab=[html,result]&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>

<h3 id="inline-block兼容"><a href="#inline-block兼容" class="headerlink" title="inline-block兼容"></a>inline-block兼容</h3><ul>
<li><p>兼容问题：</p>
<ol>
<li>IE6、IE7不识别inline-block</li>
<li>IE8  resize-bug</li>
</ol>
</li>
<li><p>兼容写法：</p>
</li>
</ul>
<pre class=" language-css"><code class="language-css"><span class="token selector">selector</span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span>inline-block<span class="token punctuation">;</span>
  <span class="token property">zoom</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/*IE 下触发 hasLayout*/</span>
  *<span class="token property">display</span><span class="token punctuation">:</span>inline<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/*一旦IE下触发了hasLayout，设置 block 元素为 inline 会使 display:inline 效果与 display:inline-block 相似*/</span>
<span class="token punctuation">}</span></code></pre>
]]></content>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML</title>
    <url>/2019/08/06/HTML/</url>
    <content><![CDATA[<h3 id="lt-table-gt"><a href="#lt-table-gt" class="headerlink" title="&lt;table&gt;"></a><code>&lt;table&gt;</code></h3><iframe id="cp_embed_NQwQpX" src="//codepen.io/siluo2000/embed/NQwQpX?height=500&theme-id=dark&slug-hash=NQwQpX&default-tab=[html,result]&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>
<a id="more"></a>

<h3 id="行内元素"><a href="#行内元素" class="headerlink" title="行内元素"></a>行内元素</h3><p>内联元素 inline element，中文叫法有多种：内联元素、内嵌元素、行内元素、直进式元素等。<br>比较特别的行元素：<code>&lt;textarea&gt;</code> <code>&lt;select&gt;</code></p>
<h3 id="Unicode-UTF-8"><a href="#Unicode-UTF-8" class="headerlink" title="Unicode UTF-8"></a>Unicode UTF-8</h3><h4 id="什么是Unicode"><a href="#什么是Unicode" class="headerlink" title="什么是Unicode"></a>什么是Unicode</h4><p>Universal Multiple-Octet Coded Character Set,简称UCS.<br>Unicode（统一码、万国码、单一码）是一种在计算机上使用的字符编码.<br>Unicode是国际组织制定的可以容纳世界上所有文字和符号的字符编码方案。Unicode用数字0-0x10FFFF来映射这些字符，最多可以容纳1114112个字符，或者说有1114112个码位。码位就是可以分配给字符的数字。UTF-8、UTF-16、UTF-32都是将数字转换到程序数据的编码方案。<br>中文范围 4E00-9FBF</p>
<h4 id="什么是UCS-2、UCS-4"><a href="#什么是UCS-2、UCS-4" class="headerlink" title="什么是UCS-2、UCS-4"></a>什么是UCS-2、UCS-4</h4><p>UCS-2用两个字节编码，UCS-4用4个字节编码。<br>UCS-2也称为基本多文种平面。<br>UCS-2转换到UCS-4只是简单的在前面加２个字节0。</p>
<h4 id="什么是UTF-8"><a href="#什么是UTF-8" class="headerlink" title="什么是UTF-8"></a>什么是UTF-8</h4><p>UTF是“UCS Transformation Format”的缩写，可以翻译成Unicode字符集转换格式。</p>
<table>
<thead>
<tr>
<th>Unicode编码(十六进制)</th>
<th>UTF-8 字节流(二进制)</th>
</tr>
</thead>
<tbody><tr>
<td>000000 - 00007F</td>
<td>0xxxxxxx</td>
</tr>
<tr>
<td>000080 - 0007FF</td>
<td>110xxxxx 10xxxxxx</td>
</tr>
<tr>
<td>000800 - 00FFFF</td>
<td>1110xxxx 10xxxxxx 10xxxxxx</td>
</tr>
<tr>
<td>010000 - 10FFFF</td>
<td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
</tr>
</tbody></table>
<p>UTF-8的特点是对不同范围的字符使用不同长度的编码。<br>对于0x00-0x7F之间的字符，UTF-8编码与ASCII编码完全相同。UTF-8编码的最大长度是4个字节。从上表可以看出，4字节模板有21个x，即可以容纳21位二进制数字。Unicode的最大码位0x10FFFF也只有21位。</p>
<h3 id="utf8-unicode-ci-amp-utf8-general-ci"><a href="#utf8-unicode-ci-amp-utf8-general-ci" class="headerlink" title="utf8_unicode_ci &amp; utf8_general_ci"></a>utf8_unicode_ci &amp; utf8_general_ci</h3><ol>
<li>对于一种语言仅当使用utf8_unicode_ci排序做的不好时，才执行与具体语言相关的utf8字符集校对规则。例如，对于德语和法语，utf8_unicode_ci工作的很好，因此不再需要为这两种语言创建特殊的utf8校对规则。</li>
<li>utf8_general_ci也适用与德语和法语，除了‘?’等于‘s’，而不是‘ss’之外。如果你的应用能够接受这些，那么应该使用 utf8_general_ci，因为它速度快。否则，使用utf8_unicode_ci，因为它比较准确。</li>
</ol>
<p>用一句话概况上面这段话：utf8_unicode_ci比较准确，utf8_general_ci速度比较快。通常情况下 utf8_general_ci的准确性就够我们用的了，在我看过很多程序源码后，发现它们大多数也用的是utf8_general_ci，所以新建数据库时一般选用utf8_general_ci就可以了。</p>
<h3 id="language-quot-Javascript-quot"><a href="#language-quot-Javascript-quot" class="headerlink" title="language=&quot;Javascript&quot;"></a><code>language=&quot;Javascript&quot;</code></h3><p>在制作网页的时候，往往需要在页面中使用客户端能够运行的JS代码，因此，都需要添加引用。<br>JS引用一般有type=”text/javascript”和language=”Javascript”两种写法，但language这个属性在W3C的HTML标准中，<strong>已不再推荐使用</strong>。</p>
<h3 id="xmlns"><a href="#xmlns" class="headerlink" title="xmlns"></a>xmlns</h3><p>xmlns 属性在 XHTML 中是必需的。不过即使你的 XHTML 文档没有使用此属性，W3C 的验证器也不会报错。因为 <code>&quot;xmlns=http://www.w3.org/1999/xhtml&quot;</code> 是一个固定值，所以，即使你没有包含它，此值也会被添加到 <code>&lt;html&gt;</code> 标签中。</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- xmlns            是用来定义xml namespace属性的 --></span>
<span class="token comment" spellcheck="true">&lt;!-- xml:lang="en"    指明编码为英文 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xhtml<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xml:</span>lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 常见用法 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zh-CN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
<h3 id="SEO"><a href="#SEO" class="headerlink" title="SEO"></a>SEO</h3><p>SEO由英文Search Engine Optimization缩写而来， 中文意译为“搜索引擎优化”。</p>
<h4 id="meta、title"><a href="#meta、title" class="headerlink" title="meta、title"></a><code>meta</code>、<code>title</code></h4><p>META标签分两大部分：HTTP标题信息（HTTP-EQUIV）和页面描述信息（NAME）。<br><code>&lt;meta name=&quot;keywords&quot; content=&quot;为搜索引擎提供的关键字列表&quot;&gt;</code><br>各关键词间用英文逗号“,”隔开。META的通常用处是指定搜索引擎用来提高搜索质量的关键词。<br>当数个META元素提供文档语言从属信息时，搜索引擎会使用lang特性来过滤并通过用户的语言优先参照来显示搜索结果。<br><code>&lt;meta name=&quot;description&quot; content=&quot;用来告诉搜索引擎，你的网站主要内容&quot;&gt;</code></p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- HTML 和 XHTML 标签都没有指定任何预先定义的 &lt;meta> 名称 --></span>
<span class="token comment" spellcheck="true">&lt;!-- "keywords" 是一个经常被用到的名称。它为文档定义了一组关键字。某些搜索引擎在遇到这些关键字时，会用这些关键字对文档进行分类。 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment" spellcheck="true">&lt;!-- http-equiv指示服务器在发送实际的文档之前先在要传送给浏览器的 MIME 文档头部包含名称/值对。 --></span>
<span class="token comment" spellcheck="true">&lt;!-- 所有服务器都至少要向浏览器发送一个：content-type:text/html。这将告诉浏览器准备接受一个 HTML 文档。 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<ul>
<li><code>meta</code>必填属性：</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>content</td>
<td>some_text</td>
<td>定义与 http-equiv 或 name 属性相关的元信息</td>
</tr>
</tbody></table>
<ul>
<li><code>meta</code>可选属性：</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>http-equiv</td>
<td>content-type / expires / refresh / set-cookie</td>
<td>把 content 属性关联到 HTTP 头部。</td>
</tr>
<tr>
<td>name</td>
<td>author / description / keywords / generator / revised / others…</td>
<td>把 content 属性关联到一个名称。</td>
</tr>
<tr>
<td>scheme</td>
<td>some_text</td>
<td>定义用于翻译 content 属性值的格式。</td>
</tr>
</tbody></table>
<p>1.<a href="https://www.cnblogs.com/menyiin/p/6527339.html" target="_blank" rel="noopener">X-UA-Compatible</a>:</p>
<ol>
<li>X-UA-Compatible定义浏览器的渲染方式</li>
<li>IE可以变身Chrome，前提是客户端安装了Chrome Frame（Chrome有一个项目Chrome Frame，这个项目目的是在不改变IE外观的情况下使用Chrome内核，但是这个项目在2014年已经不提供支持服务了。）</li>
<li>使用IE内核浏览器来访问，会渲染至浏览器的最高版本，比如使用IE 9，就算切换到IE 7，仍会渲染到IE 9的样子</li>
</ol>
<p>2.<a href="https://blog.csdn.net/adc_god/article/details/51531263" target="_blank" rel="noopener">meta name=”renderer”</a><br>针对国内双核浏览器，控制渲染内核</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- webkit     默认用极速核 --></span>
<span class="token comment" spellcheck="true">&lt;!-- ie-comp    默认用IE兼容内核 IE6/7 --></span>
<span class="token comment" spellcheck="true">&lt;!-- ie-stand   默认用IE标准内核 取决于用户的最高IE版本--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>renderer<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>webkit|ie-comp|ie-stand<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
<h5 id="charset"><a href="#charset" class="headerlink" title="charset"></a>charset</h5><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- charset=iso-8859-1     是西欧的编码，代表说明网站是采用的编码是英文 --></span>
<span class="token comment" spellcheck="true">&lt;!-- charset=gb2312         代表说明网站是采用的编码是简体中文 --></span>
<span class="token comment" spellcheck="true">&lt;!-- charset=utf-8          代表世界通用的语言编码 --></span>
<span class="token comment" spellcheck="true">&lt;!-- charset=big5           又称为大五码或五大码，是使用繁体中文（正体中文）社区中最常用的电脑汉字字符集标准 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content-type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>iso-8859-1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 常见用法 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content-type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<h5 id="大网SEO摘抄"><a href="#大网SEO摘抄" class="headerlink" title="大网SEO摘抄"></a>大网SEO摘抄</h5><ul>
<li>淘宝网</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge,chrome<span class="token punctuation">=</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>renderer<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>webkit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>淘宝网 - 淘！我喜欢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>spm-id<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a21bo<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>淘宝网 - 亚洲较大的网上交易平台，提供各类服饰、美容、家居、数码、话费/点卡充值… 数亿优质商品，同时提供担保交易(先收货后付款)等安全交易保障服务，并由商家提供退货承诺、破损补寄等消费者保障服务，让你安心享受网上购物乐趣！<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>aplus-xplug<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>NONE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>keyword<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>淘宝,掏宝,网上购物,C2C,在线交易,交易市场,网上交易,交易市场,网上买,网上卖,购物网站,团购,网上贸易,安全购物,电子商务,放心买,供应,买卖信息,网店,一口价,拍卖,网上开店,网络购物,打折,免费开店,网购,频道,店铺<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//g.alicdn.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img.alicdn.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//tce.alicdn.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//gm.mmstat.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//tce.taobao.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//log.mmstat.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//tui.taobao.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//ald.taobao.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//gw.alicdn.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//atanx.alicdn.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//dfhs.tanx.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//ecpm.tanx.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//res.mmstat.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img.alicdn.com/tps/i3/T1OjaVFl4dXXa.JOZB-114-114.png<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>apple-touch-icon-precomposed<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<ul>
<li>京东</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>京东(JD.COM)-正品低价、品质保障、配送及时、轻松购物！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0, maximum-scale<span class="token punctuation">=</span>1.0, user-scalable<span class="token punctuation">=</span>yes<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span>
      <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>京东JD.COM-专业的综合网上购物商城,销售家电、数码通讯、电脑、家居百货、服装服饰、母婴、图书、食品等数万个品牌优质商品.便捷、诚信的服务，为您提供愉悦的网上购物体验!<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Keywords<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>网上购物,网上商城,手机,笔记本,电脑,MP3,CD,VCD,DV,相机,数码,配件,手表,存储卡,京东<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//static.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//misc.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img10.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img11.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img12.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img13.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img14.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img20.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//img30.360buyimg.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//d.3.cn<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//d.jd.com<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//www.jd.com/favicon.ico<span class="token punctuation">"</span></span> <span class="token attr-name">mce_href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//www.jd.com/favicon.ico<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>image/x-icon<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE<span class="token punctuation">=</span>edge,chrome<span class="token punctuation">=</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>renderer<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>webkit<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
</code></pre>
<ul>
<li>亚马逊</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>x-dns-prefetch-control<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>on<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//images-cn.ssl-images-amazon.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//completion.amazon.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//fls-cn.amazon.cn<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//d1y6jrbzotnyjg.cloudfront.net<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>亚马逊-网上购物商城：要网购, 就来Z.cn!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>亚马逊中国（z.cn）坚持“以客户为中心”的理念，秉承“天天低价，正品行货”信念，销售图书、电脑、数码家电、母婴百货、服饰箱包等上千万种产品。亚马逊中国提供专业服务：正品行货天天低价，机打发票全国联保。货到付款，30天内可退换货。亚马逊为中国消费者提供便利、快捷的网购体验。<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>keywords<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>网购,网上购物,在线购物,网购网站,网购商城,购物网站,网购中心,购物中心,卓越,亚马逊,卓越亚马逊,亚马逊中国,joyo,amazon<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nositelinkssearchbox<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google-site-verification<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BRIrL18qELSCSHu-BNlO7z9T0qAjBuunDmK8hLNTBI8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>baidu-site-verification<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>px8yGWK5e5<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msvalidate.01<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3C8D6512B1E530046DE0569BA27093F3<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>qc:admins<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>151133107161512766375<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>360-site-verification<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bd110b885b8997880a215e7967f6eacf<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shenma-site-verification<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>284a51a948242d608c9293a9b0c8c04e<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canonical<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.amazon.cn/<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content-type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fb:app_id<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>164734381262<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>twitter:card<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>summary<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>twitter:site:id<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>20793816<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>og:description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>亚马逊中国（z.cn）坚持“以客户为中心”的理念，秉承“天天低价，正品行货”信念，销售图书、电脑、数码家电、母婴百货、服饰箱包等上千万种产品。亚马逊中国提供专业服务：正品行货天天低价，机打发票全国联保。货到付款，30天内可退换货。亚马逊为中国消费者提供便利、快捷的网购体验。<span class="token punctuation">"</span></span>  <span class="token attr-name"><span class="token namespace">xmlns:</span>og</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://opengraphprotocol.org/schema/<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<ul>
<li>博客园</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>referrer<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>origin<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Cache-Control<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>no-transform<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Cache-Control<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>no-siteapp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>图难于其易 - 博客园<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/bundles/blog-common.css?v<span class="token punctuation">=</span>KOZafwuaDasEedEenI5aTy8aXH0epbm6VUJ0v3vsT_Q1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>MainCss<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/skins/LessIsMore/bundle-LessIsMore.css?v<span class="token punctuation">=</span>K-SPbyFTmacJSNw1O1LzZFcIaS56dT8uEKlXYOxLR9k1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/blog/customcss/215511.css?v<span class="token punctuation">=</span>L8nGtbdlgeKKuDLd%2feVyQNV2Vz8%3d<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mobile-style<span class="token punctuation">"</span></span> <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>only screen and (max-width: 767px)<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/skins/LessIsMore/bundle-LessIsMore-mobile.css?v<span class="token punctuation">=</span>Go8Bj0ZU9gZXuPSKWcSQabps3E1njgJKYz4DiOq6-N41<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>RSS<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>application/rss+xml<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alternate<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.cnblogs.com/siluo2000/rss<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>RSD<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>application/rsd+xml<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>EditURI<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.cnblogs.com/siluo2000/rsd.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>application/wlwmanifest+xml<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wlwmanifest<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://www.cnblogs.com/siluo2000/wlwmanifest.xml<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>
<h4 id="img"><a href="#img" class="headerlink" title="img"></a>img</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>图片路径<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>图片描述<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<p>图片中要加入alt，由于网速太慢，图片打不开，有alt，用户也就知道这张图片的内容了，对于电商来说，这个尤其重要，尽量给图片的尺寸要吻合，图片偏大偏小，不利于图片加载。<br>但我看了淘宝、亚马逊也不是每个图片都加<code>alt</code>的。<br>示例：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://images-cn.ssl-images-amazon.com/images/I/41pGzecSovL._SS75_.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>75<span class="token punctuation">"</span></span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>亚马逊海外购<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>75<span class="token punctuation">"</span></span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<h4 id="title"><a href="#title" class="headerlink" title="title"></a>title</h4><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre>
<ul>
<li>淘宝网：</li>
</ul>
<p>淘宝某商品页面统计： h1/0, h2/0, h3/2, h4/0,h5/0, h6/0</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//www.taobao.com<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>none</span><span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>img<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logo-bd clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>淘宝网<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">
      <span class="token selector"><span class="token class">.logo-bd</span> </span><span class="token punctuation">{</span><span class="token property">visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.tbh-ad-inner</span></span><span class="token punctuation">{</span><span class="token property">display</span><span class="token punctuation">:</span>none <span class="token important">!important</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
      <span class="token selector"><span class="token class">.decorations-box</span></span><span class="token punctuation">{</span><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector"><span class="token class">.cup</span> <span class="token class">.top</span></span><span class="token punctuation">{</span><span class="token property">padding-bottom</span><span class="token punctuation">:</span> <span class="token number">9</span>px<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token selector">body <span class="token class">.logo</span> <span class="token class">.logo-hover</span></span><span class="token punctuation">{</span><span class="token property">top</span><span class="token punctuation">:</span> -<span class="token number">42</span>px<span class="token punctuation">}</span>
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https:&amp;#x2F;&amp;#x2F;pages.tmall.com&amp;#x2F;wow&amp;#x2F;a&amp;#x2F;act&amp;#x2F;tmall&amp;#x2F;23149&amp;#x2F;pageFrame?wh_biz<span class="token punctuation">=</span>tm&amp;amp;wh_weex<span class="token punctuation">=</span>true&amp;amp;wx_main_hc<span class="token punctuation">=</span>true&amp;amp;wh_bizStageId<span class="token punctuation">=</span>765<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>logo-hover<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://img.alicdn.com/tfs/TB1APaub.Y1gK0jSZFMXXaWcVXa-190-121.gif<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">190</span>px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span><span class="token number">121</span>px<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span><span class="token number">0</span>px<span class="token punctuation">;</span><span class="token property">top</span><span class="token punctuation">:</span><span class="token number">0</span>px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre>
<ul>
<li>亚马逊：</li>
</ul>
<p>亚马逊某商品页面统计： h1/1, h2/3, h3/4, h4/1,h5/0, h6/0</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-size-large a-spacing-none<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>productTitle<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-size-large<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    Calvin Klein 墨镜 亚洲款 CK4344SA
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-state<span class="token punctuation">"</span></span> <span class="token attr-name">data-a-state</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{&amp;quot;key&amp;quot;:&amp;quot;agsMTState&amp;quot;}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token punctuation">{</span><span class="token string">"isOriginalText"</span><span class="token punctuation">:</span><span class="token string">"true"</span><span class="token punctuation">,</span><span class="token string">"showTooltip"</span><span class="token punctuation">:</span><span class="token string">"false"</span><span class="token punctuation">,</span><span class="token string">"tooltipContent"</span><span class="token punctuation">:</span><span class="token string">"中文翻译，点击查看"</span><span class="token punctuation">}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>agsMT-popover<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ags-mt-popover-title-badge<span class="token punctuation">"</span></span> <span class="token attr-name">data-asin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>B07T9CMPK3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ags-mt-popover-title<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>javascript:void(0)<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-popover-trigger a-declarative agsMT-badge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      原文
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-icon a-icon-popover<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>agsMT-legal-disclaimer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a-color-tertiary a-text-normal<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      页面含机器翻译，中文仅供参考，以原文为准
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre>
<p>H1-H6：</p>
<ul>
<li>按照权重，重要的标题需用H1标签，以此类推，一般页面中最少有一个H1标签，在标题中也要加上title(但是淘宝和亚马逊都没有title属性？)</li>
<li>不能乱用，h1只能在网页出现一次</li>
</ul>
<p>Strong、em标签与b、i标签：如果想要强调加粗、倾斜需用Strong、em标签，一般加粗、倾斜用b、i标签就可以（或者通过css样式写出来）。</p>
<h4 id="外链"><a href="#外链" class="headerlink" title="外链"></a>外链</h4><p><strong>外链建设不要含数量</strong> 关键词的排名虽然跟外链建设息息相关，但并不是跟外链数量直接挂钩。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol>
<li><a href="https://www.cnblogs.com/menyiin/p/6527339.html" target="_blank" rel="noopener">浅析网页meta标签中X-UA-Compatible属性的使用</a></li>
<li><a href="https://www.w3school.com.cn/tags/tag_meta.asp" target="_blank" rel="noopener">w3school - HTML <code>&lt;meta&gt;</code> 标签</a></li>
<li><a href="https://www.taobao.com/" target="_blank" rel="noopener">淘宝网</a></li>
<li><a href="https://www.jd.com/" target="_blank" rel="noopener">京东</a></li>
<li><a href="https://www.amazon.cn/" target="_blank" rel="noopener">亚马逊</a></li>
<li><a href="https://www.cnblogs.com/" target="_blank" rel="noopener">博客园</a></li>
</ol>
]]></content>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>前端基础知识零碎</title>
    <url>/2019/08/05/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E9%9B%B6%E7%A2%8E/</url>
    <content><![CDATA[<h3 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h3><h4 id="在手机上测试网页遇到的问题"><a href="#在手机上测试网页遇到的问题" class="headerlink" title="在手机上测试网页遇到的问题"></a>在手机上测试网页遇到的问题</h4><p>前提： wamp环境，手机和电脑在同一个路由下，无法用手机打开电脑网页</p>
<ol>
<li>首先关闭电脑上的防火墙</li>
<li>看看机器上是否有些什么杀毒软件，例如机器上有一个偌顿（ESET），关闭上面的防火墙设置</li>
<li>看看你的电脑上是否允许访问80端口</li>
</ol>
<a id="more"></a>

<h4 id="jquery表单序列化"><a href="#jquery表单序列化" class="headerlink" title="jquery表单序列化"></a>jquery表单序列化</h4><pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 1.serialize</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//序列化</span>
params <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//解决中文乱码</span>

<span class="token comment" spellcheck="true">// 2.serializeArray，不需要decodeURIComponent</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serializeArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment" spellcheck="true">//序列化</span></code></pre>
<iframe id="cp_embed_ymRVoV" src="//codepen.io/siluo2000/embed/ymRVoV?height=500&theme-id=dark&slug-hash=ymRVoV&default-tab=js,result&embed-version=2" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>
]]></content>
  </entry>
  <entry>
    <title>Vue入门笔记四(vue-router)</title>
    <url>/2019/08/05/Vue%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%E5%9B%9B-vue-router/</url>
    <content><![CDATA[<blockquote>
<p>《Vue.js项目实战》</p>
</blockquote>
<h2 id="vue-router"><a href="#vue-router" class="headerlink" title="vue-router"></a>vue-router</h2><a id="more"></a>

<h3 id="安装vue-router"><a href="#安装vue-router" class="headerlink" title="安装vue-router"></a>安装vue-router</h3><p>1.在项目目录中使用以下命令从<code>npm</code>下载<code>vue-router</code>包：</p>
<pre class=" language-powershell"><code class="language-powershell">npm install <span class="token operator">-</span>S vue<span class="token operator">-</span>router</code></pre>
<p>2.在<code>main.js</code>文件旁边创建<code>router.js</code>，并从相应的包中导入<code>Vue</code>库和<code>VueRouter</code>插件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span></code></pre>
<p>3.然后将该插件安装到<code>Vue</code>中：</p>
<pre class=" language-js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="使用router-view进行布局"><a href="#使用router-view进行布局" class="headerlink" title="使用router-view进行布局"></a>使用<code>router-view</code>进行布局</h3><p>在需要渲染路由的其他组件中，如<code>App.vue</code>，添加<code>&lt;router-view /&gt;</code>组件：</p>
<ul>
<li><code>&lt;router-view /&gt;</code>组件是由vue-router插件提供的一个特殊组件，它将渲染匹配当前路由的组件</li>
<li><code>&lt;router-view /&gt;</code>不是一个真正的组件，因为它没有自己的模板，并且不会出现在DOM中</li>
</ul>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app-layout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../assets/logo.svg<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>img<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>My shirt shop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span>

    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 菜单将放在这里 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<h3 id="创建路由"><a href="#创建路由" class="headerlink" title="创建路由"></a>创建路由</h3><p>1.创建<code>Home.vue</code></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>home<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Welcome to our support center<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>We are here to help<span class="token operator">!</span> Please read the <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>##<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>F<span class="token punctuation">.</span>A<span class="token punctuation">.</span>Q<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span> first<span class="token punctuation">,</span> and <span class="token keyword">if</span> you don't find the answer to your question<span class="token punctuation">,</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>##<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>send us a ticket<span class="token operator">!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>2.创建<code>FAQ.vue</code></p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>faq<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Frenquently Asked Questions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>3.在<code>router.js</code>文件中导入刚刚创建的两个组件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'./components/Home'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> FAQ <span class="token keyword">from</span> <span class="token string">'./components/FAQ'</span><span class="token punctuation">;</span></code></pre>
<p>4.创建一个<code>routes</code>数组：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment" spellcheck="true">// 路由将放在这里</span>
<span class="token punctuation">]</span></code></pre>
<p>5.在<code>routes</code>数组中添加两个路由：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 可选，建议使用，方便维护</span>
    component<span class="token punctuation">:</span> Home
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/faq'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'faq'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> FAQ
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<h3 id="路由器对象"><a href="#路由器对象" class="headerlink" title="路由器对象"></a>路由器对象</h3><p>我们将使用<code>vue-router</code>包中的<code>VueRouter</code>构造函数创建一个<code>router</code>对象来管理路由。<br>1.在<code>router.js</code>中的<code>routes</code>数组之后创建一个新的<code>router</code>对象：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>2.导出router对象：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> router</code></pre>
<p>3.在main.js中导入router对象：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token punctuation">;</span></code></pre>
<p>4.然后将其作为一个定义选项添加到Vue根实例中：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> h <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span>AppLayout<span class="token punctuation">)</span><span class="token punctuation">,</span>
  router
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul>
<li>当浏览器URL为<code>http://localhost:4000/#/</code>时，渲染<code>Home.vue</code>组件</li>
<li>当浏览器URL为<code>http://localhost:4000/#/faq</code>时，渲染<code>FAQ.vue</code>组件</li>
</ul>
<h3 id="路由模式"><a href="#路由模式" class="headerlink" title="路由模式"></a>路由模式</h3><p>使用<code>mode</code>参数更改路由器模式：<br>1.<code>hash</code><br>访问URL: <code>http://localhost:4000/#/faq</code></p>
<p>优点: 最安全，全兼容<br>缺点: 不优雅</p>
<p>2.<code>history</code><br>访问URL: <code>http://localhost:4000/faq</code></p>
<ul>
<li>浏览器需要支持HTML5 API，所以它不能在IE 9或更低版本上工作</li>
<li>必须自己实现404页面</li>
</ul>
<p>优点： 优雅<br>缺点： 不兼容</p>
<p>3.<code>abstract</code></p>
<p>可以在任何JavaScript环境中使用。如果没有可用的浏览器API，路由器将被迫使用此模式。</p>
<h3 id="创建导航菜单"><a href="#创建导航菜单" class="headerlink" title="创建导航菜单"></a>创建导航菜单</h3><p>1.创建一个<code>NavMenu.vue</code>组件：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- 链接在这里 --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>2.在<code>App.vue</code>中导入<code>NavMenu.vue</code>组件：</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">import</span> NavMenu <span class="token keyword">from</span> <span class="token string">'./NavMenu.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    NavMenu
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<p>然后添加到<code>App</code>模板中：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>../assets/logo.svg<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>img<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>My shirt shop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NavMenu</span> <span class="token punctuation">/></span></span>
</code></pre>
<h3 id="路由器链接"><a href="#路由器链接" class="headerlink" title="路由器链接"></a>路由器链接</h3><pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>faq<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>FAQ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!-- 或者 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/faq<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>FAQ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span></code></pre>
<p>现在可以添加到<code>NavMenu</code>组件了：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Home
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>faq<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>FAQ
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<h3 id="active-class"><a href="#active-class" class="headerlink" title="active class"></a>active class</h3><p>路由器链接在与其关联的路由当前处于激活状态时获取active class。默认情况下，组件使用<strong><code>router-link-active</code></strong> CSS类。</p>
<p>1.在<code>NavMenu.vue</code>中声明样式：</p>
<pre class=" language-stylus"><code class="language-stylus">&lt;style lang=<span class="token string">"stylus"</span> scoped>
<span class="token atrule-declaration"><span class="token atrule">@import</span> <span class="token string">"../style/imports"</span><span class="token punctuation">;</span></span>

<span class="token selector">.router-link-active <span class="token punctuation">{</span></span>
  <span class="token property-declaration"><span class="token property">border-bottom</span> <span class="token number">1</span>px solid $primary-color</span>
<span class="token punctuation">}</span>
&lt;/style></code></pre>
<p>2.<code>exact</code><br>默认情况下路径为<code>/faq</code>或<code>/</code>，都会匹配路径<code>/</code>，都会获得active class。<br><strong>将<code>exact</code>属性添加到Home链接上</strong></p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span> <span class="token attr-name">exact</span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span></code></pre>
<h2 id="路由器导航守卫"><a href="#路由器导航守卫" class="headerlink" title="路由器导航守卫"></a>路由器导航守卫</h2><p>路由主要可分为三种类型：</p>
<ul>
<li>公开路由始终可访问</li>
<li>私有路由仅限登录用户访问</li>
<li>访客路由只能由未登录的用户访问</li>
</ul>
<p>1.创建一个私有路由下的组件<code>TicketsLayout.vue</code>:</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tickets-layout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Your Support tickets<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- TODO --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>2.然后在<code>router.js</code>文件中添加响应的路由：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> TicketsLayout <span class="token keyword">from</span> <span class="token string">'./components/TicketsLayout'</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/tickets'</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'tickets'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> TicketsLayout
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>3.最后在<code>NavMenu.vue</code>中添加路由连接：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>tickets<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Support tickets<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span></code></pre>
<h3 id="路由元属性"><a href="#路由元属性" class="headerlink" title="路由元属性"></a>路由元属性</h3><p>刚刚创建的私有路由组件<code>TicketsLayout.vue</code>需要设置为只有已经登录的用户才能访问，所以添加 <strong><code>private</code></strong> 属性到路由器的meta对象：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/tickets'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* ... */</span><span class="token punctuation">,</span> meta<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">private</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<h3 id="导航守卫-beforeEach"><a href="#导航守卫-beforeEach" class="headerlink" title="导航守卫 beforeEach"></a>导航守卫 <code>beforeEach</code></h3><p>在路由器解析之前执行一些逻辑来检查用户是否已经登录。<code>beforeEach</code>每次在路由解析之前运行，允许我们在必要时用另一个路由替换目标路由，它接受带有3个参数的回调函数：</p>
<ul>
<li><code>to</code>是当前的目标路由</li>
<li><code>from</code>是以前的路由</li>
<li><code>next</code>是为了完成解析不得不在某个时刻调用的函数（如果没有调用，应用会卡住）</li>
</ul>
<p>1.在导出路由器实例之前，添加<code>beforeEach</code>导航守卫：</p>
<pre class=" language-js"><code class="language-js">router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// TODO</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'to'</span><span class="token punctuation">,</span> to<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>2.现在需要确定目标路由是否为私有路由：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// TODO 重定向到登录</span>
<span class="token punctuation">}</span></code></pre>
<p>3.要检查用户是否已经登录，我们需要全局状态——可以在<code>router.js</code>文件的开始将存储全局变量的<code>state.js</code>文件导入：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> state <span class="token keyword">from</span> <span class="token string">'./state'</span></code></pre>
<p>4.更改条件表达式以检查用户状态：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token keyword">private</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li><code>logout</code>方法：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> logout <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'logout'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'ok'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$state<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<ul>
<li><code>login</code>方法：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">async</span> login <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$state<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      username<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span>
      password<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'home'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<p>现在可以尝试登出并点击Support tickets链接，会立即重定向到登录页面。</p>
<p><strong>当用<code>next</code>重定向时，每次重定向都不会为浏览器历史记录添加额外条目。只有最后的路由才有历史记录。</strong></p>
<h3 id="导航到期望的路由"><a href="#导航到期望的路由" class="headerlink" title="导航到期望的路由"></a>导航到期望的路由</h3><p>1.将当前想要访问的URL作为参数传递给登录路由：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
  params<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    wantedRoute<span class="token punctuation">:</span> to<span class="token punctuation">.</span>fullPath<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>2.可以改变login方法中的重定向并使用这个参数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>wantedRoute <span class="token operator">||</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'home'</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h3 id="访客路由"><a href="#访客路由" class="headerlink" title="访客路由"></a>访客路由</h3><p>我们不希望已经登录的用户访问登录路由！</p>
<p>1.标记访客路由：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
  component<span class="token punctuation">:</span> Login<span class="token punctuation">,</span>
  meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    guest<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<p>2.在<code>beforeEach</code>内部，检查路由是否仅限访客浏览。如果已登录，则重定向到主页：</p>
<pre class=" language-js"><code class="language-js">router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>guest <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'home'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>现在在登录状态下打开登录URL，会立刻被重定向到主页！</p>
<h3 id="会话过期"><a href="#会话过期" class="headerlink" title="会话过期"></a>会话过期</h3><p>一段时间后，用户会话可能不再有效，或者仅仅是因为服务器重启。尝试重现这种情况：</p>
<p>（1）确保你已经登录到应用<br>（2）在运行服务器的终端中键入<code>rs</code>，然后按回车重启<br>（3）跳到Home页面<br>（4）跳到Support tickets页面，以返回工单列表页面</p>
<p>你应该会卡在加载动画，服务器返回了未授权的错误，因为我们不处于登录状态了！</p>
<p><strong>因此，需要将用户登出。如果处于私有路由中，还要重定向到登录页面。</strong></p>
<p>1.在修改请求方法（<code>/plugin/fetch.js</code>）前，需要导入state和路由器：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> state <span class="token keyword">from</span> <span class="token string">"../state"</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">"../router"</span></code></pre>
<p>2.在<code>fetch.js</code>响应处理中添加一个条件分支：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 如果会话不在有效</span>
  <span class="token comment" spellcheck="true">// 我们登出</span>
  state<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token comment" spellcheck="true">// 如果这个路由是私有的</span>
  <span class="token comment" spellcheck="true">// 我们跳转到登录页面</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>r <span class="token operator">=</span><span class="token operator">></span> r<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span> params<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      wantedRoute<span class="token punctuation">:</span> router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">.</span>fullPath
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li><strong>我们使用replace方法而不是push，因为不想在浏览器历史记录中创建新导航。</strong></li>
<li>如果使用push，用户点击后退按钮，会再次重定向到登录页，无法返回私有页面之前的页面。</li>
</ul>
<h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><p>1.创建<code>NewTicket.vue</code>和<code>Tickets.vue</code>组件：</p>
<ul>
<li><code>NewTicket.vue</code>：</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>new-ticket<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>New ticket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<ul>
<li><code>Tickets.vue</code>：</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>new-ticket<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>New ticket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>2.在<code>router.js</code>中，添加路由：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> NewTicket <span class="token keyword">from</span> <span class="token string">'./components/NewTicket'</span>
<span class="token keyword">import</span> Tickets <span class="token keyword">from</span> <span class="token string">'./components/Tickets'</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/tickets'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> TicketsLayout<span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">private</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'tickets'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Tickets<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// path是空字符串，在解析父路由时它将成为默认路由，所以将父路由的name'tickets'转移到这里</span>
      <span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token string">'new'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'new-ticket'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> NewTicket<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>3.最后更改<code>TicketsLayout.vue</code>组件，添加路由器视图和切换子路由的几个按钮：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tickets-layout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Your Support tickets<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>actions<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span>
          <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$route.name !<span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>tickets<span class="token punctuation">'</span><span class="token punctuation">"</span></span>
          <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>secondary<span class="token punctuation">"</span></span>
          <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>tickets<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>See all tickets
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span>
          <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$route.name !<span class="token punctuation">=</span><span class="token punctuation">=</span> <span class="token punctuation">'</span>new-ticket<span class="token punctuation">'</span><span class="token punctuation">"</span></span>
          <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span>
          <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>new-ticket<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>New Ticket
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<h4 id="修复导航守卫"><a href="#修复导航守卫" class="headerlink" title="修复导航守卫"></a>修复导航守卫</h4><p>如果你登出并转到工单页面，应该会很惊讶地发现能够访问！</p>
<p><em>之前<code>beforeEach</code>导航守卫的实施存在一个缺陷——嵌套路由，to参数只是目标路由，也就是<code>/ticket</code>路由的第一个子路由——它没有private元属性</em></p>
<ul>
<li>所以我们要检查所有匹配的嵌套路由对象，使用<code>matched</code>属性访问路由对象的列表，然后使用<code>some</code>数组方法来验证至少有一个匹配：</li>
</ul>
<pre class=" language-js"><code class="language-js">router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>r <span class="token operator">=</span><span class="token operator">></span> r<span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token keyword">private</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>r <span class="token operator">=</span><span class="token operator">></span> r<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>guest<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>现在修复好了！</p>
<h2 id="高级路由特性"><a href="#高级路由特性" class="headerlink" title="高级路由特性"></a>高级路由特性</h2><h3 id="具有参数的动态路由"><a href="#具有参数的动态路由" class="headerlink" title="具有参数的动态路由"></a>具有参数的动态路由</h3><p>1.创建一个新的<code>Ticket.vue</code>文件：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ticket<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Ticket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Loading</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>remoteDataBusy<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>empty<span class="token punctuation">"</span></span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!ticket<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      Ticket not found.
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>
      <span class="token comment" spellcheck="true">&lt;!-- General info --></span>
      <span class="token comment" spellcheck="true">&lt;!-- ... --></span>
      <span class="token comment" spellcheck="true">&lt;!-- Content --></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>{{ ticket.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{ ticket.description }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>2.然后为该组件添加一个<code>id</code> prop：</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
      required<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<h4 id="动态远程数据"><a href="#动态远程数据" class="headerlink" title="动态远程数据"></a>动态远程数据</h4><p>使用mixin获取数据：</p>
<ul>
<li>在<code>RemoteData.js</code>中：</li>
</ul>
<pre class=" language-js"><code class="language-js">created <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// resources = {</span>
  <span class="token comment" spellcheck="true">//   ticket () {</span>
  <span class="token comment" spellcheck="true">//     return `ticket/${this.id}`</span>
  <span class="token comment" spellcheck="true">//   }</span>
  <span class="token comment" spellcheck="true">// }</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> resources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> resources<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true">// 如果值是一个函数</span>
    <span class="token comment" spellcheck="true">// 侦听它的结果</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> url <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResource</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 请求path/ticket/${this.id}数据，并将结果返回到组件的data.key(即data.ticket)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        immediate<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchResource</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>在<code>Ticket</code>组件中：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">import</span> RemoteData <span class="token keyword">from</span> <span class="token string">'../mixins/RemoteData'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  mixins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token function">RemoteData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      ticket <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`ticket/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<h4 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h4><p>可以使用冒号将动态片段添加到路由路径中。然后，每个片段将暴露在路由params对象中。</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>示例路径</th>
<th>$route.params的值</th>
</tr>
</thead>
<tbody><tr>
<td>/tickets/:id</td>
<td>/tickets/abc</td>
<td>{ id: ‘abc’ }</td>
</tr>
<tr>
<td>/tickets/:id/comments/:comId</td>
<td>/tickets/abc/comments/42</td>
<td>{ id: ‘abc’, comId: ‘42’ }</td>
</tr>
</tbody></table>
<p>1.在<code>router.js</code>中添加路由：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'/tickets'</span><span class="token punctuation">,</span>
    component<span class="token punctuation">:</span> TicketsLayout<span class="token punctuation">,</span>
    meta<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">private</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'tickets'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Tickets<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token string">'new'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'new-ticket'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> NewTicket<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token string">':id'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'ticket'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Ticket<span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>2.在Tickets.vue中，将标题元素的链接指向新的路由：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>ticket<span class="token punctuation">'</span>, params: { id: ticket._id }}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ ticket.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span></code></pre>
<p>3.更改router.js，告诉vue-router用props属性将所有路由参数作为prop传递给它：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token string">':id'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">/* ... */</span><span class="token punctuation">,</span> props<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<ul>
<li>或者更加灵活：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>path<span class="token punctuation">:</span> <span class="token string">':id'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'ticket'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Ticket<span class="token punctuation">,</span> props<span class="token punctuation">:</span> route <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre>
<p>如果你需要结合静态和动态prop，请使用函数语法！</p>
<h3 id="404页面"><a href="#404页面" class="headerlink" title="404页面"></a>404页面</h3><p>目前，如果你在应用中输入无效的URL，会遇到空白页，可以自定义404页面。</p>
<p>1.创建NotFound.vue组件：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>not-found<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>This page can't be found<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>more-info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      Sorry, but we can't find the page you're looking for.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
      It might have been moved or deleted.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
      Check your spelling or click below to return to the homepage.
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>actions<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ name: <span class="token punctuation">'</span>home<span class="token punctuation">'</span>}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Return to home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">
  <span class="token comment" spellcheck="true">/* ... */</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre>
<p>2.在router.js中添加一个匹配<code>*</code>路径的新路由：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> NotFound <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p><strong>把这个路由放在routes数组的末尾，确保了所有合法路由在匹配最后这一条特定的全拦截路由之前匹配。</strong><br><em>路由先定义先匹配。</em></p>
<p>现在，尝试一个不存在的URL，会出现NotFound页面！</p>
<h3 id="过渡"><a href="#过渡" class="headerlink" title="过渡"></a>过渡</h3><p>使用<code>&lt;transition /&gt;</code>包装路由器视图：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fade<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>out-in<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span></code></pre>
<h3 id="滚动行为"><a href="#滚动行为" class="headerlink" title="滚动行为"></a>滚动行为</h3><p>路由器的history模式允许我们在路由改变时管理页面滚动。</p>
<p>路由器对象可使用scrollBehavior函数来管理，有3个参数：</p>
<ul>
<li><code>to</code>是目标路由对象</li>
<li><code>from</code>是之前的路由对象</li>
<li><code>savedPosition</code>是浏览器历史记录中每个条目自动保存的位置滚动。在路由改变之前，每个新条目都不会有这个值。</li>
</ul>
<p>返回值：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 1.想要应用的滚动的坐标</span>
<span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 2.滚动到某个HTML元素的选择器，并带有可选的偏移量</span>
<span class="token punctuation">{</span> selector<span class="token punctuation">:</span> <span class="token string">'#foo'</span><span class="token punctuation">,</span> offset<span class="token punctuation">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre>
<p>1.要在路由改变时滚动到页面的顶部，我们需要写：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">,</span>
  mode<span class="token punctuation">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
  scrollBehavior <span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> savedPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// 滚动到&lt;h1>元素</span>
    <span class="token comment" spellcheck="true">// return { selector: 'h1' }</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>2.检查路由是否有模仿浏览器行为的散列值：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>selector<span class="token punctuation">:</span> to<span class="token punctuation">.</span>hash<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>3.最后，如果有滚动位置，可以恢复该滚动位置：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>savedPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> savedPosition
<span class="token punctuation">}</span></code></pre>
<ul>
<li>整段代码：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">,</span>
  mode<span class="token punctuation">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
  scrollBehavior <span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> savedPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>savedPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> savedPosition
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>selector<span class="token punctuation">:</span> to<span class="token punctuation">.</span>hash<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>vue-router</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue入门笔记三(Vuex)</title>
    <url>/2019/08/05/Vue%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%E4%B8%89-Vuex/</url>
    <content><![CDATA[<blockquote>
<p>《Vue.js项目实战》</p>
</blockquote>
<h3 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h3><h4 id="集中式的状态管理"><a href="#集中式的状态管理" class="headerlink" title="集中式的状态管理"></a>集中式的状态管理</h4><ul>
<li>Vuex从Flux（由Facebook开发）的概念中获取得灵感。Flux又一系列指导原则构成，阐明了如何使用集中式store来实现组件之间的单向数据流。</li>
<li>Vuex的核心元素是store，是进行数据存储和数据处理的主要架构。</li>
</ul>
<a id="more"></a>
<p>store包含如下信息：</p>
<pre class=" language-js"><code class="language-js">state            <span class="token comment" spellcheck="true">// 存储应用状态的响应式数据对象</span>
getter          <span class="token comment" spellcheck="true">// 等价于store的计算属性</span>
mutation     <span class="token comment" spellcheck="true">// 用来改变应用状态的函数</span>
action         <span class="token comment" spellcheck="true">// 通常用来调用异步API的函数，然后使用mutation改变数据</span></code></pre>
<h4 id="Vuex-store"><a href="#Vuex-store" class="headerlink" title="Vuex store"></a>Vuex store</h4><p>1.安装vuex</p>
<pre class=" language-powershell"><code class="language-powershell">npm i <span class="token operator">-</span>S vuex</code></pre>
<p>然后新建store文件夹，并创建index.js来安装Vuex插件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span></code></pre>
<p>2.使用Vuex.Store构造函数创建store:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// TODO 选项</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>3.导出store：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> store</code></pre>
<p>4.在main.js文件中，导入store:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span></code></pre>
<p>5.为了让store在应用中生效，我们还需要像注入路由器一样注入它：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    router<span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>App<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h4 id="state是唯一数据源"><a href="#state是唯一数据源" class="headerlink" title="state是唯一数据源"></a>state是唯一数据源</h4><p>state是store的主要组成部分，它展示了应用中组件的所有共享数据。</p>
<ul>
<li>state是共享数据的唯一数据源</li>
<li>state是只读的</li>
</ul>
<p>（1）在store选项中添加state函数，该函数返回一个对象：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>（2）在组件中读取状态：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user</code></pre>
<h4 id="使用mutation修改状态"><a href="#使用mutation修改状态" class="headerlink" title="使用mutation修改状态"></a>使用mutation修改状态</h4><ul>
<li>mutation是修改state的唯一方式</li>
<li>mutation接受state作为第一个参数，同时接受一个可选的载荷（payload）参数，以此来更新state</li>
<li>不应该在mutation中使用异步操作</li>
<li>严格模式：避免在mutation中使用异步函数<code>strict: true</code></li>
<li>不要在生产环境下启用严格模式，以免影响性能<code>strict: process.env.NODE_ENV !== &#39;production&#39;</code></li>
</ul>
<p>（1）添加一个mutation：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    state<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        user<span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            state<span class="token punctuation">.</span>user <span class="token operator">=</span> user
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>（2）表明调用mutation的用词是commit，在组件中：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> userData<span class="token punctuation">)</span></code></pre>
<h4 id="使用getter计算和返回数据"><a href="#使用getter计算和返回数据" class="headerlink" title="使用getter计算和返回数据"></a>使用getter计算和返回数据</h4><p>（1）创建一个getter：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
    getter<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        user<span class="token punctuation">:</span> state <span class="token operator">=</span><span class="token operator">></span> state<span class="token punctuation">.</span>user<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>（2）在组件中，可以用这个getter代替之前直接获取状态的方法：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getter<span class="token punctuation">.</span>user <span class="token comment" spellcheck="true">// this.$store.state.user</span></code></pre>
<h4 id="使用action操作store"><a href="#使用action操作store" class="headerlink" title="使用action操作store"></a>使用action操作store</h4><ul>
<li>action不仅可以提交mutation，还能做异步操作</li>
<li>action的声明由一个类型和一个处理函数构成<code>store.dispath(&#39;action-type&#39;, payloadObject)</code></li>
<li>action的处理函数接收两个参数：<br>  1.context<br>  2.payload</li>
</ul>
<p>（1）创建action:</p>
<pre class=" language-js"><code class="language-js">actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    login <span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> userData <span class="token operator">=</span> <span class="token punctuation">{</span>
        profile<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          displayName<span class="token punctuation">:</span> <span class="token string">'Mr Cat'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
     <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> userData<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<p>（2）在组件中使用：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span></code></pre>
<h4 id="辅助函数"><a href="#辅助函数" class="headerlink" title="辅助函数"></a>辅助函数</h4><p><strong>Vuex提供了一系列辅助函数供添加state、getter、mutation以及action。出于将组建中的状态和逻辑分离的考虑，我们只应该在组件中使用getter和action，所以只会用到mapGetters和mapActions。</strong><br>辅助函数的参数可以是：<br>1.类型的数组，其中的每一个元素对应于组件中的同名数据<br>2.对象，其中的键是组件中数据的别名，值则是类型<br>数组语法例如：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 等价于</span>
<span class="token punctuation">{</span>
    a <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>a <span class="token punctuation">}</span><span class="token punctuation">,</span>
    b <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>b <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>对象语法例如：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token string">'b'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 等价于</span>
<span class="token punctuation">{</span>
    x <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>a <span class="token punctuation">}</span><span class="token punctuation">,</span>
    y <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>b <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>（1）在组件中导入：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters<span class="token punctuation">,</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span></code></pre>
<p>（2）然后将组件修改为：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'user'</span><span class="token punctuation">,</span>
      <span class="token string">'userPicture'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        centerOnUser<span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
        logout<span class="token punctuation">:</span> <span class="token string">'logout'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token punctuation">}</span></code></pre>
<h3 id="Vuex模块"><a href="#Vuex模块" class="headerlink" title="Vuex模块"></a>Vuex模块</h3><p>创建两个模块：</p>
<ul>
<li>maps</li>
<li>posts<br>（1）在store文件夹中新建一个maps.js文件。它导出一个默认模块定义，其中包括地图的state：</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    namespaced<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        center<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            lat<span class="token punctuation">:</span> <span class="token number">48.8538302</span><span class="token punctuation">,</span>
            lng<span class="token punctuation">:</span> <span class="token number">2.2982161</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>（2）将模块添加到store中，在store/index.js文件中添加modules选项：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> maps <span class="token keyword">from</span> <span class="token string">'./maps'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
    modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        maps<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>默认情况下，模块中getter、mutation、action的状态也会成为这个模块的状态。这里它是store.state.maps。</p>
<h4 id="带命名空间的模块"><a href="#带命名空间的模块" class="headerlink" title="带命名空间的模块"></a>带命名空间的模块</h4><p>上面的namespaced选项告诉Vuex在该模块的所有getter、mutation、action前添加maps/命名空间，还会在这个模块内的commit和dispatch调用中添加它们。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// getter模块</span>
getters<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    center<span class="token punctuation">:</span> state <span class="token operator">=</span><span class="token operator">></span> state<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>maps/center getter 会被添加到store中。使用时可以这么写：<br>1.getters</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">[</span><span class="token string">'maps/center'</span><span class="token punctuation">]</span></code></pre>
<p>2.使用getter辅助函数：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    center<span class="token punctuation">:</span> <span class="token string">'maps/center'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>3.可以指定命名空间：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token string">'maps'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string">'center'</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<p>4.使用createNamespacedHelpers方法生成基于某个命名空间的辅助函数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createNamespacedHelpers <span class="token punctuation">}</span> <span class="token keyword">from</span> vuex
<span class="token keyword">const</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createNamespacedHelpers</span><span class="token punctuation">(</span><span class="token string">'maps'</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    computed<span class="token punctuation">:</span> <span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string">'center'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="访问全局元素"><a href="#访问全局元素" class="headerlink" title="访问全局元素"></a>访问全局元素</h4><p>1.在getter中<br>你可以在命名空间模块的getter中访问到根状态和根getter（即所有的getter）：</p>
<pre class=" language-js"><code class="language-js">someGetter<span class="token punctuation">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> getters<span class="token punctuation">,</span> rootState<span class="token punctuation">,</span> rootGetters<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">/* ... */</span><span class="token punctuation">}</span></code></pre>
<p>2.在action中<br>你可以访问到上下文的rootGetters，还可以在commit和dispatch调用中使用<code>{ root: true }</code>选项：</p>
<pre class=" language-js"><code class="language-js"><span class="token function">myAction</span><span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> commit<span class="token punctuation">,</span> getters<span class="token punctuation">,</span> rootGetters <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    getters<span class="token punctuation">.</span>a <span class="token comment" spellcheck="true">// store.getters['maps/a']</span>
    rootGetters<span class="token punctuation">.</span>a <span class="token comment" spellcheck="true">// store.getters['a']</span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'someMutation'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 'maps/someMutation'</span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'someMutation'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> root<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 'someMutation'</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'someAction'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 'maps/someAction'</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'someAction'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> root<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 'someAction'</span>
<span class="token punctuation">}</span></code></pre>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue入门笔记二</title>
    <url>/2019/08/05/Vue%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%E4%BA%8C/</url>
    <content><![CDATA[<blockquote>
<p>《Vue.js项目实战》</p>
</blockquote>
<ul>
<li>开发所需的包称为开发依赖，应该使用–save-dev标志进行安装 <strong>-D</strong></li>
<li>应用运行需要的直接依赖应该使用–save标志进行安装 <strong>-S</strong></li>
</ul>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>Vue具有自己的格式，名为单文件组件（SFC），文件扩展名为.vue。<br>单文件组件使用类似HTML的语法描述Vue组件。</p>
<a id="more"></a>

<h4 id="使用Pug"><a href="#使用Pug" class="headerlink" title="使用Pug"></a>使用Pug</h4><p>Pug（以前称为Jade）是一种编译到HTML的语言。</p>
<pre class=" language-jade"><code class="language-jade"><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pug<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>
  <span class="token tag">ul.movies</span>
    <span class="token tag">li.movie</span> <span class="token plain-text">Star Wars</span>
    <span class="token tag">li.movie</span> <span class="token plain-text">Blade Runner</span>
<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></span>
</code></pre>
<p>安装依赖：</p>
<pre class=" language-powershell"><code class="language-powershell">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev pug pug<span class="token operator">-</span>loader</code></pre>
<h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><h4 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h4><p><strong>在JSX中，标签首字母大小写很重要！</strong></p>
<ul>
<li>如果是小写，编译器会认为它是createElement函数的一个字符串参数，然后将它编译为一个HTML元素或已注册组件；</li>
<li>如果首字母大写，编译器会认为它是一个变量！</li>
</ul>
<p><strong>不能既使用渲染函数又使用模板，要移除文件中<code>&lt;template&gt;</code>部分</strong></p>
<p>示例：</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  data <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      movies<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">'Star Wars'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">'Blade Runner'</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> itemClass <span class="token operator">=</span> <span class="token string">'movie'</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">'movie'</span><span class="token operator">></span>
      <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>movie <span class="token operator">=</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token punctuation">{</span> itemClass <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span> movie<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<p>编译过程：babel-preset-vue中的一个特殊模块（名为babel-plugin-transform-vue-jsx）将JSX代码转换为纯JavaScript代码<br>编译之后：</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> itemClass <span class="token operator">=</span> <span class="token string">'movie'</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'movies'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>movie <span class="token operator">=</span><span class="token operator">></span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token punctuation">:</span> itemClass<span class="token punctuation">}</span><span class="token punctuation">,</span> movie<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3><p>1.有作用域的样式<br>可以使用<code>&lt;style&gt;</code>标签的scoped属性将标签内的CSS作用域限定在当前组件中。<br>主要是因为PostCSS应用到模板和CSS的一个特殊属性data-v-xxxxxxxx。</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    Hello
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css">
<span class="token selector"><span class="token class">.title</span> </span><span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre>
<p>等价于：</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">data-v-02ad4e58</span><span class="token punctuation">></span></span>
    Hello
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">
<span class="token selector"><span class="token class">.title</span><span class="token attribute">[data-v-02ad4e58]</span></span><span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre>
<p>2.添加预处理器</p>
<h4 id="Sass"><a href="#Sass" class="headerlink" title="Sass"></a>Sass</h4><p>（1）安装包</p>
<pre class=" language-powershell"><code class="language-powershell">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev node<span class="token operator">-</span>sass sass<span class="token operator">-</span>loader</code></pre>
<p>（2）在组件中，添加lang属性为”“sass”的<code>&lt;style&gt;</code>标签</p>
<pre class=" language-scss"><code class="language-scss">&lt;style lang=<span class="token string">"sass"</span>>
  <span class="token number">.</span>active
    <span class="token number">.</span>title
      <span class="token property">border-bottom</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token function">rgba</span><span class="token punctuation">(</span>red, <span class="token number">.2</span><span class="token punctuation">)</span>
&lt;/style></code></pre>
<p>（3）用vue build命令测试你的组件</p>
<h4 id="Less"><a href="#Less" class="headerlink" title="Less"></a>Less</h4><p>（1）安装包</p>
<pre class=" language-powershell"><code class="language-powershell">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev less less<span class="token operator">-</span>loader</code></pre>
<p>（2）在组件中，添加lang属性为”“less”的<code>&lt;style&gt;</code>标签</p>
<pre class=" language-less"><code class="language-less"><span class="token selector">&lt;style lang="less">
.active</span><span class="token punctuation">{</span>
    <span class="token selector">.title</span><span class="token punctuation">{</span>
      <span class="token property">border-bottom</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token function">fade</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> <span class="token number">20%</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
&lt;<span class="token operator">/</span>style></code></pre>
<h4 id="Stylus"><a href="#Stylus" class="headerlink" title="Stylus"></a>Stylus</h4><p>Stylus比Less和Sass更年轻，也很受欢迎。<br>（1）安装包</p>
<pre class=" language-powershell"><code class="language-powershell">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev stylus stylus<span class="token operator">-</span>loader</code></pre>
<p>（2）在组件中，添加lang属性为”“stylus”的<code>&lt;style&gt;</code>标签</p>
<pre class=" language-stylus"><code class="language-stylus"><span class="token selector">&lt;style lang="stylus"></span>
  <span class="token selector">.active</span>
    <span class="token selector">.title</span>
      <span class="token property-declaration"><span class="token property">border-bottom</span> <span class="token number">1</span>px solid <span class="token func"><span class="token function">rgba</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> <span class="token operator">.</span><span class="token number">2</span><span class="token punctuation">)</span></span></span>
&lt;/style></code></pre>
<p>3.为限定作用域的元素的子元素编写样式</p>
<h4 id="gt-gt-gt-子元素"><a href="#gt-gt-gt-子元素" class="headerlink" title="&gt;&gt;&gt; 子元素"></a>&gt;&gt;&gt; 子元素</h4><pre class=" language-stylus"><code class="language-stylus"><span class="token selector">&lt;style lang="stylus" scoped></span>
  <span class="token selector">.form <span class="token punctuation">{</span></span>
    <span class="token selector">>>> .content <span class="token punctuation">{</span></span>
      <span class="token property-declaration"><span class="token property">max-width</span> <span class="token number">400</span>px</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
&lt;/style></code></pre>
<p>等价于:</p>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.form</span><span class="token attribute">[data-v-0e596401]</span> <span class="token class">.content</span> </span><span class="token punctuation">{</span>
  <span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">400</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>如果不使用&gt;&gt;&gt;连结符，则输出这样的CSS：</p>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.form</span> <span class="token class">.content</span><span class="token attribute">[data-v-0e596401]</span> </span><span class="token punctuation">{</span>
  <span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">400</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><em>如果使用SASS，则需要使用<code>/deep/</code>选择器而不是&gt;&gt;&gt;连结符</em></p>
<h3 id="组件内的组件"><a href="#组件内的组件" class="headerlink" title="组件内的组件"></a>组件内的组件</h3><p>1.创建一个新组件Movie.vue：</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movie<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> movie<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'movie'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style language-css">
<span class="token selector"><span class="token class">.movie</span><span class="token pseudo-class">:not(:last-child)</span> </span><span class="token punctuation">{</span>
  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> <span class="token number">6</span>px<span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">6</span>px<span class="token punctuation">;</span>
  <span class="token property">border-bottom</span><span class="token punctuation">:</span> solid <span class="token number">1</span>px <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre>
<p>创建一个父组件Movies.vue：</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movies<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(movie,</span> <span class="token attr-name">index)</span> <span class="token attr-name">of</span> <span class="token attr-name">movies"</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movie<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
       <span class="token punctuation">{</span><span class="token punctuation">{</span>movie<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> Movie <span class="token keyword">from</span> <span class="token string">'./Movie.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    Movie<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  data <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      movies<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'Star Wars'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'Blade Runner'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>2.在Movies组件的脚本中导入Movie单文件组件：</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">import</span> Movie <span class="token keyword">from</span> <span class="token string">'./Movie.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p>3.使用对象设置components选项，将一些组件暴露给模板：</p>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    Movie<span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// 相当于 `Movie: Movie,`</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p>4.在模板中通过<code>&lt;Movie&gt;</code>使用这个组件</p>
<pre class=" language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movies<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Movie</span>
      <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(movie,</span> <span class="token attr-name">index)</span> <span class="token attr-name">of</span> <span class="token attr-name">movies"</span>
      <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span>
      <span class="token attr-name">:movie</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movie<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<h4 id="如果你在使用JSX"><a href="#如果你在使用JSX" class="headerlink" title="如果你在使用JSX"></a>如果你在使用JSX</h4><p>不需要components选项，因为以大写字母开头则可以直接使用组件定义</p>
<ul>
<li>示例一：</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Movie <span class="token keyword">from</span> <span class="token string">'./Movie.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>Movie <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>示例二：</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">import</span> LocationInfo <span class="token keyword">from</span> <span class="token string">'./LocationInfo.vue'</span>
<span class="token keyword">import</span> NoContent <span class="token keyword">from</span> <span class="token string">'./NoContent.vue'</span>
<span class="token keyword">import</span> CreatePost <span class="token keyword">from</span> <span class="token string">'./CreatePost.vue'</span>
<span class="token keyword">import</span> PostContent <span class="token keyword">from</span> <span class="token string">'./PostContent.vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createNamespacedHelpers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token comment" spellcheck="true">// posts module</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
  mapGetters<span class="token punctuation">:</span> postsGetters<span class="token punctuation">,</span>
  mapActions<span class="token punctuation">:</span> postsActions<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createNamespacedHelpers</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">postsGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'draft'</span><span class="token punctuation">,</span>
      <span class="token string">'currentPost'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    cssClass <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string">'blog-content'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token string">'has-content'</span><span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentPost<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  render <span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> Content
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentPost<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Content <span class="token operator">=</span> NoContent
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>draft<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Content <span class="token operator">=</span> CreatePost
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      Content <span class="token operator">=</span> PostContent
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>cssClass<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>LocationInfo <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue入门笔记一</title>
    <url>/2019/08/05/Vue%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0%E4%B8%80/</url>
    <content><![CDATA[<blockquote>
<p>《Vue.js项目实战》Guillaume Chau</p>
</blockquote>
<h3 id="Vue核心功能概述"><a href="#Vue核心功能概述" class="headerlink" title="Vue核心功能概述"></a>Vue核心功能概述</h3><p>1.一个响应式的数据系统，能通过轻量级的虚拟DOM引擎和最少的优化工作来自动更新用户界面<br>2.灵活的视图声明，包括优雅友好的HTML模板、JSX（在JavaSript中编写HTML的技术）以及hyperscript（完全使用JavaScript）<br>3.由可维护、可复用组件构成的组件化用户界面<br>4.官方的组件库提供了路由、状态管理、脚手架以及更多高级功能，使Vue成为了一个灵活且功能完善的前端框架</p>
<a id="more"></a>

<h3 id="兼容性要求"><a href="#兼容性要求" class="headerlink" title="兼容性要求"></a>兼容性要求</h3><ul>
<li>Vue没有任何第三方依赖</li>
<li>可以在所有兼容ECMAScript 5 的浏览器中使用</li>
<li>不支持Internet Explorer 8 及以下版本</li>
<li>编写ES2015（ES6）需要编译器Babel，才能在老版本浏览器中运行</li>
</ul>
<h3 id="Vue开发者工具"><a href="#Vue开发者工具" class="headerlink" title="Vue开发者工具"></a>Vue开发者工具</h3><ul>
<li>Chrome    Vue.js devtools【启用Allow access to file URLs，调试工具就能在从本地磁盘打开的Web页面上检测Vue】</li>
</ul>
<h3 id="高级项目设置"><a href="#高级项目设置" class="headerlink" title="高级项目设置"></a>高级项目设置</h3><pre class=" language-js"><code class="language-js">npm install <span class="token operator">-</span>g vue<span class="token operator">-</span>cli                            <span class="token comment" spellcheck="true">// 安装官方命令行工具vue-cli</span>
vue <span class="token operator">--</span>version                                     <span class="token comment" spellcheck="true">// 测试vue-cli运行，打印版本</span>

<span class="token comment" spellcheck="true">// 项目脚手架</span>
vue list                                          <span class="token comment" spellcheck="true">// 列出官方项目模板</span>

<span class="token comment" spellcheck="true">// vue init &lt;template> &lt;dir>使用模板创建新的应用项目</span>
<span class="token comment" spellcheck="true">// 官方模板主要有以下3种主要类型</span>
<span class="token comment" spellcheck="true">// simple                                            不使用构建工具</span>
<span class="token comment" spellcheck="true">// webpack                                           使用非常流行的Webpack打包器</span>
<span class="token comment" spellcheck="true">// browserify                                        使用Browserify构建工具</span>
vue init webpack<span class="token operator">-</span>simple demo

cd demo
npm install                                       <span class="token comment" spellcheck="true">// 安装依赖包</span>

npm run dev                                       <span class="token comment" spellcheck="true">// 以开发模式启动应用</span>

npm run build                                     <span class="token comment" spellcheck="true">// 为生产而构建</span>

<span class="token comment" spellcheck="true">// 配置Babel</span>
<span class="token comment" spellcheck="true">// 1.Babel Vue 预设</span>
npm i <span class="token operator">-</span>D babel<span class="token operator">-</span>preset<span class="token operator">-</span>vue
<span class="token comment" spellcheck="true">// 打开.babelrc文件并将vue预设添加到相应的列表中 【babel 7和7以下的配置有很大区别】</span>
<span class="token comment" spellcheck="true">// 看下文</span>

<span class="token comment" spellcheck="true">// 2.polyfill</span>
npm i <span class="token operator">-</span>D babel<span class="token operator">-</span>polyfill
<span class="token comment" spellcheck="true">// 在src/main.js文件开头导入</span>
<span class="token comment" spellcheck="true">// import 'babel-polyfill'</span>
</code></pre>
<h3 id="babel版本"><a href="#babel版本" class="headerlink" title="babel版本"></a>babel版本</h3><p>在.babelrc文件中：<br>1.”babel-core”: “^6.26.0”</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property">"modules"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"stage-3"</span><span class="token punctuation">,</span>
    <span class="token string">"vue"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2.”@babel/core”: “^7.5.5”</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>
  <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment" spellcheck="true">// Stage 2</span>
    <span class="token punctuation">[</span>
      <span class="token string">"@babel/plugin-proposal-decorators"</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">"legacy"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"@babel/plugin-proposal-function-sent"</span><span class="token punctuation">,</span>
    <span class="token string">"@babel/plugin-proposal-export-namespace-from"</span><span class="token punctuation">,</span>
    <span class="token string">"@babel/plugin-proposal-numeric-separator"</span><span class="token punctuation">,</span>
    <span class="token string">"@babel/plugin-proposal-throw-expressions"</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// Stage 3</span>
    <span class="token comment" spellcheck="true">// "@babel/plugin-syntax-dynamic-import",</span>
    <span class="token comment" spellcheck="true">// "@babel/plugin-syntax-import-meta",</span>
    <span class="token comment" spellcheck="true">// [</span>
    <span class="token comment" spellcheck="true">//   "@babel/plugin-proposal-class-properties",</span>
    <span class="token comment" spellcheck="true">//   {</span>
    <span class="token comment" spellcheck="true">//     "loose": false</span>
    <span class="token comment" spellcheck="true">//   }</span>
    <span class="token comment" spellcheck="true">// ],</span>
    <span class="token comment" spellcheck="true">// "@babel/plugin-proposal-json-strings"</span>

  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"env"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"transform-es2015-modules-commonjs"</span><span class="token punctuation">,</span>
        <span class="token string">"dynamic-import-node"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h4><p>1.移除src文件夹中的内容<br>2.使用以下内容创建一个新的JavaScript文件，名为main.js</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    el<span class="token punctuation">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> h <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token string">"hello world"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="更新依赖"><a href="#更新依赖" class="headerlink" title="更新依赖"></a>更新依赖</h3><p>1.手动更新</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 1.检查项目中使用的包是否有新版本</span>
npm outdated
<span class="token comment" spellcheck="true">// 2.打开package.json改变对应版本范围，保存</span>
npm install
</code></pre>
<p>2.自动更新</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">npm</span> update</code></pre>
<p>3.更新Vue<br>vue包和vue-template-compiler包必须始终处于相同的版本</p>
<h3 id="渲染函数"><a href="#渲染函数" class="headerlink" title="渲染函数"></a>渲染函数</h3><p>Vue使用了一个虚拟DOM的实现，用树状结构的JavaScript对象来构建虚拟DOM。然后，Vue将虚拟DOM应用到真实浏览器的DOM上，所用方法是计算两者之间的差异。这尽可能避免了DOM操作，因为DOM操作通常是主要的性能瓶颈。<br><strong>实际上，当你使用模板时，Vue会将其编译成渲染函数。如果你需要JavaScript的全部功能和灵活性，可以自己直接编写渲染函数或编写JSX。</strong><br>h是createElement的别名，得名于使用JavaScript描述HTML的技术——Hyperscript。<br>createElement（或称h）方法最多需要3个参数：<br>1.元素类型：可以是HTML标签名称（如div），在应用中注册过的组件名称，或者一个组件定义对象<br>2.可选参数：定义属性、prop、事件监听器等的数据对象<br>3.可选参数：简单纯文本、用h创建的其他元素的数组</p>
<pre class=" language-js"><code class="language-js"><span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'movies'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'movie'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Star Wars'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'movie'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Blade Runner'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>它将在浏览器中输出以下DOM：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movies<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movie<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Star Wars<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>movie<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Blade Runner<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre>
<h4 id="虚拟DOM"><a href="#虚拟DOM" class="headerlink" title="虚拟DOM"></a>虚拟DOM</h4><ul>
<li>render函数返回由createElement（或h）建立的一个节点树，这些节点在Vue中称为VNode。这棵节点树代表Vue承载的虚拟DOM中的一个组件视图。DOM中的每个元素都是一个节点——HTML元素、文本，甚至注释也是节点。</li>
<li>Vue不直接将虚拟DOM转化为实际的DOM树，因为这样可能引发很多DOM操作（添加或删除节点），十分损耗性能。</li>
<li>为了更加高效，Vue在两种DOM树之间创建一个差异表，只在必要时才会通过DOM操作将虚拟DOM同步到实际的DOM。</li>
</ul>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
</search>
